<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>klipper系统源码 | 画船听雨眠</title><meta name="keywords" content="klipper"><meta name="author" content="tinnedfruit"><meta name="copyright" content="tinnedfruit"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="klipper系统源码"><meta name="application-name" content="klipper系统源码"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="klipper系统源码"><meta property="og:url" content="http://blog.tinnedfruit.top/2024/11/01/klipper/index.html"><meta property="og:site_name" content="画船听雨眠"><meta property="og:description" content="个人voron2.4r2 | 350mm打印机备份源码，仅供参考，概不负责"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://pan.imgbed.link/file/189087"><meta property="article:author" content="tinnedfruit"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://pan.imgbed.link/file/189087"><meta name="description" content="个人voron2.4r2 | 350mm打印机备份源码，仅供参考，概不负责"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://blog.tinnedfruit.top/2024/11/01/klipper/"><link rel="preconnect" href="//cdn.cbd.int"><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""><link rel="preconnect" href="//hm.baidu.com"><link rel="preconnect" href="//static.cloudflareinsights.com"><link rel="preconnect" href="//www.clarity.ms"><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="google-site-verification" content="xxx"><meta name="baidu-site-verification" content="code-xxx"><meta name="msvalidate.01" content="xxx"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?313b4bf755f2851faaaefdf6182c9a6e";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-548WJ90VZV"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-548WJ90VZV');
</script><script defer="defer" data-pjax="data-pjax" src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;1b7a82ad236b46dca4b2aad38753f735&quot;}"></script><script>(function(c,l,a,r,i,t,y){
    c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
    t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
    y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
})(window, document, "clarity", "script", "oi0rjaxv16");</script><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"与数百名博主无限进步","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2024/07/27/125766904/ba62475f396df9de3316a08ed9e65d86_5680958632268053399..png"},
  postHeadAiDescription: {"enable":true,"gptName":"tinnedfruit","mode":"tianli","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"8TSTZomZOo1","Referer":"https://blog.tinnedfruit.top/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: {"enable":true,"ck":"3JzTCMZqBflOebeW","LingQueMonitorID":"3K6V9ILzMf4A0UqG"},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: {"apiurl":null},
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":null},
  algolia: {"appId":"IHN6VHAL4A","apiKey":"b3a02667e5be8739ff5535c3f277fdb0","indexName":"hexo","hits":{"per_page":6},"languages":{"input_placeholder":"输入关键词后按下回车查找","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: tinnedfruit","link":"链接: ","source":"来源: 画船听雨眠","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '画船听雨眠',
  title: 'klipper系统源码',
  postAI: 'true',
  pageFillDescription: 'klipper系统源码, .moonraker.conf.bkp, fluidd, klicky-bed-mesh-calibrate, klicky-macros, klicky-probe, klicky-quad-gantry-level, klicky-variables, klicky-z-calibration, KlipperScreen.conf, moonraker.conf, printer系统源码个人打印机备份源码仅供参考概不负责有关调平的宏调平的时候会自动安装和拆卸探针这样别碰就是了大佬提供给作者的文件作者又做了不少更改反正就是很多好像好叼的东西然后作者又做了不少的更改一般没出错的话就别碰这文件就是了这里有各种的简单配置宏文件主要是开关某些功能用如果要启用的话就去掉前面的号就可以想关闭的话就去最前面加个这配置的主页是有兴趣就去看看放置其他特定打印机配置这个文件一般是空白给大佬用的基础配置文件基础宏文件自动调平配置需要配置支持协助使用调平床螺丝电机配置或电机配置自动配置一个简单的宏文件别碰就对了这个宏是用户提供的作者很感谢他的分享作者做了很多调整下面都是讲解啥的懒得翻译了启用详细输出运行宏的速度运行宏的加速度喷头安装的速度拆卸的速度拆卸探针的时候的移动速度安装和拆卸探针的时候提升的高度如果是安装探针前就会先提升确保安全如果你的床在关闭电源之后自己会掉到几乎最大的位置那么久设置成床的最大床的最大如果你有单独的限位的话在这里设置好限位的坐标检查有关配置的打印机特定文档这些是虚拟值停靠位置探针卡座的坐标探针卡座的坐标探针卡座的坐标用在和类似的结构拆卸探针的时候喷嘴的移动方向安装探针的时候喷嘴的移动方向这里下面的通常不需要配置这里是设置自动的文件我不用这功能所以就随便吧这里是限位的位置之前写好的直接填这里就可以这里是用探针去按限位的位置只要不是用探针微动那小丁丁去按就行这里写探测床的时候探针移动到什么地方微动开关的触发行程增大这个数值喷嘴就会离床更加近减少就会离得远允许的偏差值这个一般别碰除非你的床弯得离谱这里往下的一般别碰固件交流群注意事项需要更改检查的事项路径打印机活动范围的热敏电阻类型和轴限位开关停止位置轴限位开关偏移位置校准和微调挤出机电机步进值文件调用调用文件调用文件需要自行确定使用哪个文件主板配置主板查询固件是把替换查询到的查询固件是的需要把替换成后面添加已默认为您生成定义即可使用机型和加速度打印机设置运动学结构分为笛卡尔和等等笛卡尔打印机最大速度最大加速度最大轴最大速度轴最大加速度方形拐角速度小一点可以有效避免平台重带来的惯性温度监控下位机主板温度关联默认上位机上位机温度关联上位机热床网格校准校准速度探针前往下一个点之前需要抬升的高最小校准点坐标最大校准点坐标采样点数为点补充采样点数算法模型算法插值不要动默认值开始网格淡出的值在设定的值之后逐步停止调整的高度建议在打印几层之后再开始淡出层高网格淡出完成的高度如果此值低于则禁用网格淡出该值可以根据打印表面的弯曲程度进行调整明显弯曲的表面应该在将网格淡出的距离长接近平坦的表面可能能够降低该值以更快地逐步淘汰格的平均值可以被视为在淡化完成后应用于整个床面的额外偏移量使用的加速度芯片名称共振测试的坐标点共振测试的最小频率共振测试的最大频率每赫兹加速度加速度每赫兹加速度频率如果共振过于强烈可以减少该值默认测试的速度较小的值会加长测试时间较大的值会降低测试精度默认步进电机设置轴步进电机电机位置轴电机脉冲引脚设置轴电机运行引脚设置方向按实际判断加感叹号会让运行方向反转轴电机使能引脚设置使能引脚需要加感叹号否者电机不工作主动带轮周长带轮带轮电机细分设置细分越高质量越高但主控负荷越大电机单圈所需脉冲数度电机度电机限位开关脚建议常闭接常闭限位开关接口接常闭后是触发状态加感叹号可以反转这个状态万一断线时候可以避免撞机软限位最小行程软限位最大行程机械限位最大行程复位速度最大第一次触发复位开关之后的后退距离复位方向一般不需要改动二次复位速度最大后撤距离请确保驱动型号配置正确驱动配置通讯端口脚定义是否开启微步插值开启是关闭是电机运行电流值单位驱动采样电阻不要改静音阀值如果不需要静音请将数值改为驱动配置片选脚定义通讯总线定义电机运行电流值是否开启微步插值开启是关闭是驱动采样电阻不要改如果使用请将数值修改为静音阀值如果不需要静音请将数值改为轴步进电机电机位置电机细分设置细分越高质量越高但主控负荷越大电机单圈所需脉冲数度电机度电机限位开关脚建议常闭然后添加反转状态限位开关接口接常闭后是触发状态加感叹号可以反转这个状态万一断线时候可以避免撞机二次复位速度最大后撤距离请确保驱动型号配置正确是否开启微步插值开启是关闭是电机运行电流值单位驱动采样电阻不要改静音阀值如果不需要静音请将数值改为挤出机驱动配置通讯总线定义电机运行电流值是否开启微步插值开启是关闭是驱动采样电阻不要改如果使用请将数值修改为静音阀值如果不需要静音请将数值改为电机细分设置细分越高质量越高但主控负荷越大电机单圈所需脉冲数度电机度电机挤出机驱动配置通讯总线定义电机运行电流值是否开启微步插值开启是关闭是驱动采样电阻不要改如果使用请将数值修改为静音阀值如果不需要静音请将数值改为轴步进电机电机位置左前方主动轮周长为为减速比丝杆导程为请根据你的实际使用情况修改限位开关接口软限位最大行程软限位最小行程配置喷嘴清洁需要左右复位速度最大二次复位速度最大后撤距离静音阀值如果不需要静音请将数值改为电机位置丝杆导程为请根据你的实际使用情况修改电机位置电机位置挤出机配置电机位置挤出机单圈脉冲数为度为度主动带轮周长校准步进值旧实际挤出长度请求的挤出长度减速比伽利略齿比并且这行注释掉为输出轴在前输入轴在后喷嘴直径耗材直径挤出头加热棒控制脚设置传感器型号挤出头传感器脚加热棒最大输出功率挤出机最小温度挤出机最大温度加热棒最低挤出温度达到此温度挤出机才能有挤出动作挤出机压力提前参数平稳推进时间默认值为喷嘴温度校准命令热床热床配置温度差加热器和温度传感器验证默认在打印机上每个配置的加热器上启用加热器验证使用分段来覆盖默认设置报错之前最大的累计温度偏差更小的值会导致更严格的检查而更大的值在报错前允许更多的时间具体地说温度会每秒检查一次如果温度正在接近目标温度内部的错误计数会重置否则如果温度低于目标区间那么计数器会增加汇报的温度与目标的差当计数值超过就会报错默认值是这个量控制着加热器初始化加热时的检查更小的值会导致更严格的检查而更大的值在报错前允许更多的时间具体地说初始化加热时只要加热器在时间片内秒升高温度错误计数会重置默认值对于挤出头是秒热床是秒被认为是在目标区间内的最大温差以摄氏度为单位这个量控制着区间检测很少定制这个值默认是在检查中最小需要升高的温度以摄氏度为单位很少定制这个值默认是静音阀值如果不需要静音请将数值改为热床配置热床接口热床传感器类型热床传感器接口热床功率热床最小温度热床最大温度热床温度校准命令热床热床配置温度差加热器和温度传感器验证默认在打印机上每个配置的加热器上启用加热器验证使用分段来覆盖默认设置报错之前最大的累计温度偏差更小的值会导致更严格的检查而更大的值在报错前允许更多的时间具体地说温度会每秒检查一次如果温度正在接近目标温度内部的错误计数会重置否则如果温度低于目标区间那么计数器会增加汇报的温度与目标的差当计数值超过就会报错默认值是这个量控制着加热器初始化加热时的检查更小的值会导致更严格的检查而更大的值在报错前允许更多的时间具体地说初始化加热时只要加热器在时间片内秒升高温度错误计数会重置默认值对于挤出头是秒热床是秒被认为是在目标区间内的最大温差以摄氏度为单位这个量控制着区间检测很少定制这个值默认是在检查中最小需要升高的温度以摄氏度为单位很少定制这个值默认是风扇配置模型冷却风扇启动时间勿动勿动喉管散热喉管冷却风扇启动时间勿动关联的设备挤出机挤出机达到多少度启动风扇电器仓风扇电器仓风扇关联的设备热床热床达到多少度启动风扇风扇电器仓风扇关联的设备热床热床达到多少度启动风扇热床风扇侧边风扇侧边风扇请参阅分段了解上述参数的描述当加热器或步进驱动器活跃时将设置风扇速度表示为从到的值默认值为在步进驱动器或加热器不再活跃后风扇应保持运行的时间以秒为单位默认值为秒当步进驱动器或加热器不再活跃后并且达到之前将设置风扇速度表示为从到的值默认值为定义与此风扇相关联的加热器步进器的配置分段的名称如果在此处提供了逗号分隔的加热器步进器名称列表则当任何给定的加热器步进器启用时将启用该风扇默认加热器为默认步进器为所有步进器电器仓风扇微控制器软件进入错误状态时的风扇速度以到的值表示默认值为关联的设备热床最低温度低于此温度将会报错最高温度高于此温度将会报错最大转速为满功率运转时的最小转速为满功率运转时的上位机散热风扇上位机风扇脚设置为上位机主控温度控制方式上位机散热风扇启动温度最低温度低于此温度将会报错最高温度高于此温度将会报错最大转速为满功率运转时的最小转速为满功率运转时的传感器类型传感器引脚最小温度低于此温度报错最大温度高于此温度报错传感器类型传感器引脚传感器类型传感器引脚传感器类型传感器引脚闲置关闭热床空闲时间超过分钟则关闭热床停止加热关闭电机调平传感器默认感应探头不低于喷嘴高度仅用于调平如果你的是常开请将更改添加到限位开关脚建议常闭然后添加反转状态位置在轴传感器相对喷嘴偏移量轴传感器相对喷嘴偏移量轴传感器相对喷嘴偏移量调平速度采样次数取值方式默认中位数调平回缩距离采样公差注意过小的值可能造成采样次数增加超公差重试次数信号接口舵机控制轴传感器相对喷嘴偏移量轴传感器相对喷嘴偏移量轴传感器相对喷嘴偏移量归位轴限位坐标轴限位位置定义重要自行进行调整归位速度归位之前抬升高度限位开关的位置通过后将和更新为你的值如轴限位位置定义调平机器调平参数机器调平点位机器调平点位机器调平点位调平速度轴起始高度采样公差超公差重试次数调平最大调整行程灯配置需要时启用信号接灯珠数量灯珠类型天依蓝灯珠数量坐标列表每行一个后续行缩进描述每个床枢轴点的位置这枢轴点是床连接到给定的点步进器它使用喷嘴坐标位置喷嘴的如果它可以直接移动到该点上方这第一个条目对应于第二个条目对应于第三个为等该参数必须提供坐标列表每行一个后续行应该在命令期间探测指定喷嘴的坐标并确保探头位于上方给定喷嘴坐标处的床该参数必须是假如校准过程中非探测移动的速度单位默认为应命令头部移动到的高度以毫米为单位就在开始探测操作之前默认值为探测点不在范围内时重试的次数宽容如果启用重试则在探测到最大和最小时重试点的差异大于注意最小单位此处的更改只需一步即可但是如果你正在探索比步进器更多的点那么你可能会有一个固定的您可以了解的探测点范围的最小值通过观察命令输出自定义宏允许圆弧插补启用圆弧插补灯控制卸载网床归位所有轴龙门架调平归位所有轴等待给定温度传感器等于或高于提供的和或等于或低于设置挤出机温度设置床温等待床温等待挤出机温度将下面两个宏添加到中取消打印取消打印暂停打印恢复打印热端加热到达温度直接打印无需等待热床加热到达温度直接下一步无需等待等待挤出机温度等待床温将设置为开始打印时的宏自定义打印前的动作配置名目标目标等待指定温度传感器读数高于和或低于重置挤出卸载网床归位所有轴擦嘴龙门架调平归位所有轴将喷嘴移离热床根据打印面积探测网床判断是否有自适应网床参数向屏幕发送文字此处接收来自的自适应网床参数需要软件中配置传参向屏幕发送文字每次探测网床可选调用默认网床加载网床重置挤出设置绝对坐标体系移动至位置速度意思为每分钟移动轴高度至设置坐标体系为相对坐标移动轴并挤出更改可更改挤出率移动轴反方向移动轴并挤出更改可更改挤出率抬高轴重置挤出设置绝对坐标体系将设置为打印结束时的宏自定义打印完成之后动作等待缓冲区清除相对定位移动喷嘴以移除架线关闭热端将挤出机归零缩回耗材丝关闭风扇将喷嘴向上移动毫米设置绝对坐标体系将喷嘴停在后部设置相对坐标卸载网床等待床温调好了',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-11-01 00:00:00',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/home.css"><link rel="stylesheet" href="/css/welcome.css?1"><link rel="stylesheet" href="/css/imgloaded.css?1"><link rel="stylesheet" href="/css/todolist.css"><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://pan.imgbed.link/file/185733"><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://blog.tinnedfruit.top/" title="罆頭的博客"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="罆頭的博客"><span class="back-menu-item-text">罆頭的博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">画船听雨眠</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/charts/"><i class="anzhiyufont anzhiyu-icon-chart-line faa-tada" style="font-size: 0.9em;"></i><span> 文章统计</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-instagram faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/games/"><i class="anzhiyufont anzhiyu-icon-rocket faa-tada" style="font-size: 0.9em;"></i><span> 游戏世界</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 我的装备</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/todolist/"><i class="anzhiyufont anzhiyu-icon-book-open faa-tada" style="font-size: 0.9em;"></i><span> 想做的事</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-comments faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://pan.imgbed.link/file/185637" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://pan.imgbed.link/file/185637"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://pan.imgbed.link/file/185638" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://pan.imgbed.link/file/185638"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Hexo/" style="font-size: 1.05rem;">Hexo<sup>1</sup></a><a href="/tags/PVE/" style="font-size: 1.05rem;">PVE<sup>3</sup></a><a href="/tags/Tag-Plugins/" style="font-size: 1.05rem;">Tag Plugins<sup>1</sup></a><a href="/tags/klipper/" style="font-size: 1.05rem;">klipper<sup>1</sup></a><a href="/tags/voron/" style="font-size: 1.05rem;">voron<sup>1</sup></a><a href="/tags/%E4%B8%BB%E9%A2%98%E9%AD%94%E6%94%B9/" style="font-size: 1.05rem;">主题魔改<sup>3</sup></a></div></div><hr></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/11/"><span class="card-archive-list-date">十一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/10/"><span class="card-archive-list-date">十月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/06/"><span class="card-archive-list-date">六月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/voron/" itemprop="url">voron</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/klipper/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>klipper</span></a></span></div></div><h1 class="post-title" itemprop="name headline">klipper系统源码</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-10-31T16:00:00.000Z" title="发表于 2024-11-01 00:00:00">2024-11-01</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-10-31T16:00:00.000Z" title="更新于 2024-11-01 00:00:00">2024-11-01</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">14.7k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>75分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="klipper系统源码"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为广州"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>广州</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://pan.imgbed.link/file/189088"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><div class="post-ai-description"><div class="ai-title"><i class="anzhiyufont anzhiyu-icon-bilibili"></i><div class="ai-title-text">AI-摘要</div><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i><i class="anzhiyufont anzhiyu-icon-circle-dot" title="朗读摘要"></i><div id="ai-tag">Tianli GPT</div></div><div class="ai-explanation">AI初始化中...</div><div class="ai-btn-box"><div class="ai-btn-item">介绍自己 🙈</div><div class="ai-btn-item">生成本文简介 👋</div><div class="ai-btn-item">推荐相关文章 📖</div><div class="ai-btn-item">前往主页 🏠</div><div class="ai-btn-item" id="go-tianli-blog">前往爱发电购买</div></div><script data-pjax="" src="/js/anzhiyu/ai_abstract.js"></script></div><article class="post-content" id="article-container" itemscope="" itemtype="http://blog.tinnedfruit.top/2024/11/01/klipper/"><header><a class="post-meta-categories" href="/categories/voron/" itemprop="url">voron</a><a href="/tags/klipper/" tabindex="-1" itemprop="url">klipper</a><h1 id="CrawlerTitle" itemprop="name headline">klipper系统源码</h1><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">tinnedfruit</span><time itemprop="dateCreated datePublished" datetime="2024-10-31T16:00:00.000Z" title="发表于 2024-11-01 00:00:00">2024-11-01</time><time itemprop="dateCreated datePublished" datetime="2024-10-31T16:00:00.000Z" title="更新于 2024-11-01 00:00:00">2024-11-01</time></header><div id="postchat_postcontent"><h1 id="klipper系统源码"><a href="#klipper系统源码" class="headerlink" title="klipper系统源码"></a>klipper系统源码</h1><div class="note blue anzhiyufont anzhiyu-icon-bullhorn simple"><p><strong>个人voron2.4r2 | 350mm打印机备份源码，仅供参考，概不负责</strong></p>
</div>

<h2 id="moonraker-conf-bkp"><a href="#moonraker-conf-bkp" class="headerlink" title=".moonraker.conf.bkp"></a>.moonraker.conf.bkp</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[server]</span><br><span class="line">host = 0.0.0.0</span><br><span class="line">port = 7125</span><br><span class="line">klippy_uds_address = /home/orangepi/printer_data/comms/klippy.sock</span><br><span class="line"></span><br><span class="line">[authorization]</span><br><span class="line">trusted_clients = </span><br><span class="line">	10.0.0.0/8</span><br><span class="line">	127.0.0.0/8</span><br><span class="line">	169.254.0.0/16</span><br><span class="line">	172.16.0.0/12</span><br><span class="line">	192.168.0.0/16</span><br><span class="line">	FE80::/10</span><br><span class="line">	::1/128</span><br><span class="line">cors_domains = </span><br><span class="line">	*.lan</span><br><span class="line">	*.<span class="built_in">local</span></span><br><span class="line">	*://localhost</span><br><span class="line">	*://localhost:*</span><br><span class="line">	*://my.mainsail.xyz</span><br><span class="line">	*://app.fluidd.xyz</span><br><span class="line"></span><br><span class="line">[octoprint_compat]</span><br><span class="line"></span><br><span class="line">[<span class="built_in">history</span>]</span><br><span class="line"></span><br><span class="line">[update_manager]</span><br><span class="line">channel = dev</span><br><span class="line">refresh_interval = 168</span><br><span class="line"></span><br><span class="line">[update_manager fluidd-config]</span><br><span class="line"><span class="built_in">type</span> = git_repo</span><br><span class="line">primary_branch = master</span><br><span class="line">path = ~/fluidd-config</span><br><span class="line">origin = https://github.com/fluidd-core/fluidd-config.git</span><br><span class="line">managed_services = klipper</span><br><span class="line"></span><br><span class="line">[update_manager fluidd]</span><br><span class="line"><span class="built_in">type</span> = web</span><br><span class="line">channel = stable</span><br><span class="line">repo = fluidd-core/fluidd</span><br><span class="line">path = ~/fluidd</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h2 id="fluidd"><a href="#fluidd" class="headerlink" title="fluidd"></a>fluidd</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Client klipper macro definitions</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment">## Copyright (C) 2022 Alex Zellner &lt;alexander.zellner@googlemail.com&gt;</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment">## This file may be distributed under the terms of the GNU GPLv3 license</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment">## !!! This file is read-only. Maybe the used editor indicates that. !!!</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment">## Customization:</span></span><br><span class="line"><span class="comment">##   1) copy the gcode_macro _CLIENT_VARIABLE (see below) to your printer.cfg</span></span><br><span class="line"><span class="comment">##   2) remove the comment mark (#) from all lines</span></span><br><span class="line"><span class="comment">##   3) change any value in there to your needs</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment">## Use the PAUSE macro direct in your M600:</span></span><br><span class="line"><span class="comment">##  e.g. with a different park position front left and a minimal height of 50</span></span><br><span class="line"><span class="comment">##    [gcode_macro M600]</span></span><br><span class="line"><span class="comment">##    description: Filament change</span></span><br><span class="line"><span class="comment">##    gcode: PAUSE X=10 Y=10 Z_MIN=50</span></span><br><span class="line"><span class="comment">##  Z_MIN will park the toolhead at a minimum of 50 mm above to bed to make it easier for you to swap filament.</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment">## Client variable macro for your printer.cfg</span></span><br><span class="line"><span class="comment">#[gcode_macro _CLIENT_VARIABLE]</span></span><br><span class="line"><span class="comment">#variable_use_custom_pos   : False ; use custom park coordinates for x,y [True/False]</span></span><br><span class="line"><span class="comment">#variable_custom_park_x    : 0.0   ; custom x position; value must be within your defined min and max of X</span></span><br><span class="line"><span class="comment">#variable_custom_park_y    : 0.0   ; custom y position; value must be within your defined min and max of Y</span></span><br><span class="line"><span class="comment">#variable_custom_park_dz   : 2.0   ; custom dz value; the value in mm to lift the nozzle when move to park position</span></span><br><span class="line"><span class="comment">#variable_retract          : 1.0   ; the value to retract while PAUSE</span></span><br><span class="line"><span class="comment">#variable_cancel_retract   : 5.0   ; the value to retract while CANCEL_PRINT</span></span><br><span class="line"><span class="comment">#variable_speed_retract    : 35.0  ; retract speed in mm/s</span></span><br><span class="line"><span class="comment">#variable_unretract        : 1.0   ; the value to unretract while RESUME</span></span><br><span class="line"><span class="comment">#variable_speed_unretract  : 35.0  ; unretract speed in mm/s</span></span><br><span class="line"><span class="comment">#variable_speed_hop        : 15.0  ; z move speed in mm/s</span></span><br><span class="line"><span class="comment">#variable_speed_move       : 100.0 ; move speed in mm/s</span></span><br><span class="line"><span class="comment">#variable_park_at_cancel   : False ; allow to move the toolhead to park while execute CANCEL_PRINT [True/False]</span></span><br><span class="line"><span class="comment">#variable_park_at_cancel_x : None  ; different park position during CANCEL_PRINT [None/Position as Float]; park_at_cancel must be True</span></span><br><span class="line"><span class="comment">#variable_park_at_cancel_y : None  ; different park position during CANCEL_PRINT [None/Position as Float]; park_at_cancel must be True</span></span><br><span class="line"><span class="comment">## !!! Caution [firmware_retraction] must be defined in the printer.cfg if you set use_fw_retract: True !!!</span></span><br><span class="line"><span class="comment">#variable_use_fw_retract   : False ; use fw_retraction instead of the manual version [True/False]</span></span><br><span class="line"><span class="comment">#variable_idle_timeout     : 0     ; time in sec until idle_timeout kicks in. Value 0 means that no value will be set or restored</span></span><br><span class="line"><span class="comment">#variable_runout_sensor    : ""    ; If a sensor is defined, it will be used to cancel the execution of RESUME in case no filament is detected.</span></span><br><span class="line"><span class="comment">##                                   Specify the config name of the runout sensor e.g "filament_switch_sensor runout". Hint use the same as in your printer.cfg</span></span><br><span class="line"><span class="comment">## !!! Custom macros, please use with care and review the section of the corresponding macro.</span></span><br><span class="line"><span class="comment">## These macros are for simple operations like setting a status LED. Please make sure your macro does not interfere with the basic macro functions.</span></span><br><span class="line"><span class="comment">## Only  single line commands are supported, please create a macro if you need more than one command.</span></span><br><span class="line"><span class="comment">#variable_user_pause_macro : ""    ; Everything inside the "" will be executed after the klipper base pause (PAUSE_BASE) function</span></span><br><span class="line"><span class="comment">#variable_user_resume_macro: ""    ; Everything inside the "" will be executed before the klipper base resume (RESUME_BASE) function</span></span><br><span class="line"><span class="comment">#variable_user_cancel_macro: ""    ; Everything inside the "" will be executed before the klipper base cancel (CANCEL_PRINT_BASE) function</span></span><br><span class="line"><span class="comment">#gcode:</span></span><br><span class="line"></span><br><span class="line">[virtual_sdcard]</span><br><span class="line">path: ~/printer_data/gcodes</span><br><span class="line">on_error_gcode: CANCEL_PRINT</span><br><span class="line"></span><br><span class="line">[pause_resume]</span><br><span class="line"><span class="comment">#recover_velocity: 50.</span></span><br><span class="line"><span class="comment">#   When capture/restore is enabled, the speed at which to return to</span></span><br><span class="line"><span class="comment">#   the captured position (in mm/s). Default is 50.0 mm/s.</span></span><br><span class="line"></span><br><span class="line">[display_status]</span><br><span class="line"></span><br><span class="line">[respond]</span><br><span class="line"></span><br><span class="line">[gcode_macro CANCEL_PRINT]</span><br><span class="line">description: Cancel the actual running <span class="built_in">print</span></span><br><span class="line">rename_existing: CANCEL_PRINT_BASE</span><br><span class="line">gcode:</span><br><span class="line">  <span class="comment">##### get user parameters or use default #####</span></span><br><span class="line">  {% <span class="built_in">set</span> client = printer[<span class="string">'gcode_macro _CLIENT_VARIABLE'</span>] | default({}) %}</span><br><span class="line">  {% <span class="built_in">set</span> allow_park = client.park_at_cancel | default(<span class="literal">false</span>) | lower == <span class="string">'true'</span> %}</span><br><span class="line">  {% <span class="built_in">set</span> retract = client.cancel_retract | default(5.0) | abs %}</span><br><span class="line">  <span class="comment">##### define park position #####</span></span><br><span class="line">  {% <span class="built_in">set</span> park_x = <span class="string">""</span> <span class="keyword">if</span> (client.park_at_cancel_x | default(none) is none)</span><br><span class="line">            <span class="keyword">else</span> <span class="string">"X="</span> ~ client.park_at_cancel_x %}</span><br><span class="line">  {% <span class="built_in">set</span> park_y = <span class="string">""</span> <span class="keyword">if</span> (client.park_at_cancel_y | default(none) is none)</span><br><span class="line">            <span class="keyword">else</span> <span class="string">"Y="</span> ~ client.park_at_cancel_y %}</span><br><span class="line">  {% <span class="built_in">set</span> custom_park = park_x | length &gt; 0 or park_y | length &gt; 0 %}</span><br><span class="line">  <span class="comment">##### end of definitions #####</span></span><br><span class="line">  <span class="comment"># restore idle_timeout time if needed</span></span><br><span class="line">  {% <span class="keyword">if</span> printer[<span class="string">'gcode_macro RESUME'</span>].restore_idle_timeout &gt; 0 %}</span><br><span class="line">    SET_IDLE_TIMEOUT TIMEOUT={printer[<span class="string">'gcode_macro RESUME'</span>].restore_idle_timeout}</span><br><span class="line">  {% endif %}</span><br><span class="line">  {% <span class="keyword">if</span> (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}</span><br><span class="line">  _CLIENT_RETRACT LENGTH={retract}</span><br><span class="line">  TURN_OFF_HEATERS</span><br><span class="line">  M106 S0</span><br><span class="line">  {client.user_cancel_macro | default(<span class="string">""</span>)}</span><br><span class="line">  SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=idle_state VALUE=False</span><br><span class="line">  <span class="comment"># clear pause_next_layer and pause_at_layer as preparation for next print</span></span><br><span class="line">  SET_PAUSE_NEXT_LAYER ENABLE=0</span><br><span class="line">  SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0</span><br><span class="line">  CANCEL_PRINT_BASE</span><br><span class="line"></span><br><span class="line">[gcode_macro PAUSE]</span><br><span class="line">description: Pause the actual running <span class="built_in">print</span></span><br><span class="line">rename_existing: PAUSE_BASE</span><br><span class="line">gcode:</span><br><span class="line">  <span class="comment">##### get user parameters or use default #####</span></span><br><span class="line">  {% <span class="built_in">set</span> client = printer[<span class="string">'gcode_macro _CLIENT_VARIABLE'</span>] | default({}) %}</span><br><span class="line">  {% <span class="built_in">set</span> idle_timeout = client.idle_timeout | default(0) %}</span><br><span class="line">  {% <span class="built_in">set</span> temp = printer[printer.toolhead.extruder].target <span class="keyword">if</span> printer.toolhead.extruder != <span class="string">''</span> <span class="keyword">else</span> 0 %}</span><br><span class="line">  {% <span class="built_in">set</span> restore = False <span class="keyword">if</span> printer.toolhead.extruder == <span class="string">''</span></span><br><span class="line">              <span class="keyword">else</span> True  <span class="keyword">if</span> params.RESTORE | default(1) | int == 1 <span class="keyword">else</span> False %}</span><br><span class="line">  <span class="comment">##### end of definitions #####</span></span><br><span class="line">  SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=last_extruder_temp VALUE=<span class="string">"{{'restore': restore, 'temp': temp}}"</span></span><br><span class="line">  <span class="comment"># set a new idle_timeout value</span></span><br><span class="line">  {% <span class="keyword">if</span> idle_timeout &gt; 0 %}</span><br><span class="line">    SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=restore_idle_timeout VALUE={printer.configfile.settings.idle_timeout.timeout}</span><br><span class="line">    SET_IDLE_TIMEOUT TIMEOUT={idle_timeout}</span><br><span class="line">  {% endif %}</span><br><span class="line">  PAUSE_BASE</span><br><span class="line">  {client.user_pause_macro | default(<span class="string">""</span>)}</span><br><span class="line">  _TOOLHEAD_PARK_PAUSE_CANCEL {rawparams}</span><br><span class="line"></span><br><span class="line">[gcode_macro RESUME]</span><br><span class="line">description: Resume the actual running <span class="built_in">print</span></span><br><span class="line">rename_existing: RESUME_BASE</span><br><span class="line">variable_last_extruder_temp: {<span class="string">'restore'</span>: False, <span class="string">'temp'</span>: 0}</span><br><span class="line">variable_restore_idle_timeout: 0</span><br><span class="line">variable_idle_state: False</span><br><span class="line">gcode:</span><br><span class="line">  <span class="comment">##### get user parameters or use default #####</span></span><br><span class="line">  {% <span class="built_in">set</span> client = printer[<span class="string">'gcode_macro _CLIENT_VARIABLE'</span>] | default({}) %}</span><br><span class="line">  {% <span class="built_in">set</span> velocity = printer.configfile.settings.pause_resume.recover_velocity %}</span><br><span class="line">  {% <span class="built_in">set</span> sp_move = client.speed_move | default(velocity) %}</span><br><span class="line">  {% <span class="built_in">set</span> runout_resume = True <span class="keyword">if</span> client.runout_sensor | default(<span class="string">""</span>) == <span class="string">""</span>   <span class="comment"># no runout</span></span><br><span class="line">                    <span class="keyword">else</span> True <span class="keyword">if</span> not printer[client.runout_sensor].enabled  <span class="comment"># sensor is disabled</span></span><br><span class="line">                    <span class="keyword">else</span> printer[client.runout_sensor].filament_detected %} <span class="comment"># sensor status</span></span><br><span class="line">  {% <span class="built_in">set</span> can_extrude = True <span class="keyword">if</span> printer.toolhead.extruder == <span class="string">''</span>           <span class="comment"># no extruder defined in config</span></span><br><span class="line">                  <span class="keyword">else</span> printer[printer.toolhead.extruder].can_extrude %} <span class="comment"># status of active extruder</span></span><br><span class="line">  {% <span class="built_in">set</span> do_resume = False %}</span><br><span class="line">  {% <span class="built_in">set</span> prompt_txt = [] %}</span><br><span class="line">  <span class="comment">##### end of definitions #####</span></span><br><span class="line">  <span class="comment">#### Printer comming from timeout idle state ####</span></span><br><span class="line">  {% <span class="keyword">if</span> printer.idle_timeout.state | upper == <span class="string">"IDLE"</span> or idle_state %}</span><br><span class="line">    SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=idle_state VALUE=False</span><br><span class="line">    {% <span class="keyword">if</span> last_extruder_temp.restore %}</span><br><span class="line">      <span class="comment"># we need to use the unicode (\u00B0) for the ° as py2 env's would throw an error otherwise</span></span><br><span class="line">      RESPOND TYPE=<span class="built_in">echo</span> MSG=<span class="string">'{"Restoring \"%s\" temperature to %3.1f\u00B0C, this may take some time" % (printer.toolhead.extruder, last_extruder_temp.temp) }'</span></span><br><span class="line">      M109 S{last_extruder_temp.temp}</span><br><span class="line">      {% <span class="built_in">set</span> do_resume = True %}</span><br><span class="line">    {% <span class="keyword">elif</span> can_extrude %}</span><br><span class="line">      {% <span class="built_in">set</span> do_resume = True %}</span><br><span class="line">    {% <span class="keyword">else</span> %}</span><br><span class="line">      RESPOND TYPE=error MSG=<span class="string">'{"Resume aborted !!! \"%s\" not hot enough, please heat up again and press RESUME" % printer.toolhead.extruder}'</span></span><br><span class="line">      {% <span class="built_in">set</span> _d = prompt_txt.append(<span class="string">"\"%s\" not hot enough, please heat up again and press RESUME"</span> % printer.toolhead.extruder) %}</span><br><span class="line">    {% endif %}</span><br><span class="line">  <span class="comment">#### Printer comming out of regular PAUSE state ####</span></span><br><span class="line">  {% <span class="keyword">elif</span> can_extrude %}</span><br><span class="line">    {% <span class="built_in">set</span> do_resume = True %}</span><br><span class="line">  {% <span class="keyword">else</span> %}</span><br><span class="line">    RESPOND TYPE=error MSG=<span class="string">'{"Resume aborted !!! \"%s\" not hot enough, please heat up again and press RESUME" % printer.toolhead.extruder}'</span></span><br><span class="line">    {% <span class="built_in">set</span> _d = prompt_txt.append(<span class="string">"\"%s\" not hot enough, please heat up again and press RESUME"</span> % printer.toolhead.extruder) %}</span><br><span class="line">  {% endif %}</span><br><span class="line">  {% <span class="keyword">if</span> runout_resume %}</span><br><span class="line">    {% <span class="keyword">if</span> do_resume %}</span><br><span class="line">      {% <span class="keyword">if</span> restore_idle_timeout &gt; 0 %} SET_IDLE_TIMEOUT TIMEOUT={restore_idle_timeout} {% endif %} <span class="comment"># restore idle_timeout time</span></span><br><span class="line">      {client.user_resume_macro | default(<span class="string">""</span>)}</span><br><span class="line">      _CLIENT_EXTRUDE</span><br><span class="line">      RESUME_BASE VELOCITY={params.VELOCITY | default(sp_move)}</span><br><span class="line">    {% endif %}</span><br><span class="line">  {% <span class="keyword">else</span> %}</span><br><span class="line">    RESPOND TYPE=error MSG=<span class="string">'{"Resume aborted !!! \"%s\" detects no filament, please load filament and press RESUME" % (client.runout_sensor.split(" "))[1]}'</span></span><br><span class="line">    {% <span class="built_in">set</span> _d = prompt_txt.append(<span class="string">"\"%s\" detects no filament, please load filament and press RESUME"</span> % (client.runout_sensor.split(<span class="string">" "</span>))[1]) %}</span><br><span class="line">  {% endif %}</span><br><span class="line">  <span class="comment">##### Generate User Information box in case of abort #####</span></span><br><span class="line">  {% <span class="keyword">if</span> not (runout_resume and do_resume) %}</span><br><span class="line">    RESPOND TYPE=<span class="built_in">command</span> MSG=<span class="string">"action:prompt_begin RESUME aborted !!!"</span></span><br><span class="line">    {% <span class="keyword">for</span> element <span class="keyword">in</span> prompt_txt %}</span><br><span class="line">      RESPOND TYPE=<span class="built_in">command</span> MSG=<span class="string">'{"action:prompt_text %s" % element}'</span></span><br><span class="line">    {% endfor %}</span><br><span class="line">    RESPOND TYPE=<span class="built_in">command</span> MSG=<span class="string">"action:prompt_footer_button Ok|RESPOND TYPE=command MSG=action:prompt_end|info"</span></span><br><span class="line">    RESPOND TYPE=<span class="built_in">command</span> MSG=<span class="string">"action:prompt_show"</span></span><br><span class="line">  {% endif %}</span><br><span class="line"></span><br><span class="line"><span class="comment"># Usage: SET_PAUSE_NEXT_LAYER [ENABLE=[0 | 1]] [MACRO=&lt;name&gt;]</span></span><br><span class="line">[gcode_macro SET_PAUSE_NEXT_LAYER]</span><br><span class="line">description: Enable a pause <span class="keyword">if</span> the next layer is reached</span><br><span class="line">gcode:</span><br><span class="line">  {% <span class="built_in">set</span> pause_next_layer = printer[<span class="string">'gcode_macro SET_PRINT_STATS_INFO'</span>].pause_next_layer %}</span><br><span class="line">  {% <span class="built_in">set</span> ENABLE = params.ENABLE | default(1)|int != 0 %}</span><br><span class="line">  {% <span class="built_in">set</span> MACRO = params.MACRO | default(pause_next_layer.call, True) %}</span><br><span class="line">  SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE=<span class="string">"{{ 'enable': ENABLE, 'call': MACRO }}"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Usage: SET_PAUSE_AT_LAYER [ENABLE=[0 | 1]] [LAYER=&lt;number&gt;] [MACRO=&lt;name&gt;]</span></span><br><span class="line">[gcode_macro SET_PAUSE_AT_LAYER]</span><br><span class="line">description: Enable/disable a pause <span class="keyword">if</span> a given layer number is reached</span><br><span class="line">gcode:</span><br><span class="line">  {% <span class="built_in">set</span> pause_at_layer = printer[<span class="string">'gcode_macro SET_PRINT_STATS_INFO'</span>].pause_at_layer %}</span><br><span class="line">  {% <span class="built_in">set</span> ENABLE = params.ENABLE | int != 0 <span class="keyword">if</span> params.ENABLE is defined</span><br><span class="line">             <span class="keyword">else</span> params.LAYER is defined %}</span><br><span class="line">  {% <span class="built_in">set</span> LAYER = params.LAYER | default(pause_at_layer.layer) | int %}</span><br><span class="line">  {% <span class="built_in">set</span> MACRO = params.MACRO | default(pause_at_layer.call, True) %}</span><br><span class="line">  SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE=<span class="string">"{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Usage: SET_PRINT_STATS_INFO [TOTAL_LAYER=&lt;total_layer_count&gt;] [CURRENT_LAYER= &lt;current_layer&gt;]</span></span><br><span class="line">[gcode_macro SET_PRINT_STATS_INFO]</span><br><span class="line">rename_existing: SET_PRINT_STATS_INFO_BASE</span><br><span class="line">description: Overwrite, to get pause_next_layer and pause_at_layer feature</span><br><span class="line">variable_pause_next_layer: { <span class="string">'enable'</span>: False, <span class="string">'call'</span>: <span class="string">"PAUSE"</span> }</span><br><span class="line">variable_pause_at_layer  : { <span class="string">'enable'</span>: False, <span class="string">'layer'</span>: 0, <span class="string">'call'</span>: <span class="string">"PAUSE"</span> }</span><br><span class="line">gcode:</span><br><span class="line">  {% <span class="keyword">if</span> pause_next_layer.enable %}</span><br><span class="line">    RESPOND TYPE=<span class="built_in">echo</span> MSG=<span class="string">'{"%s, forced by pause_next_layer" % pause_next_layer.call}'</span></span><br><span class="line">    {pause_next_layer.call} ; execute the given gcode to pause, should be either M600 or PAUSE</span><br><span class="line">    SET_PAUSE_NEXT_LAYER ENABLE=0</span><br><span class="line">  {% <span class="keyword">elif</span> pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER | int == pause_at_layer.layer %}</span><br><span class="line">    RESPOND TYPE=<span class="built_in">echo</span> MSG=<span class="string">'{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'</span></span><br><span class="line">    {pause_at_layer.call} ; execute the given gcode to pause, should be either M600 or PAUSE</span><br><span class="line">    SET_PAUSE_AT_LAYER ENABLE=0</span><br><span class="line">  {% endif %}</span><br><span class="line">  SET_PRINT_STATS_INFO_BASE {rawparams}</span><br><span class="line"></span><br><span class="line"><span class="comment">##### internal use #####</span></span><br><span class="line">[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]</span><br><span class="line">description: Helper: park toolhead used <span class="keyword">in</span> PAUSE and CANCEL_PRINT</span><br><span class="line">gcode:</span><br><span class="line">  <span class="comment">##### get user parameters or use default #####</span></span><br><span class="line">  {% <span class="built_in">set</span> client = printer[<span class="string">'gcode_macro _CLIENT_VARIABLE'</span>] | default({}) %}</span><br><span class="line">  {% <span class="built_in">set</span> velocity = printer.configfile.settings.pause_resume.recover_velocity %}</span><br><span class="line">  {% <span class="built_in">set</span> use_custom     = client.use_custom_pos | default(<span class="literal">false</span>) | lower == <span class="string">'true'</span> %}</span><br><span class="line">  {% <span class="built_in">set</span> custom_park_x  = client.custom_park_x | default(0.0) %}</span><br><span class="line">  {% <span class="built_in">set</span> custom_park_y  = client.custom_park_y | default(0.0) %}</span><br><span class="line">  {% <span class="built_in">set</span> park_dz        = client.custom_park_dz | default(2.0) | abs %}</span><br><span class="line">  {% <span class="built_in">set</span> sp_hop         = client.speed_hop | default(15) * 60 %}</span><br><span class="line">  {% <span class="built_in">set</span> sp_move        = client.speed_move | default(velocity) * 60 %}</span><br><span class="line">  <span class="comment">##### get config and toolhead values #####</span></span><br><span class="line">  {% <span class="built_in">set</span> origin    = printer.gcode_move.homing_origin %}</span><br><span class="line">  {% <span class="built_in">set</span> act       = printer.gcode_move.gcode_position %}</span><br><span class="line">  {% <span class="built_in">set</span> max       = printer.toolhead.axis_maximum %}</span><br><span class="line">  {% <span class="built_in">set</span> cone      = printer.toolhead.cone_start_z | default(max.z) %} ; height as long the toolhead can reach max and min of an delta</span><br><span class="line">  {% <span class="built_in">set</span> round_bed = True <span class="keyword">if</span> printer.configfile.settings.printer.kinematics is <span class="keyword">in</span> [<span class="string">'delta'</span>,<span class="string">'polar'</span>,<span class="string">'rotary_delta'</span>,<span class="string">'winch'</span>]</span><br><span class="line">                <span class="keyword">else</span> False %}</span><br><span class="line">  <span class="comment">##### define park position #####</span></span><br><span class="line">  {% <span class="built_in">set</span> z_min = params.Z_MIN | default(0) | <span class="built_in">float</span> %}</span><br><span class="line">  {% <span class="built_in">set</span> z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)] | min %}</span><br><span class="line">  {% <span class="built_in">set</span> x_park = params.X       <span class="keyword">if</span> params.X is defined</span><br><span class="line">             <span class="keyword">else</span> custom_park_x  <span class="keyword">if</span> use_custom</span><br><span class="line">             <span class="keyword">else</span> 0.0            <span class="keyword">if</span> round_bed</span><br><span class="line">             <span class="keyword">else</span> (max.x - 5.0) %}</span><br><span class="line">  {% <span class="built_in">set</span> y_park = params.Y       <span class="keyword">if</span> params.Y is defined</span><br><span class="line">             <span class="keyword">else</span> custom_park_y  <span class="keyword">if</span> use_custom</span><br><span class="line">             <span class="keyword">else</span> (max.y - 5.0)  <span class="keyword">if</span> round_bed and z_park &lt; cone</span><br><span class="line">             <span class="keyword">else</span> 0.0            <span class="keyword">if</span> round_bed</span><br><span class="line">             <span class="keyword">else</span> (max.y - 5.0) %}</span><br><span class="line">  <span class="comment">##### end of definitions #####</span></span><br><span class="line">  _CLIENT_RETRACT</span><br><span class="line">  {% <span class="keyword">if</span> <span class="string">"xyz"</span> <span class="keyword">in</span> printer.toolhead.homed_axes %}</span><br><span class="line">    G90</span><br><span class="line">    G1 Z{z_park} F{sp_hop}</span><br><span class="line">    G1 X{x_park} Y{y_park} F{sp_move}</span><br><span class="line">    {% <span class="keyword">if</span> not printer.gcode_move.absolute_coordinates %} G91 {% endif %}</span><br><span class="line">  {% <span class="keyword">else</span> %}</span><br><span class="line">    RESPOND TYPE=<span class="built_in">echo</span> MSG=<span class="string">'Printer not homed'</span></span><br><span class="line">  {% endif %}</span><br><span class="line"></span><br><span class="line">[gcode_macro _CLIENT_EXTRUDE]</span><br><span class="line">description: Extrudes, <span class="keyword">if</span> the extruder is hot enough</span><br><span class="line">gcode:</span><br><span class="line">  <span class="comment">##### get user parameters or use default #####</span></span><br><span class="line">  {% <span class="built_in">set</span> client = printer[<span class="string">'gcode_macro _CLIENT_VARIABLE'</span>] | default({}) %}</span><br><span class="line">  {% <span class="built_in">set</span> use_fw_retract = (client.use_fw_retract | default(<span class="literal">false</span>) | lower == <span class="string">'true'</span>) and (printer.firmware_retraction is defined) %}</span><br><span class="line">  {% <span class="built_in">set</span> length = params.LENGTH | default(client.unretract) | default(1.0) | <span class="built_in">float</span> %}</span><br><span class="line">  {% <span class="built_in">set</span> speed = params.SPEED | default(client.speed_unretract) | default(35) %}</span><br><span class="line">  {% <span class="built_in">set</span> absolute_extrude = printer.gcode_move.absolute_extrude %}</span><br><span class="line">  <span class="comment">##### end of definitions #####</span></span><br><span class="line">  {% <span class="keyword">if</span> printer.toolhead.extruder != <span class="string">''</span> %}</span><br><span class="line">    {% <span class="keyword">if</span> printer[printer.toolhead.extruder].can_extrude %}</span><br><span class="line">      {% <span class="keyword">if</span> use_fw_retract %}</span><br><span class="line">        {% <span class="keyword">if</span> length &lt; 0 %}</span><br><span class="line">          G10</span><br><span class="line">        {% <span class="keyword">else</span> %}</span><br><span class="line">          G11</span><br><span class="line">        {% endif %}</span><br><span class="line">      {% <span class="keyword">else</span> %}</span><br><span class="line">        M83</span><br><span class="line">        G1 E{length} F{(speed | <span class="built_in">float</span> | abs) * 60}</span><br><span class="line">        {% <span class="keyword">if</span> absolute_extrude %}</span><br><span class="line">          M82</span><br><span class="line">        {% endif %}</span><br><span class="line">      {% endif %}</span><br><span class="line">    {% <span class="keyword">else</span> %}</span><br><span class="line">      RESPOND TYPE=<span class="built_in">echo</span> MSG=<span class="string">'{"\"%s\" not hot enough" % printer.toolhead.extruder}'</span></span><br><span class="line">    {% endif %}</span><br><span class="line">  {% endif %}</span><br><span class="line"></span><br><span class="line">[gcode_macro _CLIENT_RETRACT]</span><br><span class="line">description: Retracts, <span class="keyword">if</span> the extruder is hot enough</span><br><span class="line">gcode:</span><br><span class="line">  {% <span class="built_in">set</span> client = printer[<span class="string">'gcode_macro _CLIENT_VARIABLE'</span>] | default({}) %}</span><br><span class="line">  {% <span class="built_in">set</span> length = params.LENGTH | default(client.retract) | default(1.0) | <span class="built_in">float</span> %}</span><br><span class="line">  {% <span class="built_in">set</span> speed = params.SPEED | default(client.speed_retract) | default(35) %}</span><br><span class="line"></span><br><span class="line">  _CLIENT_EXTRUDE LENGTH=-{length | <span class="built_in">float</span> | abs} SPEED={speed | <span class="built_in">float</span> | abs}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="klicky-bed-mesh-calibrate"><a href="#klicky-bed-mesh-calibrate" class="headerlink" title="klicky-bed-mesh-calibrate"></a>klicky-bed-mesh-calibrate</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This macro was provided by discord user Garrettwp to whom i give my thanks for sharing it with me.</span></span><br><span class="line"><span class="comment"># I have tweaked it a lot.</span></span><br><span class="line"><span class="comment"># They are based on the great Annex magprobe dockable probe macros "#Originally developed by Mental,</span></span><br><span class="line"><span class="comment"># modified for better use on K-series printers by RyanG and Trails", kudos to them.</span></span><br><span class="line"><span class="comment"># That macro as since evolved into a klipper plugin that currently is pending inclusion in klipper, </span></span><br><span class="line"><span class="comment"># more information here, https://github.com/Annex-Engineering/Quickdraw_Probe/tree/main/Klipper_Macros</span></span><br><span class="line"><span class="comment"># User richardjm revised the macro variables and added some functions, thanks a lot</span></span><br><span class="line"><span class="comment"># by standing on the shoulders of giants, lets see if we can see further</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># the current home for this version is https://github.com/jlas1/Klicky-Probe </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 有关调平的宏，调平的时候会自动安装和拆卸探针这样，别碰就是了</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###################</span></span><br><span class="line"><span class="comment"># Bed mesh calibrate</span></span><br><span class="line">[gcode_macro BED_MESH_CALIBRATE]</span><br><span class="line">rename_existing: _BED_MESH_CALIBRATE</span><br><span class="line">description: Perform Mesh Bed Leveling with klicky automount</span><br><span class="line">gcode:</span><br><span class="line"></span><br><span class="line">    {% <span class="built_in">set</span> V = printer[<span class="string">"gcode_macro _User_Variables"</span>].verbose %}</span><br><span class="line">    {% <span class="keyword">if</span> V %}</span><br><span class="line">        { action_respond_info(<span class="string">"Bed Mesh Calibrate"</span>) }</span><br><span class="line">    {% endif %}</span><br><span class="line"></span><br><span class="line">    _CheckProbe action=query</span><br><span class="line">	G90</span><br><span class="line">    Attach_Probe</span><br><span class="line"></span><br><span class="line">    _BED_MESH_CALIBRATE {% <span class="keyword">for</span> p <span class="keyword">in</span> params</span><br><span class="line">           %}{<span class="string">'%s=%s '</span> % (p, params[p])}{%</span><br><span class="line">          endfor %}</span><br><span class="line"></span><br><span class="line">    Dock_Probe</span><br></pre></td></tr></tbody></table></figure>

<h2 id="klicky-macros"><a href="#klicky-macros" class="headerlink" title="klicky-macros"></a>klicky-macros</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># discord 大佬 Garrettwp提供给作者的文件</span></span><br><span class="line"><span class="comment"># 作者又做了不少更改</span></span><br><span class="line"><span class="comment"># They are based on the great Annex magprobe dockable probe macros "#Originally developed by Mental,</span></span><br><span class="line"><span class="comment"># modified for better use on K-series printers by RyanG and Trails", kudos to them.</span></span><br><span class="line"><span class="comment"># That macro as since evolved into a klipper plugin that currently is pending inclusion in klipper, </span></span><br><span class="line"><span class="comment"># more information here, https://github.com/Annex-Engineering/Quickdraw_Probe/tree/main/Klipper_Macros</span></span><br><span class="line"><span class="comment"># User richardjm revised the macro variables and added some functions, thanks a lot</span></span><br><span class="line"><span class="comment"># by standing on the shoulders of giants, lets see if we can see further</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># the current home for this version is https://github.com/jlas1/Klicky-Probe </span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 反正就是很多好像好叼的东西然后作者又做了不少的更改~一般没出错的话就别碰这文件就是了</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[respond]</span><br><span class="line"></span><br><span class="line">[gcode_macro _Probe_Variables]</span><br><span class="line">variable_probe_attached:            False</span><br><span class="line">variable_probe_state:               False</span><br><span class="line">variable_probe_lock:                False</span><br><span class="line">variable_z_endstop_x:               0</span><br><span class="line">variable_z_endstop_y:               0</span><br><span class="line">gcode:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#checks if the variable definitions are up to date</span></span><br><span class="line">[gcode_macro _klicky_check_variables_version]</span><br><span class="line">gcode:</span><br><span class="line">    {% <span class="built_in">set</span> version = printer[<span class="string">"gcode_macro _User_Variables"</span>].version|default(0) %}</span><br><span class="line"></span><br><span class="line">    {% <span class="keyword">if</span> version != 1 %}</span><br><span class="line">        { action_raise_error(<span class="string">"Please update your klicky variables, there are some functionality changes"</span>) }</span><br><span class="line">    {% endif %}</span><br><span class="line"></span><br><span class="line">[gcode_macro _exit_point]</span><br><span class="line">gcode:</span><br><span class="line">    {% <span class="built_in">set</span> <span class="keyword">function</span>  = <span class="string">'pre_'</span> ~ params.FUNCTION %}</span><br><span class="line">    {% <span class="built_in">set</span> move  = params.MOVE|default(0) %}</span><br><span class="line">    {% <span class="built_in">set</span> speed = params.SPEED|default(printer[<span class="string">"gcode_macro _User_Variables"</span>].travel_speed) %}</span><br><span class="line">    <span class="comment"># mandatory to save the new safe position</span></span><br><span class="line">    M400</span><br><span class="line">    SET_VELOCITY_LIMIT ACCEL={printer.configfile.settings.printer.max_accel}</span><br><span class="line">    SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}</span><br><span class="line">    RESTORE_GCODE_STATE NAME={<span class="keyword">function</span>} MOVE={move} MOVE_SPEED={speed}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[gcode_macro _entry_point]</span><br><span class="line">gcode:</span><br><span class="line">    {% <span class="built_in">set</span> <span class="keyword">function</span>  = <span class="string">'pre_'</span> ~ params.FUNCTION %}</span><br><span class="line">    {% <span class="built_in">set</span> move_accel = printer[<span class="string">"gcode_macro _User_Variables"</span>].move_accel|default(1000) %}</span><br><span class="line">    <span class="comment"># mandatory to save the new safe position</span></span><br><span class="line">    M400</span><br><span class="line">    SAVE_GCODE_STATE NAME={<span class="keyword">function</span>}</span><br><span class="line">    <span class="comment"># removes the Z offset for better bed based docking</span></span><br><span class="line">    SET_GCODE_OFFSET Z=0</span><br><span class="line">    <span class="comment"># all the macros initially assume absolute positioning</span></span><br><span class="line">    G90</span><br><span class="line">    <span class="comment"># set a safe(sane) Acceleration</span></span><br><span class="line">    SET_VELOCITY_LIMIT ACCEL={move_accel}</span><br><span class="line"></span><br><span class="line">[gcode_macro _Homing_Variables]</span><br><span class="line">gcode:</span><br><span class="line">    {% <span class="built_in">set</span> reset  = params.RESET|default(0) %}</span><br><span class="line">    {% <span class="keyword">if</span> reset %}</span><br><span class="line">        SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_lock VALUE={ False }</span><br><span class="line">    {% endif %}</span><br><span class="line"></span><br><span class="line"><span class="comment">##########################</span></span><br><span class="line"><span class="comment"># Attach probe and lock it</span></span><br><span class="line">[gcode_macro Attach_Probe_Lock]</span><br><span class="line">description: Attaches Klicky Probe, can only be docked after unlocking</span><br><span class="line">gcode:</span><br><span class="line">    Attach_Probe</span><br><span class="line">    _Probe_Lock</span><br><span class="line"></span><br><span class="line"><span class="comment">########################</span></span><br><span class="line"><span class="comment"># Dock probe and lock it</span></span><br><span class="line">[gcode_macro Dock_Probe_Unlock]</span><br><span class="line">description: Docks Klicky Probe even <span class="keyword">if</span> it was locked</span><br><span class="line">gcode:</span><br><span class="line">    _Probe_Unlock</span><br><span class="line">    Dock_Probe</span><br><span class="line"></span><br><span class="line"><span class="comment">##############</span></span><br><span class="line"><span class="comment"># Unlock Probe</span></span><br><span class="line">[gcode_macro _Probe_Unlock]</span><br><span class="line">description: Unlocks Klicky Probe state</span><br><span class="line">gcode:</span><br><span class="line">    SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_lock VALUE={ False }</span><br><span class="line"></span><br><span class="line"><span class="comment">############</span></span><br><span class="line"><span class="comment"># Lock Probe</span></span><br><span class="line">[gcode_macro _Probe_Lock]</span><br><span class="line">description: Locks Klicky Probe state</span><br><span class="line">gcode:</span><br><span class="line">    SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_lock VALUE={ True }</span><br><span class="line"></span><br><span class="line"><span class="comment">######################</span></span><br><span class="line"><span class="comment"># Attach Probe Routine</span></span><br><span class="line">[gcode_macro Attach_Probe]</span><br><span class="line">description: Attaches Klicky Probe</span><br><span class="line">gcode:</span><br><span class="line">    <span class="comment"># See if the position should be restored after the attach</span></span><br><span class="line">    {% <span class="built_in">set</span> goback  = params.BACK|default(0) %}</span><br><span class="line">    <span class="comment"># Get probe attach status</span></span><br><span class="line">    {% <span class="built_in">set</span> probe_attached = printer[<span class="string">"gcode_macro _Probe_Variables"</span>].probe_attached %}</span><br><span class="line">    {% <span class="built_in">set</span> probe_lock = printer[<span class="string">"gcode_macro _Probe_Variables"</span>].probe_lock %}</span><br><span class="line">    {% <span class="built_in">set</span> verbose = printer[<span class="string">"gcode_macro _User_Variables"</span>].verbose %}</span><br><span class="line">    <span class="comment"># Get Docking location</span></span><br><span class="line">    {% <span class="built_in">set</span> dockmove_x = printer[<span class="string">"gcode_macro _User_Variables"</span>].dockmove_x|default(0) %}</span><br><span class="line">    {% <span class="built_in">set</span> dockmove_y = printer[<span class="string">"gcode_macro _User_Variables"</span>].dockmove_y|default(0) %}</span><br><span class="line">    {% <span class="built_in">set</span> dockmove_z = printer[<span class="string">"gcode_macro _User_Variables"</span>].dockmove_z|default(0) %}</span><br><span class="line">    {% <span class="built_in">set</span> docklocation_x = printer[<span class="string">"gcode_macro _User_Variables"</span>].docklocation_x %}</span><br><span class="line">    {% <span class="built_in">set</span> docklocation_y = printer[<span class="string">"gcode_macro _User_Variables"</span>].docklocation_y %}</span><br><span class="line">    {% <span class="built_in">set</span> docklocation_z = printer[<span class="string">"gcode_macro _User_Variables"</span>].docklocation_z %}</span><br><span class="line">    {% <span class="built_in">set</span> attachmove_x = printer[<span class="string">"gcode_macro _User_Variables"</span>].attachmove_x|default(0) %}</span><br><span class="line">    {% <span class="built_in">set</span> attachmove_y = printer[<span class="string">"gcode_macro _User_Variables"</span>].attachmove_y|default(0) %}</span><br><span class="line">    {% <span class="built_in">set</span> attachmove_z = printer[<span class="string">"gcode_macro _User_Variables"</span>].attachmove_z|default(0) %}</span><br><span class="line">    {% <span class="built_in">set</span> attachmove2_x = printer[<span class="string">"gcode_macro _User_Variables"</span>].attachmove2_x|default(0) %}</span><br><span class="line">    {% <span class="built_in">set</span> attachmove2_y = printer[<span class="string">"gcode_macro _User_Variables"</span>].attachmove2_y|default(0) %}</span><br><span class="line">    {% <span class="built_in">set</span> attachmove2_z = printer[<span class="string">"gcode_macro _User_Variables"</span>].attachmove2_z|default(0) %}</span><br><span class="line">    <span class="comment"># Safe Z for travel</span></span><br><span class="line">	{% <span class="built_in">set</span> safe_z = printer[<span class="string">"gcode_macro _User_Variables"</span>].safe_z %}</span><br><span class="line">	{% <span class="built_in">set</span> enable_z_hop = printer[<span class="string">"gcode_macro _User_Variables"</span>].enable_z_hop %}</span><br><span class="line">    <span class="comment"># Set feedrates</span></span><br><span class="line">    {% <span class="built_in">set</span> travel_feedrate = printer[<span class="string">"gcode_macro _User_Variables"</span>].travel_speed * 60 %}</span><br><span class="line">    {% <span class="built_in">set</span> dock_feedrate = printer[<span class="string">"gcode_macro _User_Variables"</span>].dock_speed * 60 %}</span><br><span class="line">    {% <span class="built_in">set</span> release_feedrate = printer[<span class="string">"gcode_macro _User_Variables"</span>].release_speed * 60 %}</span><br><span class="line">    {% <span class="built_in">set</span> z_drop_feedrate = printer[<span class="string">"gcode_macro _User_Variables"</span>].z_drop_speed * 60 %}</span><br><span class="line"></span><br><span class="line">    _entry_point <span class="keyword">function</span>=Attach_Probe</span><br><span class="line"></span><br><span class="line">    <span class="comment"># If there is no undock movement, fail</span></span><br><span class="line">    {% <span class="keyword">if</span> dockmove_x == dockmove_y == dockmove_z == 0 %}</span><br><span class="line">        { action_raise_error(<span class="string">"No dockmove location!! To restore old behavior place 40 in dockmove_x"</span>) }</span><br><span class="line">    {% endif %}</span><br><span class="line">    <span class="comment"># If there is no Attach movement, fail</span></span><br><span class="line">    {% <span class="keyword">if</span> attachmove_x == attachmove_y == attachmove_z == 0 %}</span><br><span class="line">        { action_raise_error(<span class="string">"No attachmove location!!  To restore old behavior place dockarmslenght value in dockmove_x"</span>) }</span><br><span class="line">    {% endif %}</span><br><span class="line"></span><br><span class="line">    <span class="comment"># If x and y are not homed</span></span><br><span class="line">    {% <span class="keyword">if</span> not <span class="string">'xy'</span> <span class="keyword">in</span> printer.toolhead.homed_axes %}</span><br><span class="line">        { action_raise_error(<span class="string">"Must Home X and Y Axis First!"</span>) }</span><br><span class="line"></span><br><span class="line">    <span class="comment"># If probe not attached and locked</span></span><br><span class="line">    {% <span class="keyword">elif</span> not probe_attached and not probe_lock %}</span><br><span class="line">        {% <span class="keyword">if</span> verbose %}</span><br><span class="line">            { action_respond_info(<span class="string">"Attaching Probe"</span>) }</span><br><span class="line">        {% endif %}</span><br><span class="line"></span><br><span class="line">        {% <span class="keyword">if</span> not <span class="string">'z'</span> <span class="keyword">in</span> printer.toolhead.homed_axes %}</span><br><span class="line">            {% <span class="keyword">if</span> verbose %}</span><br><span class="line">                { action_respond_info(<span class="string">"Resetting Z position to zero"</span>) }</span><br><span class="line">            {% endif %}</span><br><span class="line">            SET_KINEMATIC_POSITION Z=0</span><br><span class="line">            {% <span class="keyword">if</span> not enable_z_hop %} <span class="comment"># Disables safe_z</span></span><br><span class="line">                {% <span class="built_in">set</span> safe_z = 0 %}</span><br><span class="line">            {% endif %}</span><br><span class="line">        {% endif %}</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Prior to saving actual position, check if its necessary to move to a safe Z</span></span><br><span class="line">        <span class="comment"># that has enought overhead for the attached probe</span></span><br><span class="line">        {% <span class="keyword">if</span> printer.toolhead.position.z &lt; safe_z %}</span><br><span class="line">            {% <span class="keyword">if</span> verbose %}</span><br><span class="line">                { action_respond_info(<span class="string">"moving to a safe Z distance"</span>) }</span><br><span class="line">            {% endif %}</span><br><span class="line">            G0 Z{safe_z} F{z_drop_feedrate}</span><br><span class="line">        {% endif %}</span><br><span class="line"></span><br><span class="line">        {% <span class="keyword">if</span> not <span class="string">'z'</span> <span class="keyword">in</span> printer.toolhead.homed_axes %}</span><br><span class="line">            {% <span class="keyword">if</span> verbose %}</span><br><span class="line">                { action_respond_info(<span class="string">"Resetting Z position to zero"</span>) }</span><br><span class="line">            {% endif %}</span><br><span class="line">            SET_KINEMATIC_POSITION Z=0</span><br><span class="line">        {% endif %}</span><br><span class="line"></span><br><span class="line">        {% <span class="keyword">if</span> printer.toolhead.position.z &lt; safe_z %}</span><br><span class="line">            G0 Z{safe_z} F{z_drop_feedrate}</span><br><span class="line">        {% endif %}</span><br><span class="line"></span><br><span class="line">        _Umbilical_Path</span><br><span class="line"></span><br><span class="line">        _entry_point <span class="keyword">function</span>=Attach_Probe_intern</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Probe entry location</span></span><br><span class="line">        G0 X{docklocation_x|int - attachmove_x|int - attachmove2_x|int} Y{docklocation_y|int - attachmove_y|int - attachmove2_y} F{travel_feedrate}</span><br><span class="line">        {% <span class="keyword">if</span> docklocation_z != -128 %}</span><br><span class="line">            G0 Z{docklocation_z|int - attachmove_z|int - attachmove2_z|int} F{dock_feedrate}</span><br><span class="line">			G0 Z{docklocation_z|int - attachmove_z|int} F{dock_feedrate}</span><br><span class="line">        {% endif %}</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Drop Probe to Probe location</span></span><br><span class="line">        {% <span class="keyword">if</span> docklocation_z != -128 %}</span><br><span class="line">            G0 Z{docklocation_z} F{dock_feedrate}</span><br><span class="line">        {% endif %}</span><br><span class="line">		G0 X{docklocation_x|int - attachmove2_x|int} Y{docklocation_y|int - attachmove2_y} F{travel_feedrate}</span><br><span class="line">        G0 X{docklocation_x} Y{docklocation_y} F{dock_feedrate}</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Probe Attach</span></span><br><span class="line">        {% <span class="keyword">if</span> docklocation_z != -128 %}</span><br><span class="line">        G0 Z{docklocation_z|int - attachmove_z|int} F{z_drop_feedrate}</span><br><span class="line">        {% endif %}</span><br><span class="line">        G0 X{docklocation_x|int - attachmove_x|int} Y{docklocation_y|int - attachmove_y|int} F{release_feedrate}</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Go to Z safe distance</span></span><br><span class="line">        {% <span class="keyword">if</span> printer.toolhead.position.z &lt; safe_z %}</span><br><span class="line">          G0 Z{safe_z} F{z_drop_feedrate}</span><br><span class="line">        {% endif %}</span><br><span class="line"></span><br><span class="line">        _Park_Toolhead</span><br><span class="line"></span><br><span class="line">        _CheckProbe action=attach</span><br><span class="line"></span><br><span class="line">	_exit_point <span class="keyword">function</span>=Attach_Probe_intern move={goback}</span><br><span class="line"></span><br><span class="line">    {% <span class="keyword">elif</span> probe_lock %}</span><br><span class="line">        {% <span class="keyword">if</span> verbose %}</span><br><span class="line">            { action_respond_info(<span class="string">"Probe locked!"</span>) }</span><br><span class="line">        {% endif %}</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Probe attached, do nothing</span></span><br><span class="line">        _CheckProbe action=query</span><br><span class="line"></span><br><span class="line">    {% <span class="keyword">else</span> %}</span><br><span class="line">        {% <span class="keyword">if</span> verbose %}</span><br><span class="line">            { action_respond_info(<span class="string">"Probe already attached!"</span>) }</span><br><span class="line">        {% endif %}</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Probe attached, do nothing</span></span><br><span class="line">        _CheckProbe action=query</span><br><span class="line"></span><br><span class="line">    {% endif %}</span><br><span class="line"></span><br><span class="line">    _exit_point <span class="keyword">function</span>=Attach_Probe</span><br><span class="line"></span><br><span class="line"><span class="comment">####################</span></span><br><span class="line"><span class="comment"># Dock Probe Routine</span></span><br><span class="line">[gcode_macro Dock_Probe]</span><br><span class="line">description: Docks Klicky Probe</span><br><span class="line">gcode:</span><br><span class="line">	<span class="comment"># See if the position should be restored after the dock</span></span><br><span class="line">    {% <span class="built_in">set</span> goback  = params.back|default(0) %}</span><br><span class="line">    <span class="comment"># Get probe attach status</span></span><br><span class="line">    {% <span class="built_in">set</span> probe_attached = printer[<span class="string">"gcode_macro _Probe_Variables"</span>].probe_attached %}</span><br><span class="line">    {% <span class="built_in">set</span> probe_lock = printer[<span class="string">"gcode_macro _Probe_Variables"</span>].probe_lock %}</span><br><span class="line">    {% <span class="built_in">set</span> verbose = printer[<span class="string">"gcode_macro _User_Variables"</span>].verbose %}</span><br><span class="line">    <span class="comment"># Get Docking location</span></span><br><span class="line">    {% <span class="built_in">set</span> dockmove_x = printer[<span class="string">"gcode_macro _User_Variables"</span>].dockmove_x|default(0) %}</span><br><span class="line">    {% <span class="built_in">set</span> dockmove_y = printer[<span class="string">"gcode_macro _User_Variables"</span>].dockmove_y|default(0) %}</span><br><span class="line">    {% <span class="built_in">set</span> dockmove_z = printer[<span class="string">"gcode_macro _User_Variables"</span>].dockmove_z|default(0) %}</span><br><span class="line">    {% <span class="built_in">set</span> docklocation_x = printer[<span class="string">"gcode_macro _User_Variables"</span>].docklocation_x %}</span><br><span class="line">    {% <span class="built_in">set</span> docklocation_y = printer[<span class="string">"gcode_macro _User_Variables"</span>].docklocation_y %}</span><br><span class="line">    {% <span class="built_in">set</span> docklocation_z = printer[<span class="string">"gcode_macro _User_Variables"</span>].docklocation_z %}</span><br><span class="line">    {% <span class="built_in">set</span> attachmove_x = printer[<span class="string">"gcode_macro _User_Variables"</span>].attachmove_x|default(0) %}</span><br><span class="line">    {% <span class="built_in">set</span> attachmove_y = printer[<span class="string">"gcode_macro _User_Variables"</span>].attachmove_y|default(0) %}</span><br><span class="line">    {% <span class="built_in">set</span> attachmove_z = printer[<span class="string">"gcode_macro _User_Variables"</span>].attachmove_z|default(0) %}</span><br><span class="line">    <span class="comment"># Safe Z for travel</span></span><br><span class="line">    {% <span class="built_in">set</span> safe_z = printer[<span class="string">"gcode_macro _User_Variables"</span>].safe_z|<span class="built_in">float</span> %}</span><br><span class="line">    <span class="comment"># Set feedrates</span></span><br><span class="line">    {% <span class="built_in">set</span> travel_feedrate = printer[<span class="string">"gcode_macro _User_Variables"</span>].travel_speed * 60 %}</span><br><span class="line">    {% <span class="built_in">set</span> dock_feedrate = printer[<span class="string">"gcode_macro _User_Variables"</span>].dock_speed * 60 %}</span><br><span class="line">    {% <span class="built_in">set</span> release_feedrate = printer[<span class="string">"gcode_macro _User_Variables"</span>].release_speed * 60 %}</span><br><span class="line">    {% <span class="built_in">set</span> z_drop_feedrate = printer[<span class="string">"gcode_macro _User_Variables"</span>].z_drop_speed * 60 %}</span><br><span class="line"></span><br><span class="line">    <span class="comment"># If there is no undock movement, fail</span></span><br><span class="line">    {% <span class="keyword">if</span> dockmove_x == dockmove_y == dockmove_z == 0 %}</span><br><span class="line">        { action_raise_error(<span class="string">"No dockmove location!! To restore old behavior place 40 in dockmove_x"</span>) }</span><br><span class="line">    {% endif %}</span><br><span class="line">    <span class="comment"># If there is no Attach movement, fail</span></span><br><span class="line">    {% <span class="keyword">if</span> attachmove_x == attachmove_y == attachmove_z == 0 %}</span><br><span class="line">        { action_raise_error(<span class="string">"No attachmove location!!  To restore old behavior place dockarmslenght value in dockmove_x"</span>) }</span><br><span class="line">    {% endif %}</span><br><span class="line"></span><br><span class="line">    <span class="comment"># If axis aren't homed, fail</span></span><br><span class="line">    {% <span class="keyword">if</span> not <span class="string">'xyz'</span> <span class="keyword">in</span> printer.toolhead.homed_axes %}</span><br><span class="line">        { action_raise_error(<span class="string">"Must Home X, Y and Z Axis First!"</span>) }</span><br><span class="line">    {% endif %}</span><br><span class="line"></span><br><span class="line">    _entry_point <span class="keyword">function</span>=Dock_Probe</span><br><span class="line"></span><br><span class="line">    <span class="comment"># If probe not attached and not locked</span></span><br><span class="line">    {% <span class="keyword">if</span> probe_attached and not probe_lock %}</span><br><span class="line">        {% <span class="keyword">if</span> verbose %}</span><br><span class="line">            { action_respond_info(<span class="string">"Docking Probe"</span>) }</span><br><span class="line">        {% endif %}</span><br><span class="line"></span><br><span class="line">        {% <span class="keyword">if</span> printer.toolhead.position.z &lt; safe_z %}</span><br><span class="line">            G0 Z{safe_z} F{z_drop_feedrate}</span><br><span class="line">        {% endif %}</span><br><span class="line"></span><br><span class="line">        _Umbilical_Path</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Probe entry location</span></span><br><span class="line">        G0 X{docklocation_x|int - attachmove_x|int} Y{docklocation_y|int - attachmove_y|int} F{travel_feedrate}</span><br><span class="line">        {% <span class="keyword">if</span> docklocation_z != -128 %}</span><br><span class="line">            G0 Z{docklocation_z|int - attachmove_z|int} F{dock_feedrate}</span><br><span class="line">        {% endif %}</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Drop Probe to Probe location</span></span><br><span class="line">        G0 X{docklocation_x} Y{docklocation_y} F{dock_feedrate}</span><br><span class="line">        {% <span class="keyword">if</span> docklocation_z != -128 %}</span><br><span class="line">            G0 Z{docklocation_z} F{dock_feedrate}</span><br><span class="line">        {% endif %}</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Probe decoupling</span></span><br><span class="line">        {% <span class="keyword">if</span> docklocation_z != -128 %}</span><br><span class="line">            G0 Z{docklocation_z|int + dockmove_z|int} F{release_feedrate}</span><br><span class="line">        {% endif %}</span><br><span class="line">        G0 X{docklocation_x|int + dockmove_x|int} Y{docklocation_y|int + dockmove_y|int} F{release_feedrate}</span><br><span class="line">        G0 X{docklocation_x|int + dockmove_x|int - attachmove_x|int} Y{docklocation_y|int + dockmove_y|int - attachmove_y|int} F{release_feedrate}</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Go to Z safe distance</span></span><br><span class="line">        {% <span class="keyword">if</span> printer.toolhead.position.z &lt; safe_z %}</span><br><span class="line">          G0 Z{safe_z} F{z_drop_feedrate}</span><br><span class="line">        {% endif %}</span><br><span class="line"></span><br><span class="line">        _Park_Toolhead</span><br><span class="line"></span><br><span class="line">        G4 P1000</span><br><span class="line">        _CheckProbe action=dock</span><br><span class="line"></span><br><span class="line">    {% <span class="keyword">elif</span> probe_lock %}</span><br><span class="line">        {% <span class="keyword">if</span> verbose %}</span><br><span class="line">            { action_respond_info(<span class="string">"Probe locked"</span>) }</span><br><span class="line">        {% endif %}</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Probe docked, do nothing</span></span><br><span class="line">        _CheckProbe action=query</span><br><span class="line"></span><br><span class="line">    {% <span class="keyword">else</span> %}</span><br><span class="line">        {% <span class="keyword">if</span> verbose %}</span><br><span class="line">            { action_respond_info(<span class="string">"Probe already docked"</span>) }</span><br><span class="line">        {% endif %}</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Probe docked, do nothing</span></span><br><span class="line">        _CheckProbe action=query</span><br><span class="line"></span><br><span class="line">    {% endif %}</span><br><span class="line"></span><br><span class="line">    _exit_point <span class="keyword">function</span>=Dock_Probe move={goback}</span><br><span class="line"></span><br><span class="line"><span class="comment">#################</span></span><br><span class="line"><span class="comment"># Probe Calibrate</span></span><br><span class="line">[gcode_macro PROBE_CALIBRATE]</span><br><span class="line">rename_existing: _PROBE_CALIBRATE</span><br><span class="line">description:Calibrate the probes z_offset with klicky automount</span><br><span class="line">gcode:</span><br><span class="line">    {% <span class="built_in">set</span> safe_z = printer[<span class="string">"gcode_macro _User_Variables"</span>].safe_z|<span class="built_in">float</span> %}</span><br><span class="line">    {% <span class="built_in">set</span> z_drop_feedrate = printer[<span class="string">"gcode_macro _User_Variables"</span>].z_drop_speed * 60 %}</span><br><span class="line">    {% <span class="built_in">set</span> travel_feedrate = printer[<span class="string">"gcode_macro _User_Variables"</span>].travel_speed %}</span><br><span class="line">    {% <span class="built_in">set</span> max_x = printer[<span class="string">"gcode_macro _User_Variables"</span>].max_bed_x %}</span><br><span class="line">    {% <span class="built_in">set</span> max_y = printer[<span class="string">"gcode_macro _User_Variables"</span>].max_bed_y %}</span><br><span class="line">    {% <span class="built_in">set</span> probe_offset_x = printer[<span class="string">'configfile'</span>].config[<span class="string">"probe"</span>][<span class="string">"x_offset"</span>]|<span class="built_in">float</span> %}</span><br><span class="line">    {% <span class="built_in">set</span> probe_offset_y = printer[<span class="string">'configfile'</span>].config[<span class="string">"probe"</span>][<span class="string">"y_offset"</span>]|<span class="built_in">float</span> %}</span><br><span class="line"></span><br><span class="line">    {% <span class="keyword">if</span> not <span class="string">'xyz'</span> <span class="keyword">in</span> printer.toolhead.homed_axes %}</span><br><span class="line">        { action_raise_error(<span class="string">"Must Home X, Y and Z Axis First!"</span>) }</span><br><span class="line">    {% endif %}</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Protect against PROBE CALIBRATE performed from outside the bed</span></span><br><span class="line">    {% <span class="keyword">if</span> printer[<span class="string">'gcode_move'</span>].position.y &gt; (max_y - probe_offset_y)</span><br><span class="line">          or printer[<span class="string">'gcode_move'</span>].position.y &lt; probe_offset_y</span><br><span class="line">          or printer[<span class="string">'gcode_move'</span>].position.x &gt; (max_x - probe_offset_x)</span><br><span class="line">          or printer[<span class="string">'gcode_move'</span>].position.x &lt; probe_offset_x %}</span><br><span class="line">      { action_raise_error(<span class="string">"Must perform PROBE_CALIBRATE with the probe above the BED!"</span>) }</span><br><span class="line">    {% endif%}</span><br><span class="line"></span><br><span class="line">    _CheckProbe action=query</span><br><span class="line">    G90</span><br><span class="line">    Attach_Probe back=1</span><br><span class="line"></span><br><span class="line">    _PROBE_CALIBRATE {% <span class="keyword">for</span> p <span class="keyword">in</span> params</span><br><span class="line">            %}{<span class="string">'%s=%s '</span> % (p, params[p])}{%</span><br><span class="line">           endfor %}</span><br><span class="line"></span><br><span class="line">    M118 moving the toolhead 20 mm from the bed</span><br><span class="line">    TESTZ Z=20</span><br><span class="line">    M118 remove manually the probe and <span class="built_in">continue</span> calibration</span><br><span class="line"></span><br><span class="line"><span class="comment">################</span></span><br><span class="line"><span class="comment"># Probe Accuracy</span></span><br><span class="line">[gcode_macro PROBE_ACCURACY]</span><br><span class="line">rename_existing: _PROBE_ACCURACY</span><br><span class="line">description:Probe Z-height accuracy at current XY position with klicky automount</span><br><span class="line">gcode:</span><br><span class="line">    {% <span class="built_in">set</span> safe_z = printer[<span class="string">"gcode_macro _User_Variables"</span>].safe_z|<span class="built_in">float</span> %}</span><br><span class="line">    {% <span class="built_in">set</span> z_drop_feedrate = printer[<span class="string">"gcode_macro _User_Variables"</span>].z_drop_speed * 60 %}</span><br><span class="line">    {% <span class="built_in">set</span> travel_feedrate = printer[<span class="string">"gcode_macro _User_Variables"</span>].travel_speed %}</span><br><span class="line">    {% <span class="built_in">set</span> max_x = printer[<span class="string">"gcode_macro _User_Variables"</span>].max_bed_x %}</span><br><span class="line">    {% <span class="built_in">set</span> max_y = printer[<span class="string">"gcode_macro _User_Variables"</span>].max_bed_y %}</span><br><span class="line">    {% <span class="built_in">set</span> probe_offset_x = printer[<span class="string">'configfile'</span>].config[<span class="string">"probe"</span>][<span class="string">"x_offset"</span>]|<span class="built_in">float</span> %}</span><br><span class="line">    {% <span class="built_in">set</span> probe_offset_y = printer[<span class="string">'configfile'</span>].config[<span class="string">"probe"</span>][<span class="string">"y_offset"</span>]|<span class="built_in">float</span> %}</span><br><span class="line"></span><br><span class="line">    {% <span class="keyword">if</span> not <span class="string">'xyz'</span> <span class="keyword">in</span> printer.toolhead.homed_axes %}</span><br><span class="line">        { action_raise_error(<span class="string">"Must Home X, Y and Z Axis First!"</span>) }</span><br><span class="line">    {% endif %}</span><br><span class="line"></span><br><span class="line">    _entry_point <span class="keyword">function</span>=PROBE_ACCURACY</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Protect against PROBE_ACCURACY performed from outside the bed</span></span><br><span class="line">    {% <span class="keyword">if</span> printer[<span class="string">'gcode_move'</span>].position.y &gt; (max_y - probe_offset_y)</span><br><span class="line">          or printer[<span class="string">'gcode_move'</span>].position.y &lt; probe_offset_y</span><br><span class="line">          or printer[<span class="string">'gcode_move'</span>].position.x &gt; (max_x - probe_offset_x)</span><br><span class="line">          or printer[<span class="string">'gcode_move'</span>].position.x &lt; probe_offset_x %}</span><br><span class="line">      { action_raise_error(<span class="string">"Must perform PROBE_ACCURACY with the probe above the BED!"</span>) }</span><br><span class="line">    {% endif%}</span><br><span class="line"></span><br><span class="line">    _CheckProbe action=query</span><br><span class="line">    Attach_Probe back=1</span><br><span class="line"></span><br><span class="line">    _PROBE_ACCURACY {% <span class="keyword">for</span> p <span class="keyword">in</span> params</span><br><span class="line">            %}{<span class="string">'%s=%s '</span> % (p, params[p])}{%</span><br><span class="line">           endfor %}</span><br><span class="line"></span><br><span class="line">    Dock_Probe back=1										   </span><br><span class="line"></span><br><span class="line">    _exit_point <span class="keyword">function</span>=PROBE_ACCURACY move=1</span><br><span class="line"></span><br><span class="line"><span class="comment">#############################################</span></span><br><span class="line"><span class="comment"># Enable to SET_KINEMATIC_POSITION for Z hop</span></span><br><span class="line">[force_move]</span><br><span class="line">enable_force_move: True</span><br><span class="line"></span><br><span class="line"><span class="comment">#################</span></span><br><span class="line"><span class="comment"># Homing Override</span></span><br><span class="line">[homing_override]</span><br><span class="line">axes: xyz</span><br><span class="line">gcode:</span><br><span class="line">    <span class="comment"># collect user state variables</span></span><br><span class="line">    _User_Variables</span><br><span class="line">    {% <span class="built_in">set</span> verbose = printer[<span class="string">"gcode_macro _User_Variables"</span>].verbose %}</span><br><span class="line">    {% <span class="built_in">set</span> safe_z = printer[<span class="string">"gcode_macro _User_Variables"</span>].safe_z|<span class="built_in">float</span> %}</span><br><span class="line">    <span class="comment"># Safe Z for travel</span></span><br><span class="line">    {% <span class="built_in">set</span> safe_z = printer[<span class="string">"gcode_macro _User_Variables"</span>].safe_z %}</span><br><span class="line">    {% <span class="built_in">set</span> enable_z_hop = printer[<span class="string">"gcode_macro _User_Variables"</span>].enable_z_hop %}</span><br><span class="line">    {% <span class="built_in">set</span> attachmove_x = printer[<span class="string">"gcode_macro _User_Variables"</span>].attachmove_x|default(0) %}</span><br><span class="line">    {% <span class="built_in">set</span> attachmove_y = printer[<span class="string">"gcode_macro _User_Variables"</span>].attachmove_y|default(0) %}</span><br><span class="line">    {% <span class="built_in">set</span> attachmove_z = printer[<span class="string">"gcode_macro _User_Variables"</span>].attachmove_z|default(0) %}</span><br><span class="line">    {% <span class="built_in">set</span> z_drop_feedrate = printer[<span class="string">"gcode_macro _User_Variables"</span>].z_drop_speed * 60 %}</span><br><span class="line"></span><br><span class="line">    <span class="comment">#checks if the variable definitions are up to date</span></span><br><span class="line">    _klicky_check_variables_version</span><br><span class="line"></span><br><span class="line">    <span class="comment"># if there is no Attach movement, fail</span></span><br><span class="line">    {% <span class="keyword">if</span> attachmove_x == attachmove_y == attachmove_z == 0 %}</span><br><span class="line">        { action_raise_error(<span class="string">"No attachmove location!"</span>) }</span><br><span class="line">    {% endif %}</span><br><span class="line"></span><br><span class="line">    _CheckProbe action=query</span><br><span class="line"></span><br><span class="line">    <span class="comment"># reset parameters</span></span><br><span class="line">    {% <span class="built_in">set</span> home_x, home_y, home_z, leave_probe_attached = False, False, False, False %}</span><br><span class="line"></span><br><span class="line">    {% <span class="keyword">if</span> <span class="string">'PROBE_LOCK'</span> <span class="keyword">in</span> params%}</span><br><span class="line">        {% <span class="keyword">if</span> verbose %}</span><br><span class="line">            { action_respond_info(<span class="string">"PROBE_LOCK = True"</span>) }</span><br><span class="line">        {% endif %}</span><br><span class="line">        {% <span class="built_in">set</span> leave_probe_attached = True %}</span><br><span class="line">    {% endif %}</span><br><span class="line"></span><br><span class="line">    <span class="comment"># which axes have been requested for homing</span></span><br><span class="line">    {% <span class="keyword">if</span> not <span class="string">'X'</span> <span class="keyword">in</span> params</span><br><span class="line">        and not <span class="string">'Y'</span> <span class="keyword">in</span> params</span><br><span class="line">        and not <span class="string">'Z'</span> <span class="keyword">in</span> params %}</span><br><span class="line"></span><br><span class="line">        {% <span class="built_in">set</span> home_x, home_y, home_z = True, True, True %}</span><br><span class="line"></span><br><span class="line">    {% <span class="keyword">else</span> %}</span><br><span class="line">        <span class="comment"># Frame mount x-endstop - home Y before X</span></span><br><span class="line">        {% <span class="keyword">if</span> <span class="string">'X'</span> <span class="keyword">in</span> params %}</span><br><span class="line">            {% <span class="built_in">set</span> home_x = True %}</span><br><span class="line">        {% endif %}</span><br><span class="line"></span><br><span class="line">        {% <span class="keyword">if</span> <span class="string">'Y'</span> <span class="keyword">in</span> params %}</span><br><span class="line">            {% <span class="built_in">set</span> home_y = True %}</span><br><span class="line">        {% endif %}</span><br><span class="line"></span><br><span class="line">        {% <span class="keyword">if</span> <span class="string">'Z'</span> <span class="keyword">in</span> params %}</span><br><span class="line">            {% <span class="built_in">set</span> home_z = True %}</span><br><span class="line">        {% endif %}</span><br><span class="line"></span><br><span class="line">        {% <span class="keyword">if</span> <span class="string">'X'</span> <span class="keyword">in</span> params</span><br><span class="line">          and <span class="string">'Y'</span> <span class="keyword">in</span> params</span><br><span class="line">          and <span class="string">'Z'</span> <span class="keyword">in</span> params %}</span><br><span class="line">            <span class="comment"># reset homing state variables</span></span><br><span class="line">            <span class="comment"># if homing all axes</span></span><br><span class="line">            _Homing_Variables reset=1</span><br><span class="line">         {% endif %}</span><br><span class="line"></span><br><span class="line">    {% endif %}</span><br><span class="line"></span><br><span class="line">    _entry_point <span class="keyword">function</span>=homing_override</span><br><span class="line"></span><br><span class="line">    <span class="comment"># if Z is not homed, do not move the bed if it goes down</span></span><br><span class="line">    {% <span class="keyword">if</span> <span class="string">'z'</span> not <span class="keyword">in</span> printer.toolhead.homed_axes %}</span><br><span class="line">         {% <span class="keyword">if</span> not enable_z_hop %} <span class="comment"># Disables safe_z</span></span><br><span class="line">            {% <span class="built_in">set</span> safe_z = 0 %}</span><br><span class="line">        {% endif %}</span><br><span class="line">    {% endif %}</span><br><span class="line"></span><br><span class="line">    {% <span class="keyword">if</span> home_z %}</span><br><span class="line">        {% <span class="keyword">if</span> <span class="string">'z'</span> <span class="keyword">in</span> printer.toolhead.homed_axes %}</span><br><span class="line">            {% <span class="keyword">if</span> printer.toolhead.position.z &lt; safe_z %}</span><br><span class="line">                {% <span class="keyword">if</span> verbose %}</span><br><span class="line">                    { action_respond_info(<span class="string">"Z too low, performing ZHOP"</span>) }</span><br><span class="line">                {% endif %}</span><br><span class="line">                G0 Z{safe_z} F{z_drop_feedrate}</span><br><span class="line">            {% endif %}</span><br><span class="line">        {% <span class="keyword">else</span> %}</span><br><span class="line">            {% <span class="keyword">if</span> verbose %}</span><br><span class="line">                { action_respond_info(<span class="string">"Z not homed, forcing full G28"</span>) }</span><br><span class="line">            {% endif %}</span><br><span class="line">            SET_KINEMATIC_POSITION X=0 Y=0 Z=0</span><br><span class="line">            G0 Z{safe_z} F{z_drop_feedrate}</span><br><span class="line">            {% <span class="built_in">set</span> home_x, home_y, home_z = True, True, True %}</span><br><span class="line">        {% endif %}</span><br><span class="line">    {% endif %}</span><br><span class="line"></span><br><span class="line">    <span class="comment"># if the dock is oriented on the Y, first do Y endstop</span></span><br><span class="line">    {% <span class="keyword">if</span> attachmove_y == 0 %}</span><br><span class="line">        <span class="comment"># Home y</span></span><br><span class="line">        {% <span class="keyword">if</span> home_y %}</span><br><span class="line">            {% <span class="keyword">if</span> verbose %}</span><br><span class="line">                { action_respond_info(<span class="string">"Homing Y"</span>) }</span><br><span class="line">            {% endif %}</span><br><span class="line">            G28 Y0</span><br><span class="line">        {% endif %}</span><br><span class="line">        {% <span class="built_in">set</span> home_y = False %}</span><br><span class="line">    {% endif %}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Home x</span></span><br><span class="line">    {% <span class="keyword">if</span> home_x %}</span><br><span class="line">        {% <span class="keyword">if</span> verbose %}</span><br><span class="line">            { action_respond_info(<span class="string">"Homing X"</span>) }</span><br><span class="line">        {% endif %}</span><br><span class="line">        G28 X0</span><br><span class="line">    {% endif %}</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Home y</span></span><br><span class="line">    {% <span class="keyword">if</span> home_y %}</span><br><span class="line">        {% <span class="keyword">if</span> verbose %}</span><br><span class="line">            { action_respond_info(<span class="string">"Homing Y"</span>) }</span><br><span class="line">        {% endif %}</span><br><span class="line">        G28 Y0</span><br><span class="line">    {% endif %}</span><br><span class="line">    <span class="comment"># Home z</span></span><br><span class="line">    {% <span class="keyword">if</span> home_z %}</span><br><span class="line">        {% <span class="keyword">if</span> verbose %}</span><br><span class="line">            { action_respond_info(<span class="string">"Homing Z"</span>) }</span><br><span class="line">        {% endif %}</span><br><span class="line"></span><br><span class="line">        <span class="comment"># if probe is configured as endstop, attach it, else dock the probe if attached</span></span><br><span class="line">        {% <span class="keyword">if</span> printer[<span class="string">'configfile'</span>].config[<span class="string">"stepper_z"</span>][<span class="string">"endstop_pin"</span>] == <span class="string">'probe:z_virtual_endstop'</span> %}</span><br><span class="line">            Attach_Probe</span><br><span class="line">            <span class="comment"># if PROBE_LOCK parameter is given, Attach Probe and lock until it´s unlocked</span></span><br><span class="line">            {% <span class="keyword">if</span> leave_probe_attached %}</span><br><span class="line">                _Probe_Lock</span><br><span class="line">            {% endif %}</span><br><span class="line">        {% <span class="keyword">else</span> %}</span><br><span class="line">            Dock_Probe</span><br><span class="line">        {% endif %}</span><br><span class="line"></span><br><span class="line">        _Home_Z</span><br><span class="line"></span><br><span class="line">        <span class="comment"># if probe is configured as endstop, dock it</span></span><br><span class="line">        {% <span class="keyword">if</span> printer[<span class="string">'configfile'</span>].config[<span class="string">"stepper_z"</span>][<span class="string">"endstop_pin"</span>] == <span class="string">'probe:z_virtual_endstop'</span> %}</span><br><span class="line">            Dock_Probe</span><br><span class="line">        {% endif %}</span><br><span class="line">    {% endif %}</span><br><span class="line">    _CheckProbe action=query</span><br><span class="line"></span><br><span class="line">    <span class="comment"># park the toolhead</span></span><br><span class="line">    _Park_Toolhead</span><br><span class="line"></span><br><span class="line">    _exit_point <span class="keyword">function</span>=homing_override</span><br><span class="line"></span><br><span class="line"><span class="comment"># Umbilical path setup</span></span><br><span class="line">[gcode_macro _Umbilical_Path]</span><br><span class="line">gcode:</span><br><span class="line">    {% <span class="built_in">set</span> umbilical = printer[<span class="string">"gcode_macro _User_Variables"</span>].umbilical %}</span><br><span class="line">    {% <span class="built_in">set</span> umbilical_x = printer[<span class="string">"gcode_macro _User_Variables"</span>].umbilical_x %}</span><br><span class="line">    {% <span class="built_in">set</span> umbilical_y = printer[<span class="string">"gcode_macro _User_Variables"</span>].umbilical_y %}</span><br><span class="line">    {% <span class="built_in">set</span> safe_z = printer[<span class="string">"gcode_macro _User_Variables"</span>].safe_z|<span class="built_in">float</span> %}</span><br><span class="line">    {% <span class="built_in">set</span> travel_feedrate = printer[<span class="string">"gcode_macro _User_Variables"</span>].travel_speed * 60 %}</span><br><span class="line"></span><br><span class="line">    {% <span class="keyword">if</span> umbilical %}</span><br><span class="line">        <span class="comment"># Used to give the umbilical a better path to follow and coil properly if dock is tight in space</span></span><br><span class="line">        _entry_point <span class="keyword">function</span>=Umbilical_Path</span><br><span class="line"></span><br><span class="line">        G0 X{umbilical_x} Y{umbilical_y} Z{safe_z} F{travel_feedrate}</span><br><span class="line"></span><br><span class="line">        _exit_point <span class="keyword">function</span>=Umbilical_Path</span><br><span class="line">    {% endif %}</span><br><span class="line"></span><br><span class="line"><span class="comment"># Home Z Routine</span></span><br><span class="line">[gcode_macro _Home_Z]</span><br><span class="line">gcode:</span><br><span class="line">    {% <span class="built_in">set</span> z_endstop_x = printer[<span class="string">"gcode_macro _Probe_Variables"</span>].z_endstop_x %}</span><br><span class="line">    {% <span class="built_in">set</span> z_endstop_y = printer[<span class="string">"gcode_macro _Probe_Variables"</span>].z_endstop_y %}</span><br><span class="line">    {% <span class="built_in">set</span> safe_z = printer[<span class="string">"gcode_macro _User_Variables"</span>].safe_z|<span class="built_in">float</span> %}</span><br><span class="line">    {% <span class="built_in">set</span> travel_feedrate = printer[<span class="string">"gcode_macro _User_Variables"</span>].travel_speed * 60 %}</span><br><span class="line">    {% <span class="built_in">set</span> z_drop_feedrate = printer[<span class="string">"gcode_macro _User_Variables"</span>].z_drop_speed * 60 %}</span><br><span class="line">    {% <span class="built_in">set</span> verbose = printer[<span class="string">"gcode_macro _User_Variables"</span>].verbose %}</span><br><span class="line"></span><br><span class="line">    _entry_point <span class="keyword">function</span>=Home_Z</span><br><span class="line"></span><br><span class="line">    <span class="comment"># if x and y are not homed yet, raise error</span></span><br><span class="line">    {% <span class="keyword">if</span> not <span class="string">'xy'</span> <span class="keyword">in</span> printer.toolhead.homed_axes %}</span><br><span class="line">        { action_raise_error(<span class="string">"Must Home X and Y Axis First!"</span>) }</span><br><span class="line">    {% <span class="keyword">else</span> %}</span><br><span class="line">        {% <span class="keyword">if</span> not <span class="string">'z'</span> <span class="keyword">in</span> printer.toolhead.homed_axes %}</span><br><span class="line">            {% <span class="keyword">if</span> verbose %}</span><br><span class="line">                { action_respond_info(<span class="string">"Resetting Z position to zero"</span>) }</span><br><span class="line">            {% endif %}</span><br><span class="line">            SET_KINEMATIC_POSITION Z=0</span><br><span class="line">        {% endif %}</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Move tool to safe homing position and home Z axis</span></span><br><span class="line">        <span class="comment"># location of z endstop</span></span><br><span class="line">        G0 X{z_endstop_x} Y{z_endstop_y} F{travel_feedrate}</span><br><span class="line">        G28 Z0</span><br><span class="line">        G0 Z{safe_z} F{z_drop_feedrate}</span><br><span class="line">    {% endif %}</span><br><span class="line"></span><br><span class="line">    _exit_point <span class="keyword">function</span>=Home_Z</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check to see if probe is where it is supposed to be after</span></span><br><span class="line"><span class="comment"># attaching/docking maneuver and set homing error or shutdown</span></span><br><span class="line">[gcode_macro _CheckProbe]</span><br><span class="line">variable_probe_state: 0</span><br><span class="line">gcode:</span><br><span class="line">    Query_Probe</span><br><span class="line">    _SetProbeState action={ params.ACTION }</span><br><span class="line"></span><br><span class="line"><span class="comment"># Due to how templates are evaluated, we have query endstops in one</span></span><br><span class="line"><span class="comment"># macro and call another macro to make decisions based on the result</span></span><br><span class="line">[gcode_macro _SetProbeState]</span><br><span class="line">gcode:</span><br><span class="line">    {% <span class="built_in">set</span> query_probe_triggered = printer.probe.last_query %}</span><br><span class="line">    {% <span class="built_in">set</span> action  = params.ACTION|default(<span class="string">''</span>) %}</span><br><span class="line"></span><br><span class="line">    <span class="comment"># If triggered (true), probe not attached</span></span><br><span class="line">    {% <span class="keyword">if</span> query_probe_triggered %}</span><br><span class="line">        SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_attached VALUE={ False }</span><br><span class="line">    {% <span class="keyword">else</span> %}</span><br><span class="line">        <span class="comment"># If not triggered (false), probe attached</span></span><br><span class="line">        SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_attached VALUE={ True }</span><br><span class="line">    {% endif %}</span><br><span class="line"></span><br><span class="line">    {% <span class="keyword">if</span> action == <span class="string">'query'</span> %}</span><br><span class="line">          SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_state VALUE={ query_probe_triggered }</span><br><span class="line">    {% endif %}</span><br><span class="line"></span><br><span class="line">    <span class="comment"># If probe fails to attach/detach</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># If not docked</span></span><br><span class="line">    {% <span class="keyword">if</span> not query_probe_triggered and action == <span class="string">'dock'</span> %}</span><br><span class="line">        { action_raise_error(<span class="string">"Probe dock failed!"</span>) }</span><br><span class="line">    {% endif %}</span><br><span class="line"></span><br><span class="line">    <span class="comment"># If not attached</span></span><br><span class="line">    {% <span class="keyword">if</span> query_probe_triggered and action == <span class="string">'attach'</span> %}</span><br><span class="line">        { action_raise_error(<span class="string">"Probe attach failed!"</span>) }</span><br><span class="line">    {% endif %}</span><br><span class="line"></span><br><span class="line"><span class="comment"># Park Toolhead Routine</span></span><br><span class="line">[gcode_macro _Park_Toolhead]</span><br><span class="line">gcode:</span><br><span class="line">    {% <span class="built_in">set</span> park_toolhead = printer[<span class="string">"gcode_macro _User_Variables"</span>].park_toolhead %}</span><br><span class="line">    {% <span class="built_in">set</span> parkposition_x = printer[<span class="string">"gcode_macro _User_Variables"</span>].parkposition_x %}</span><br><span class="line">    {% <span class="built_in">set</span> parkposition_y = printer[<span class="string">"gcode_macro _User_Variables"</span>].parkposition_y %}</span><br><span class="line">    {% <span class="built_in">set</span> parkposition_z = printer[<span class="string">"gcode_macro _User_Variables"</span>].parkposition_z %}</span><br><span class="line">    {% <span class="built_in">set</span> travel_feedrate = printer[<span class="string">"gcode_macro _User_Variables"</span>].travel_speed * 60 %}</span><br><span class="line">    {% <span class="built_in">set</span> verbose = printer[<span class="string">"gcode_macro _User_Variables"</span>].verbose %}</span><br><span class="line"></span><br><span class="line">    _entry_point <span class="keyword">function</span>=Park_Toolhead</span><br><span class="line"></span><br><span class="line">    {% <span class="keyword">if</span> park_toolhead and <span class="string">'xyz'</span> <span class="keyword">in</span> printer.toolhead.homed_axes %}</span><br><span class="line">        {% <span class="keyword">if</span> verbose %}</span><br><span class="line">            { action_respond_info(<span class="string">"Parking Toolhead"</span>) }</span><br><span class="line">        {% endif %}</span><br><span class="line">        G0 X{parkposition_x} Y{parkposition_y} Z{parkposition_z} F{travel_feedrate}</span><br><span class="line">    {% endif %}</span><br><span class="line">    _exit_point <span class="keyword">function</span>=Park_Toolhead</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h2 id="klicky-probe"><a href="#klicky-probe" class="headerlink" title="klicky-probe"></a>klicky-probe</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#这里有各种klicky的简单配置宏文件</span></span><br><span class="line"><span class="comment">#主要是开关某些功能用，如果要启用的话就去掉前面的#号就可以</span></span><br><span class="line"><span class="comment">#想关闭的话就去最前面加个#</span></span><br><span class="line"><span class="comment">#这配置的主页是 https://github.com/jlas1/Klicky-Probe, 有兴趣就去看看</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#[include ./klicky-specific.cfg]				#放置其他特定打印机配置，这个文件一般是空白给大佬用的</span></span><br><span class="line">[include ./klicky-variables.cfg]				<span class="comment">#基础配置文件</span></span><br><span class="line">[include ./klicky-macros.cfg]					<span class="comment">#基础宏文件</span></span><br><span class="line">[include ./klicky-bed-mesh-calibrate.cfg]		<span class="comment">#自动调平配置，需要klipper配置支持</span></span><br><span class="line"><span class="comment">#[include ./klicky-screws-tilt-calculate.cfg]	#协助使用调平床螺丝</span></span><br><span class="line">[include ./klicky-quad-gantry-level.cfg]		<span class="comment">#4Z电机配置</span></span><br><span class="line"><span class="comment">#[include ./klicky-z-tilt-adjust.cfg]			#2Z或3Z电机配置</span></span><br><span class="line"><span class="comment">#[include ./klicky-z-calibration.cfg]			#自动Z配置</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h2 id="klicky-quad-gantry-level"><a href="#klicky-quad-gantry-level" class="headerlink" title="klicky-quad-gantry-level"></a>klicky-quad-gantry-level</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This macro was provided by discord user Garrettwp to whom i give my thanks for sharing it with me.</span></span><br><span class="line"><span class="comment"># I have tweaked it a lot.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># this macro is  based on the great Annex magprobe dockable probe macros "#Originally developed by Mental, modified for better use on K-series printers by RyanG and Trails"</span></span><br><span class="line"><span class="comment"># that macro as since evolved into a klipper plugin that currently is pending inclusion in klipper</span></span><br><span class="line"><span class="comment"># more information here https://github.com/Annex-Engineering/Quickdraw_Probe/tree/main/Klipper_Macros</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># by standing on the shoulders of giants, lets see if we can see further</span></span><br><span class="line"><span class="comment"># User richardjm revised the macro variables and added some functions, thanks a lot</span></span><br><span class="line"><span class="comment"># This macro home is https://github.com/jlas1/Klicky-Probe</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#一个简单的宏文件~别碰就对了</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###################</span></span><br><span class="line"><span class="comment"># Quad Gantry Level</span></span><br><span class="line">[gcode_macro QUAD_GANTRY_LEVEL]</span><br><span class="line">rename_existing: _QUAD_GANTRY_LEVEL</span><br><span class="line">description: Conform a moving, twistable gantry to the shape of a stationary bed with klicky automount</span><br><span class="line">gcode:</span><br><span class="line">    {% <span class="built_in">set</span> V = printer[<span class="string">"gcode_macro _User_Variables"</span>].verbose %}</span><br><span class="line">    {% <span class="keyword">if</span> V %}</span><br><span class="line">        { action_respond_info(<span class="string">"QG Level"</span>) }</span><br><span class="line">    {% endif %}</span><br><span class="line"></span><br><span class="line">    _CheckProbe action=query</span><br><span class="line">	G90</span><br><span class="line">    Attach_Probe</span><br><span class="line"></span><br><span class="line">    _QUAD_GANTRY_LEVEL {% <span class="keyword">for</span> p <span class="keyword">in</span> params</span><br><span class="line">            %}{<span class="string">'%s=%s '</span> % (p, params[p])}{%</span><br><span class="line">            endfor %}</span><br><span class="line">    Dock_Probe</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h2 id="klicky-variables"><a href="#klicky-variables" class="headerlink" title="klicky-variables"></a>klicky-variables</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这个宏是discord 用户 Garrettwp 提供的，作者很感谢他的分享</span></span><br><span class="line"><span class="comment"># 作者做了很多调整.  #下面都是讲解啥的懒得翻译了</span></span><br><span class="line"><span class="comment"># They are based on the great Annex magprobe dockable probe macros "#Originally developed by Mental,</span></span><br><span class="line"><span class="comment"># modified for better use on K-series printers by RyanG and Trails", kudos to them.</span></span><br><span class="line"><span class="comment"># That macro as since evolved into a klipper plugin that currently is pending inclusion in klipper, </span></span><br><span class="line"><span class="comment"># more information here, https://github.com/Annex-Engineering/Quickdraw_Probe/tree/main/Klipper_Macros</span></span><br><span class="line"><span class="comment"># User richardjm revised the macro variables and added some functions, thanks a lot</span></span><br><span class="line"><span class="comment"># by standing on the shoulders of giants, lets see if we can see further</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># the current home for this version is https://github.com/jlas1/Klicky-Probe </span></span><br><span class="line"></span><br><span class="line">[gcode_macro _User_Variables]</span><br><span class="line">variable_verbose:             True    <span class="comment"># 启用详细输出</span></span><br><span class="line">variable_travel_speed:        100    <span class="comment"># 运行klicky宏的速度</span></span><br><span class="line">variable_move_accel:          2000    <span class="comment"># 运行klicky宏的加速度</span></span><br><span class="line">variable_dock_speed:            50    <span class="comment"># 喷头安装klicky的速度</span></span><br><span class="line">variable_release_speed:         120    <span class="comment"># 拆卸klicky的速度</span></span><br><span class="line">variable_z_drop_speed:          20    <span class="comment"># 拆卸探针的时候Z的移动速度</span></span><br><span class="line"></span><br><span class="line">variable_safe_z:         	    20    <span class="comment"># 安装和拆卸探针的时候Z提升的高度</span></span><br><span class="line"><span class="comment"># 如果是true，安装探针前就会先提升Z确保安全</span></span><br><span class="line">variable_enable_z_hop:        True    <span class="comment"># 如果你的床在关闭电源之后自己会掉到几乎最大的位置那么久设置成false</span></span><br><span class="line"></span><br><span class="line">variable_max_bed_y:            360    <span class="comment"># 床的最大y</span></span><br><span class="line">variable_max_bed_x:            350    <span class="comment"># 床的最大X</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果你有单独的Z限位（voron）的话在这里设置好限位的坐标</span></span><br><span class="line">variable_z_endstop_x:         271</span><br><span class="line">variable_z_endstop_y:         360</span><br><span class="line"><span class="comment">#检查有关 klipper Dock/Undock 配置的打印机特定文档，这些是虚拟值停靠位置</span></span><br><span class="line">variable_docklocation_x:      52.062      <span class="comment"># 探针卡座的X坐标</span></span><br><span class="line">variable_docklocation_y:      360      <span class="comment"># 探针卡座的Y坐标</span></span><br><span class="line">variable_docklocation_z:      -128     <span class="comment"># 探针卡座的Z坐标 (-128 用在和voron2.4类似的结构)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#拆卸探针的时候喷嘴的移动方向</span></span><br><span class="line">Variable_dockmove_x:             50</span><br><span class="line">Variable_dockmove_y:             0</span><br><span class="line">Variable_dockmove_z:             0</span><br><span class="line"><span class="comment">#安装探针的时候喷嘴的移动方向</span></span><br><span class="line">Variable_attachmove_x:           0</span><br><span class="line">Variable_attachmove_y:           50</span><br><span class="line">Variable_attachmove_z:           0</span><br><span class="line"></span><br><span class="line"><span class="comment">#这里下面的通常不需要配置</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Umbilical to help untangle the umbilical in difficult situations</span></span><br><span class="line">variable_umbilical:          False    <span class="comment"># should we untabgle the umbilical</span></span><br><span class="line">variable_umbilical_x:           15    <span class="comment"># X umbilical position</span></span><br><span class="line">variable_umbilical_y:           15    <span class="comment"># Y umbilical position</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># location to park the toolhead</span></span><br><span class="line">variable_park_toolhead:      False    <span class="comment"># Enable toolhead parking</span></span><br><span class="line">variable_parkposition_x:       125</span><br><span class="line">variable_parkposition_y:       125</span><br><span class="line">variable_parkposition_z:        30</span><br><span class="line"></span><br><span class="line">variable_version:                1    <span class="comment"># Helps users to update the necessary variables, do not update if the variables above are not updated</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Below this remark, you normally do not need to configure</span></span><br><span class="line"><span class="comment">#Attach move2</span></span><br><span class="line">Variable_attachmove2_x:          0    <span class="comment"># intermediate toolhead movement to attach</span></span><br><span class="line">Variable_attachmove2_y:          0    <span class="comment"># the probe on the dock</span></span><br><span class="line">Variable_attachmove2_z:          0    <span class="comment"># (can be negative)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Do not modify below</span></span><br><span class="line">gcode:</span><br><span class="line">    {% <span class="built_in">set</span> Mx = printer[<span class="string">'configfile'</span>].config[<span class="string">"stepper_x"</span>][<span class="string">"position_max"</span>]|<span class="built_in">float</span> %}</span><br><span class="line">    {% <span class="built_in">set</span> My = printer[<span class="string">'configfile'</span>].config[<span class="string">"stepper_y"</span>][<span class="string">"position_max"</span>]|<span class="built_in">float</span> %}</span><br><span class="line">    {% <span class="built_in">set</span> Ox = printer[<span class="string">'configfile'</span>].config[<span class="string">"probe"</span>][<span class="string">"x_offset"</span>]|<span class="built_in">float</span> %}</span><br><span class="line">    {% <span class="built_in">set</span> Oy = printer[<span class="string">'configfile'</span>].config[<span class="string">"probe"</span>][<span class="string">"y_offset"</span>]|<span class="built_in">float</span> %}</span><br><span class="line">    {% <span class="built_in">set</span> Oz = printer[<span class="string">'configfile'</span>].config[<span class="string">"probe"</span>][<span class="string">"z_offset"</span>]|<span class="built_in">float</span> %}</span><br><span class="line"></span><br><span class="line">    <span class="comment"># If x, y coordinates are set for z endstop, assign them</span></span><br><span class="line">    {% <span class="keyword">if</span> z_endstop_x != 0 or z_endstop_y != 0 %}</span><br><span class="line">        SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=z_endstop_x VALUE={ z_endstop_x }</span><br><span class="line">        SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=z_endstop_y VALUE={ z_endstop_y }</span><br><span class="line"></span><br><span class="line">    <span class="comment"># if no x, y coordinates for z endstop, assume probe is endstop and move toolhead to center of bed</span></span><br><span class="line">    {% <span class="keyword">else</span> %}</span><br><span class="line">        SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=z_endstop_x VALUE={ (Mx * 0.5) - Ox }</span><br><span class="line">        SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=z_endstop_y VALUE={ (My * 0.5) - Oy }</span><br><span class="line">    {% endif %}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="klicky-z-calibration"><a href="#klicky-z-calibration" class="headerlink" title="klicky-z-calibration"></a>klicky-z-calibration</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">[z_calibration]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里是设置自动Zoffset的文件，我不用这功能所以就随便吧</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## update these variable according to the documentation here https://github.com/protoloft/klipper_z_calibration</span></span><br><span class="line"><span class="comment">## you then should call CALIBRATE_Z as one of the last lines on your PRINT_START to set the Z offset dinamically</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#   这里是Z限位的位置，之前写好的直接填这里就可以</span></span><br><span class="line">probe_nozzle_x: 271</span><br><span class="line">probe_nozzle_y: 360</span><br><span class="line"><span class="comment">#   这里是用探针去按Z限位的位置，只要不是用探针微动那小丁丁去按就行</span></span><br><span class="line">probe_switch_x: 271</span><br><span class="line">probe_switch_y: 350</span><br><span class="line"><span class="comment">#   这里写探测床的时候探针移动到什么地方</span></span><br><span class="line">probe_bed_x: 175</span><br><span class="line">probe_bed_y: 175</span><br><span class="line"><span class="comment">#   微动开关的触发行程增大这个数值喷嘴就会离床更加近，减少就会离得远</span></span><br><span class="line">switch_offset: 0.42</span><br><span class="line"><span class="comment">#   允许的偏差值，这个一般别碰，除非你的床弯得离谱</span></span><br><span class="line">max_deviation: 1.5</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里往下的一般别碰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#   The number of times to probe each point. The probed z-values</span></span><br><span class="line"><span class="comment">#   will be averaged. The default is from the probe's configuration.</span></span><br><span class="line"><span class="comment">#samples: default from "probe:samples" section</span></span><br><span class="line"><span class="comment">#   The maximum Z distance (in mm) that a sample may differ from other</span></span><br><span class="line"><span class="comment">#   samples. The default is from the probe's configuration.</span></span><br><span class="line"><span class="comment">#samples_tolerance: default from "probe:samples_tolerance" section</span></span><br><span class="line"><span class="comment">#   The number of times to retry if a sample is found that exceeds</span></span><br><span class="line"><span class="comment">#   samples_tolerance. The default is from the probe's configuration.</span></span><br><span class="line"><span class="comment">#samples_tolerance_retries: default from "probe:samples_tolerance_retries" section</span></span><br><span class="line"><span class="comment">#   The calculation method when sampling more than once - either</span></span><br><span class="line"><span class="comment">#   "median" or "average". The default is from the probe's configuration.</span></span><br><span class="line"><span class="comment">#samples_result: default from "probe:samples_result" section</span></span><br><span class="line"><span class="comment">#   The distance in mm to move up before moving to the next</span></span><br><span class="line"><span class="comment">#   position. The default is two times the z_offset from the probe's</span></span><br><span class="line"><span class="comment">#   configuration.</span></span><br><span class="line">clearance: 7.5</span><br><span class="line"><span class="comment">#position_min: default from "stepper_z:position_min" section.</span></span><br><span class="line"><span class="comment">#   The moving speed in X and Y. The default is 50 mm/s.</span></span><br><span class="line">speed: 100</span><br><span class="line"><span class="comment">#   Speed (in mm/s) of the Z axis when lifting the probe between</span></span><br><span class="line"><span class="comment">#   samples and clearance moves. The default is from the probe's</span></span><br><span class="line"><span class="comment">#   configuration.</span></span><br><span class="line"><span class="comment">#lift_speed: default from "probe:lift_speed" section</span></span><br><span class="line"><span class="comment">#   The fast probing speed (in mm/s) used, when probing_first_fast</span></span><br><span class="line"><span class="comment">#   is activated. The default is from the Z rail configuration.</span></span><br><span class="line"><span class="comment">#probing_speed: default from "stepper_z:homing_speed" section.</span></span><br><span class="line"><span class="comment">#   The slower speed (in mm/s) for probing the recorded samples.</span></span><br><span class="line"><span class="comment">#   The default is second_homing_speed of the Z rail configuration.</span></span><br><span class="line"><span class="comment">#probing_second_speed: default from "stepper_z:second_homing_speed" section.</span></span><br><span class="line"><span class="comment">#   Distance to back off (in mm) before probing the next sample.</span></span><br><span class="line"><span class="comment">#   The default is homing_retract_dist from the Z rail configuration.</span></span><br><span class="line"><span class="comment">#probing_retract_dist: default from "stepper_z:homing_retract_dist" section.</span></span><br><span class="line"><span class="comment">#   If true, the first probing is done faster by the probing speed.</span></span><br><span class="line"><span class="comment">#   This is to get faster down and the result is not recorded as a</span></span><br><span class="line"><span class="comment">#   probing sample. The default is false.</span></span><br><span class="line">probing_first_fast: <span class="literal">true</span></span><br><span class="line"><span class="comment">#   If true, the first probing is done faster by the probing speed.</span></span><br><span class="line"><span class="comment">#   This is to get faster down and the result is not recorded as a</span></span><br><span class="line"><span class="comment">#   probing sample. The default is false.</span></span><br><span class="line"></span><br><span class="line">start_gcode: Dock_Probe_Unlock</span><br><span class="line"><span class="comment">#   A list of G-Code commands to execute prior to each calibration command.</span></span><br><span class="line"><span class="comment">#   See docs/Command_Templates.md for G-Code format. This can be used to</span></span><br><span class="line"><span class="comment">#   attach the probe.</span></span><br><span class="line">before_switch_gcode: Attach_Probe</span><br><span class="line"><span class="comment">#   A list of G-Code commands to execute prior to each probing on the</span></span><br><span class="line"><span class="comment">#   mag-probe. See docs/Command_Templates.md for G-Code format. This can be</span></span><br><span class="line"><span class="comment">#   used to attach the probe after probing on the nozzle and before probing</span></span><br><span class="line"><span class="comment">#   on the mag-probe.</span></span><br><span class="line">end_gcode: Dock_Probe</span><br><span class="line"><span class="comment">#   A list of G-Code commands to execute after each calibration command.</span></span><br><span class="line"><span class="comment">#   See docs/Command_Templates.md for G-Code format. This can be used to</span></span><br><span class="line"><span class="comment">#   detach the probe afterwards.</span></span><br><span class="line"></span><br><span class="line">[gcode_macro CALIBRATE_Z]</span><br><span class="line">rename_existing: BASE_CALIBRATE_Z</span><br><span class="line">gcode:</span><br><span class="line">    M117 Z-Calibration..</span><br><span class="line">    SET_GCODE_OFFSET Z=0</span><br><span class="line">    BASE_CALIBRATE_Z</span><br><span class="line">    M117</span><br></pre></td></tr></tbody></table></figure>

<h2 id="KlipperScreen-conf"><a href="#KlipperScreen-conf" class="headerlink" title="KlipperScreen.conf"></a>KlipperScreen.conf</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#~# --- Do not edit below this line. This section is auto generated --- #~#</span></span><br><span class="line"><span class="comment">#~#</span></span><br><span class="line"><span class="comment">#~# [main]</span></span><br><span class="line"><span class="comment">#~# language = zh_CN</span></span><br><span class="line"><span class="comment">#~# show_heater_power = True</span></span><br><span class="line"><span class="comment">#~#</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="moonraker-conf"><a href="#moonraker-conf" class="headerlink" title="moonraker.conf"></a>moonraker.conf</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[server]</span><br><span class="line">host: 0.0.0.0</span><br><span class="line">port: 7125</span><br><span class="line">klippy_uds_address: /home/orangepi/printer_data/comms/klippy.sock</span><br><span class="line"></span><br><span class="line">[authorization]</span><br><span class="line">trusted_clients:</span><br><span class="line">    10.0.0.0/8</span><br><span class="line">    127.0.0.0/8</span><br><span class="line">    169.254.0.0/16</span><br><span class="line">    172.16.0.0/12</span><br><span class="line">    192.168.0.0/16</span><br><span class="line">    FE80::/10</span><br><span class="line">    ::1/128</span><br><span class="line">cors_domains:</span><br><span class="line">    *.lan</span><br><span class="line">    *.<span class="built_in">local</span></span><br><span class="line">    *://localhost</span><br><span class="line">    *://localhost:*</span><br><span class="line">    *://my.mainsail.xyz</span><br><span class="line">    *://app.fluidd.xyz</span><br><span class="line"></span><br><span class="line">[octoprint_compat]</span><br><span class="line"></span><br><span class="line">[<span class="built_in">history</span>]</span><br><span class="line"></span><br><span class="line">[update_manager]</span><br><span class="line">channel: dev</span><br><span class="line">refresh_interval: 168</span><br><span class="line"></span><br><span class="line">[update_manager fluidd-config]</span><br><span class="line"><span class="built_in">type</span>: git_repo</span><br><span class="line">primary_branch: master</span><br><span class="line">path: ~/fluidd-config</span><br><span class="line">origin: https://github.com/fluidd-core/fluidd-config.git</span><br><span class="line">managed_services: klipper</span><br><span class="line"></span><br><span class="line">[update_manager fluidd]</span><br><span class="line"><span class="built_in">type</span>: web</span><br><span class="line">channel: stable</span><br><span class="line">repo: fluidd-core/fluidd</span><br><span class="line">path: ~/fluidd</span><br></pre></td></tr></tbody></table></figure>

<h2 id="printer"><a href="#printer" class="headerlink" title="printer"></a>printer</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">## FLY-RRF固件交流群：786561979</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">#                               注意事项                             #</span></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">##***需要更改/检查的事项：***</span></span><br><span class="line"><span class="comment">## MCU 路径                                [mcu] </span></span><br><span class="line"><span class="comment">## 打印机活动范围                           xyz的position   </span></span><br><span class="line"><span class="comment">## 热敏电阻类型                             [extruder] 和 [heater_bed]</span></span><br><span class="line"><span class="comment">## Z轴限位开关停止位置                      [safe_z_home] </span></span><br><span class="line"><span class="comment">## Z轴限位开关偏移位置                      [stepper_z] </span></span><br><span class="line"><span class="comment">## PID 校准                                [extruder] 和 [heater_bed] </span></span><br><span class="line"><span class="comment">## 微调挤出机电机步进值                     [extruder] </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">#                               文件调用                             #</span></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment"># [include FLYD5.cfg]</span></span><br><span class="line"><span class="comment">#[include FLYD7.cfg]</span></span><br><span class="line"><span class="comment">#[include sht36v2.cfg]</span></span><br><span class="line"><span class="comment">#[include lis2dw.cfg]</span></span><br><span class="line">[include fluidd.cfg]          <span class="comment"># FLUIDD调用文件。</span></span><br><span class="line"><span class="comment">#[include mainsail.cfg]        # MAINSDIL调用文件。</span></span><br><span class="line"><span class="comment">#需要自行确定使用哪个文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">#                               主板配置                             #</span></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line">[mcu]                           <span class="comment"># FLY主板ID</span></span><br><span class="line"><span class="comment"># canbus_uuid:24bf7882e89c</span></span><br><span class="line">serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_450046001551303432323631-if00</span><br><span class="line"><span class="comment">### 查询usb固件id是：ls /dev/serial/by-id/</span></span><br><span class="line"><span class="comment">### 把/dev/serial/by-id/usb-Klipper_stm32f407xx_XXXXXXXXXXXXXXXXXXXXX替换查询到的id</span></span><br><span class="line"><span class="comment">#canbus_uuid: e51d5c71a901</span></span><br><span class="line"><span class="comment">### 查询can固件id是：~/klippy-env/bin/python ~/klipper/scripts/canbus_query.py can0</span></span><br><span class="line"><span class="comment">### can的id需要把serial替换成canbus_uuid: 后面添加id </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#[mcu host]                     # FlyOS已默认为您生成linux MCU，定义即可使用   </span></span><br><span class="line"><span class="comment">#serial: /tmp/klipper_host_mcu </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">#                            机型和加速度                            #</span></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line">[printer]                      <span class="comment"># 打印机设置</span></span><br><span class="line">kinematics: corexy               <span class="comment"># 运动学结构分为：笛卡尔和corexy等等。笛卡尔：cartesian</span></span><br><span class="line">max_velocity: 500               <span class="comment"># 打印机最大速度   </span></span><br><span class="line">max_accel: 30000                 <span class="comment"># 最大加速度 最大3000</span></span><br><span class="line"><span class="comment"># max_accel_to_decel:20000</span></span><br><span class="line">max_z_velocity: 15              <span class="comment"># z轴最大速度</span></span><br><span class="line">max_z_accel: 1000                <span class="comment"># z轴最大加速度</span></span><br><span class="line">square_corner_velocity:5     <span class="comment"># 方形拐角速度，小一点可以有效避免平台重带来的惯性</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">#                             温度监控                               #</span></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line">[temperature_sensor Fly-C8下位机]    <span class="comment"># FLY主板温度</span></span><br><span class="line">sensor_type: temperature_mcu      <span class="comment"># 关联mcu（默认）</span></span><br><span class="line"><span class="comment">#[temperature_sensor FLY-C8上位机]        # 上位机温度</span></span><br><span class="line"><span class="comment">#sensor_type: temperature_host     # 关联上位机</span></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">#                              热床网格校准</span></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line">[bed_mesh]</span><br><span class="line">speed: 15                    <span class="comment"># 校准速度</span></span><br><span class="line">horizontal_move_z: 5         <span class="comment"># 探针前往下一个点之前Z需要抬升的高</span></span><br><span class="line">mesh_min: 30,30             <span class="comment"># 最小校准点坐标x，y</span></span><br><span class="line">mesh_max: 320,320           <span class="comment"># 最大校准点坐标x，y</span></span><br><span class="line">probe_count: 8,8             <span class="comment"># 采样点数（4X4为16点）</span></span><br><span class="line"><span class="comment">#mesh_pps:0  </span></span><br><span class="line">mesh_pps: 2,2                <span class="comment"># 补充采样点数</span></span><br><span class="line">algorithm: bicubic           <span class="comment"># 算法模型</span></span><br><span class="line">bicubic_tension: 0.2         <span class="comment"># 算法插值不要动</span></span><br><span class="line"><span class="comment">#fade_start: 3                 # 默认值：1 开始网格淡出的值，在设定的fade_start值之后逐步停止调整Z的高度。 建议在打印几层之后再开始淡出层高。</span></span><br><span class="line"><span class="comment">#fade_end: 15                  #网格淡出完成的 Z 高度。 如果此值低于fade_start，则禁用网格淡出。 该值可以根据打印表面的弯曲程度进行调整。 明显弯曲的表面应该在将网格淡出的距离长。 接近平坦的表面可能能够降低该值以更快地逐步淘汰</span></span><br><span class="line"><span class="comment">#fade_target: 0                #格的平均 Z 值 fade_target 可以被视为在淡化完成后应用于整个床面的额外 Z 偏移量。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">#                            ADXL345</span></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">#[adxl345]</span></span><br><span class="line"><span class="comment">#cs_pin: host:None</span></span><br><span class="line"><span class="comment">#spi_bus: spidev1.0</span></span><br><span class="line"><span class="comment"># --------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#[resonance_tester]</span></span><br><span class="line"><span class="comment">#accel_chip: adxl345              # 使用的加速度芯片名称</span></span><br><span class="line"><span class="comment">#accel_chip_y:adxl345</span></span><br><span class="line"><span class="comment">#probe_points: 115, 105, 20        # 共振测试的坐标点</span></span><br><span class="line"><span class="comment">#min_freq: 1                       # 共振测试的最小频率</span></span><br><span class="line"><span class="comment">#max_freq: 133                     # 共振测试的最大频率</span></span><br><span class="line"><span class="comment">#accel_per_hz: 75                  # 每赫兹加速度(mm/sec)，加速度=每赫兹加速度*频率，如果共振过于强烈，可以减少该值。默认75</span></span><br><span class="line"><span class="comment">#hz_per_sec: 1                     # 测试的速度，较小的值会加长测试时间，较大的值会降低测试精度，(Hz/sec == sec^-2)，默认1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">#             X/Y步进电机设置 (X/Y Stepper Settings)                 # </span></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">#                   z1                 z2</span></span><br><span class="line"><span class="comment">#                       B__________A</span></span><br><span class="line"><span class="comment">#                     </span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment">#                   Z0     12864      Z3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">#                  X 轴步进电机      (DRIVER0)                       #</span></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">## DRIVER0电机位置</span></span><br><span class="line">[stepper_x]</span><br><span class="line">step_pin: PF13                       <span class="comment"># X轴电机脉冲引脚设置</span></span><br><span class="line">dir_pin: !PF12                        <span class="comment"># X轴电机运行引脚设置,方向按实际判断，加感叹号会让运行方向反转</span></span><br><span class="line">enable_pin: !PF14                   <span class="comment"># X轴电机使能引脚设置,使能引脚需要加感叹号，否者电机不工作</span></span><br><span class="line">rotation_distance: 40               <span class="comment"># 主动带轮周长mm（2GT-20T带轮40，2GT-16T带轮32）</span></span><br><span class="line">microsteps: 32                      <span class="comment"># 电机细分设置，细分越高，质量越高，但主控负荷越大</span></span><br><span class="line">full_steps_per_rotation: 200        <span class="comment"># 电机单圈所需脉冲数（1.8度电机:200，0.9度电机:400）</span></span><br><span class="line"><span class="comment"># endstop_pin: ^!PD9                    # 限位开关PIN脚,建议常闭接常闭</span></span><br><span class="line">endstop_pin:PG6        <span class="comment"># 限位开关接口</span></span><br><span class="line"><span class="comment">###接常闭后是触发状态，加感叹号可以反转这个状态，万一断线时候可以避免撞机</span></span><br><span class="line">position_min: 0                     <span class="comment"># 软限位最小行程</span></span><br><span class="line">position_endstop: 350              <span class="comment"># 软限位最大行程 (250mm-300mm-350mm)</span></span><br><span class="line">position_max: 350                  <span class="comment"># 机械限位最大行程 (250mm-300mm-350mm)</span></span><br><span class="line">homing_speed: 50                   <span class="comment"># 复位速度-最大 100</span></span><br><span class="line">homing_retract_dist: 5              <span class="comment"># 第一次触发复位开关之后的后退距离</span></span><br><span class="line">homing_positive_dir: <span class="literal">true</span>           <span class="comment"># 复位方向（一般不需要改动）</span></span><br><span class="line">second_homing_speed: 3        <span class="comment"># 二次复位速度-最大 10</span></span><br><span class="line">homing_retract_dist: 5        <span class="comment"># 后撤距离</span></span><br><span class="line"><span class="comment">#--------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">##  请确保驱动型号配置正确 (2208 or 2209)</span></span><br><span class="line"><span class="comment"># [tmc2208 stepper_x]                 # x 驱动配置 -TMC2209</span></span><br><span class="line"><span class="comment"># uart_pin: PC9                       # 通讯端口Pin脚定义</span></span><br><span class="line"><span class="comment"># interpolate: False                  # 是否开启256微步插值（开启是True，关闭是False）</span></span><br><span class="line"><span class="comment"># run_current: 1.3                    # 电机运行电流值（单位：mA）</span></span><br><span class="line"><span class="comment"># sense_resistor: 0.110               # 驱动采样电阻不要改</span></span><br><span class="line"><span class="comment"># # stealthchop_threshold: 0          # 静音阀值（如果不需要静音，请将数值改为0）</span></span><br><span class="line"><span class="comment"># stealthchop_threshold: 999</span></span><br><span class="line"><span class="comment">#--------------------------------------------------------------------</span></span><br><span class="line">[tmc2209 stepper_x]                 <span class="comment"># X 驱动配置- TMC2226</span></span><br><span class="line">uart_pin: PC4                         <span class="comment"># SPI 片选Pin脚定义</span></span><br><span class="line"><span class="comment">#spi_software_sclk_pin:PB3</span></span><br><span class="line"><span class="comment">#spi_software_mosi_pin:PB5</span></span><br><span class="line"><span class="comment">#spi_software_miso_pin: PB4                      # SPI 通讯总线定义</span></span><br><span class="line">run_current: 0.8                    <span class="comment"># 电机运行电流值</span></span><br><span class="line">interpolate: <span class="literal">false</span>                  <span class="comment"># 是否开启256微步插值（开启是True，关闭是False）</span></span><br><span class="line">sense_resistor: 0.110               <span class="comment"># 驱动采样电阻不要改（如果使用5160 Pro，请将数值修改为0.033）</span></span><br><span class="line">stealthchop_threshold: 0          <span class="comment"># 静音阀值（如果不需要静音，请将数值改为0）</span></span><br><span class="line"><span class="comment">#diag0_pin:^!PD9 # Pin connected to TMC DIAG1 pin (or use diag0_pin / DIAG0 pin)</span></span><br><span class="line"><span class="comment">#driver_SGT:-2 # -64 is most sensitive value, 63 is least sensitiv</span></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">#                  Y 轴步进电机      (DRIVER1)                       #</span></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment"># DRIVER1电机位置</span></span><br><span class="line">[stepper_y]</span><br><span class="line">step_pin: PG0</span><br><span class="line">dir_pin:!PG1</span><br><span class="line">enable_pin: !PF15</span><br><span class="line">rotation_distance: 40</span><br><span class="line">microsteps: 32                      <span class="comment"># 电机细分设置，细分越高，质量越高，但主控负荷越大</span></span><br><span class="line">full_steps_per_rotation: 200        <span class="comment"># 电机单圈所需脉冲数（1.8度电机:200，0.9度电机:400）</span></span><br><span class="line"><span class="comment">#endstop_pin: ^!PD8                    # 限位开关PIN脚,建议常闭然后添加！反转状态</span></span><br><span class="line">endstop_pin:PG9        <span class="comment"># 限位开关接口</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###接常闭后是触发状态，加感叹号可以反转这个状态，万一断线时候可以避免撞机</span></span><br><span class="line">position_min: 0</span><br><span class="line">position_endstop: 360</span><br><span class="line">position_max: 360</span><br><span class="line">homing_speed: 50</span><br><span class="line">homing_retract_dist: 5</span><br><span class="line">homing_positive_dir: <span class="literal">true</span></span><br><span class="line">second_homing_speed: 3        <span class="comment"># 二次复位速度-最大 10</span></span><br><span class="line">homing_retract_dist: 5        <span class="comment"># 后撤距离</span></span><br><span class="line"><span class="comment">#--------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">##  请确保驱动型号配置正确 (2209 or 5160)</span></span><br><span class="line"><span class="comment"># [tmc2209 stepper_y]</span></span><br><span class="line"><span class="comment"># uart_pin: PC10</span></span><br><span class="line"><span class="comment"># interpolate: False                  # 是否开启256微步插值（开启是True，关闭是False）</span></span><br><span class="line"><span class="comment"># run_current: 0.8                    # 电机运行电流值（单位：mA）</span></span><br><span class="line"><span class="comment"># sense_resistor: 0.110               # 驱动采样电阻不要改</span></span><br><span class="line"><span class="comment"># stealthchop_threshold: 0          # 静音阀值（如果不需要静音，请将数值改为0）</span></span><br><span class="line"><span class="comment">#--------------------------------------------------------------------</span></span><br><span class="line">[tmc2209 stepper_y]                 <span class="comment"># 挤出机驱动配置- TMC5160</span></span><br><span class="line">uart_pin: PD11</span><br><span class="line"><span class="comment">#spi_software_sclk_pin:PB3</span></span><br><span class="line"><span class="comment">#spi_software_mosi_pin:PB5</span></span><br><span class="line"><span class="comment">#spi_software_miso_pin: PB4                       # SPI 通讯总线定义</span></span><br><span class="line">run_current: 0.8                    <span class="comment"># 电机运行电流值</span></span><br><span class="line">interpolate: False                  <span class="comment"># 是否开启256微步插值（开启是True，关闭是False）</span></span><br><span class="line">sense_resistor: 0.110              <span class="comment"># 驱动采样电阻不要改（如果使用5160 Pro，请将数值修改为0.033）</span></span><br><span class="line"><span class="comment"># stealthchop_threshold:0          # 静音阀值（如果不需要静音，请将数值改为0）</span></span><br><span class="line">stealthchop_threshold: 0   </span><br><span class="line"><span class="comment">#diag1_pin:^!PD8 # Pin connected to TMC DIAG1 pin (or use diag0_pin / DIAG0 pin)</span></span><br><span class="line"><span class="comment">#driver_SGT: -3  # -64 is most sensitive value, 63 is least sensitiv</span></span><br><span class="line"><span class="comment">#[stepper_y1]</span></span><br><span class="line"><span class="comment">#step_pin: PE3</span></span><br><span class="line"><span class="comment">#dir_pin: !PD1</span></span><br><span class="line"><span class="comment">#enable_pin: !PD2</span></span><br><span class="line"><span class="comment">#rotation_distance: 80</span></span><br><span class="line"><span class="comment">#microsteps: 16                      # 电机细分设置，细分越高，质量越高，但主控负荷越大</span></span><br><span class="line"><span class="comment">#full_steps_per_rotation: 200        # 电机单圈所需脉冲数（1.8度电机:200，0.9度电机:400）</span></span><br><span class="line"><span class="comment">#[tmc5160 stepper_y1]                 # 挤出机驱动配置- TMC5160</span></span><br><span class="line"><span class="comment">#cs_pin: PD0</span></span><br><span class="line"><span class="comment">#spi_software_sclk_pin:PB3</span></span><br><span class="line"><span class="comment">#spi_software_mosi_pin:PB5</span></span><br><span class="line"><span class="comment">#spi_software_miso_pin: PB4</span></span><br><span class="line"><span class="comment">#spi_bus: spi3                       # SPI 通讯总线定义</span></span><br><span class="line"><span class="comment">#run_current: 5.0                   # 电机运行电流值</span></span><br><span class="line"><span class="comment">#interpolate: False                  # 是否开启256微步插值（开启是True，关闭是False）</span></span><br><span class="line"><span class="comment">#sense_resistor: 0.022              # 驱动采样电阻不要改（如果使用5160 Pro，请将数值修改为0.033）</span></span><br><span class="line"><span class="comment"># stealthchop_threshold: 0         # 静音阀值（如果不需要静音，请将数值改为0）</span></span><br><span class="line"><span class="comment">#stealthchop_threshold: 0  </span></span><br><span class="line"><span class="comment">#diag1_pin:^!PD11 </span></span><br><span class="line"><span class="comment"># diag1_pin:^!PD8 # Pin connected to TMC DIAG1 pin (or use diag0_pin / DIAG0 pin)</span></span><br><span class="line"><span class="comment">#driver_SGT: -3  # -64 is most sensitive value, 63 is least sensitive</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">#                     Z轴步进电机 （Z Stepper Settings）             #</span></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">## DRIVER2电机位置             左前方 on Driver</span></span><br><span class="line">[stepper_z]</span><br><span class="line">step_pin: PF11</span><br><span class="line">dir_pin: !PG3</span><br><span class="line">enable_pin: !PG5</span><br><span class="line">rotation_distance: 40         <span class="comment"># 主动轮周长mm （2GT-20T为 40mm  16T为 32mm）</span></span><br><span class="line">gear_ratio: 80:16             <span class="comment"># 减速比</span></span><br><span class="line"><span class="comment">#rotation_distance: 40         # 丝杆导程为 8，请根据你的实际使用情况修改</span></span><br><span class="line">microsteps: 32</span><br><span class="line">endstop_pin: PG10 </span><br><span class="line"><span class="comment">#endstop_pin = probe : z_virtual_endstop         # 限位开关接口</span></span><br><span class="line">position_max: 320           <span class="comment"># 软限位最大行程 (240mm-290mm-340mm)</span></span><br><span class="line">position_endstop:-1        </span><br><span class="line">position_min: -5              <span class="comment"># 软限位最小行程（配置喷嘴清洁需要-5左右）</span></span><br><span class="line">homing_speed: 8              <span class="comment"># 复位速度-最大 20</span></span><br><span class="line">second_homing_speed: 3        <span class="comment"># 二次复位速度-最大 10</span></span><br><span class="line">homing_retract_dist: 3        <span class="comment"># 后撤距离</span></span><br><span class="line"><span class="comment">#--------------------------------------------------------------------</span></span><br><span class="line">[tmc2209 stepper_z]</span><br><span class="line">uart_pin: PC6</span><br><span class="line">interpolate: False</span><br><span class="line">run_current: 0.8</span><br><span class="line">sense_resistor: 0.110</span><br><span class="line">stealthchop_threshold: 0    <span class="comment"># 静音阀值（如果不需要静音，请将数值改为0）</span></span><br><span class="line"><span class="comment">##--------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">## DRIVER4电机位置</span></span><br><span class="line">[stepper_z1]</span><br><span class="line">step_pin: PG4</span><br><span class="line">dir_pin:  !PC1</span><br><span class="line">enable_pin: !PA0</span><br><span class="line"><span class="comment"># step_pin: PE2</span></span><br><span class="line"><span class="comment"># dir_pin:  PD4</span></span><br><span class="line"><span class="comment"># enable_pin: !PD5</span></span><br><span class="line">rotation_distance: 40</span><br><span class="line">gear_ratio: 80:16</span><br><span class="line"><span class="comment">#rotation_distance: 32         # 丝杆导程为 8，请根据你的实际使用情况修改</span></span><br><span class="line">microsteps: 32</span><br><span class="line">[tmc2209 stepper_z1]</span><br><span class="line">uart_pin: PC7</span><br><span class="line">interpolate: False</span><br><span class="line">run_current: 0.8</span><br><span class="line">sense_resistor: 0.110</span><br><span class="line">stealthchop_threshold: 0  </span><br><span class="line"><span class="comment">#--------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># DRIVER5电机位置</span></span><br><span class="line">[stepper_z2]</span><br><span class="line">step_pin: PF9</span><br><span class="line">dir_pin: PF10</span><br><span class="line">enable_pin: !PG2</span><br><span class="line">rotation_distance: 40</span><br><span class="line">gear_ratio: 80:16</span><br><span class="line">microsteps: 32</span><br><span class="line">[tmc2209 stepper_z2]</span><br><span class="line">uart_pin: PF2</span><br><span class="line">interpolate: False</span><br><span class="line">run_current: 0.8</span><br><span class="line">sense_resistor: 0.110</span><br><span class="line">stealthchop_threshold: 0</span><br><span class="line"><span class="comment"># ##--------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># ## DRIVER6电机位置</span></span><br><span class="line">[stepper_z3]</span><br><span class="line">step_pin: PC13</span><br><span class="line">dir_pin:!PF0</span><br><span class="line">enable_pin: !PF1</span><br><span class="line">rotation_distance: 40</span><br><span class="line">gear_ratio: 80:16</span><br><span class="line">microsteps: 32</span><br><span class="line">[tmc2209 stepper_z3]</span><br><span class="line">uart_pin: PE4</span><br><span class="line">interpolate: False</span><br><span class="line">run_current: 0.8</span><br><span class="line">sense_resistor: 0.110</span><br><span class="line">stealthchop_threshold: 0</span><br><span class="line"></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">#                             挤出机配置</span></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">## DRIVER7电机位置</span></span><br><span class="line">[extruder]                          <span class="comment"># 挤出机</span></span><br><span class="line">step_pin:PE2</span><br><span class="line">dir_pin:PE3</span><br><span class="line">enable_pin: !PD4</span><br><span class="line">microsteps: 32</span><br><span class="line">full_steps_per_rotation: 200        <span class="comment"># 单圈脉冲数 （200 为 1.8 度, 400 为 0.9 度）</span></span><br><span class="line">rotation_distance: 22.21703304768         <span class="comment"># 主动带轮周长mm</span></span><br><span class="line"><span class="comment"># 校准步进值: rotation_distance = &lt;旧rotation_distance&gt; * &lt;实际挤出长度&gt; / &lt;请求的挤出长度&gt;</span></span><br><span class="line">gear_ratio: 50:10                   <span class="comment"># 减速比（伽利略齿比7.5:1 并且这行注释掉；BMG为50：17，输出轴在前，输入轴在后）</span></span><br><span class="line">nozzle_diameter: 0.400              <span class="comment"># 喷嘴直径</span></span><br><span class="line">filament_diameter: 1.750            <span class="comment"># 耗材直径</span></span><br><span class="line">heater_pin: PA2                    <span class="comment"># 挤出头加热棒控制Pin脚设置(e0)</span></span><br><span class="line">sensor_type: Generic 3950           <span class="comment"># 传感器型号</span></span><br><span class="line">sensor_pin: PF4                     <span class="comment"># 挤出头传感器Pin脚（T_E0）</span></span><br><span class="line">max_power: 1.0                      <span class="comment"># 加热棒PWM最大输出功率</span></span><br><span class="line">min_temp: 10                      <span class="comment"># 挤出机最小温度</span></span><br><span class="line">max_temp: 320                       <span class="comment"># 挤出机最大温度</span></span><br><span class="line">min_extrude_temp: 10.0               <span class="comment"># 加热棒最低挤出温度（达到此温度挤出机才能有挤出动作）</span></span><br><span class="line">pressure_advance: 0.04              <span class="comment"># 挤出机压力提前参数</span></span><br><span class="line">pressure_advance_smooth_time:0.040  <span class="comment"># 平稳推进时间-默认值为0.040</span></span><br><span class="line"><span class="comment">#max_extrude_only_distance: 500</span></span><br><span class="line"><span class="comment">#instantaneous_corner_velocity: 0</span></span><br><span class="line">max_extrude_only_velocity:500</span><br><span class="line">max_extrude_only_accel:120</span><br><span class="line"><span class="comment"># #喷嘴温度PID校准命令：  "PID_CALIBRATE HEATER=extruder TARGET=245</span></span><br><span class="line"><span class="comment">#control = pid</span></span><br><span class="line"><span class="comment">#pid_kp = 26.213</span></span><br><span class="line"><span class="comment">#pid_ki = 1.304</span></span><br><span class="line"><span class="comment">#pid_kd = 131.721</span></span><br><span class="line">[verify_heater extruder]</span><br><span class="line"><span class="comment">#热床</span></span><br><span class="line"><span class="comment">#热床配置/温度差</span></span><br><span class="line"><span class="comment">#加热器和温度传感器验证。</span></span><br><span class="line"><span class="comment">#默认在打印机上每个配置的加热器上启用加热器验证。</span></span><br><span class="line"><span class="comment">#使用 verify_heater 分段来覆盖默认设置。</span></span><br><span class="line">max_error: 999</span><br><span class="line"><span class="comment">#   报错之前最大的“累计温度偏差”</span></span><br><span class="line"><span class="comment">#   更小的值会导致更严格的检查，而更大的值在报错前允许更多的时间</span></span><br><span class="line"><span class="comment">#   具体地说，温度会每秒检查一次。</span></span><br><span class="line"><span class="comment">#   如果温度正在接近目标温度，内部的“错误计数”会重置。</span></span><br><span class="line"><span class="comment">#   否则，如果温度低于目标区间，那么计数器会增加汇报的温度与目标的差</span></span><br><span class="line"><span class="comment">#   当计数值超过“max_error”就会报错</span></span><br><span class="line"><span class="comment">#   默认值是120</span></span><br><span class="line">check_gain_time:600</span><br><span class="line"><span class="comment">#   这个量控制着加热器初始化加热时的检查。</span></span><br><span class="line"><span class="comment">#   更小的值会导致更严格的检查，而更大的值在报错前允许更多的时间</span></span><br><span class="line"><span class="comment">#   具体地说，初始化加热时，只要加热器在时间片内（秒）升高温度，</span></span><br><span class="line"><span class="comment">#   错误计数会重置</span></span><br><span class="line"><span class="comment">#   默认值对于挤出头是20秒，热床是60秒</span></span><br><span class="line">hysteresis: 999</span><br><span class="line"><span class="comment">#   被认为是在目标区间内的最大温差（以摄氏度为单位）</span></span><br><span class="line"><span class="comment">#   这个量控制着max_error区间检测</span></span><br><span class="line"><span class="comment">#   很少定制这个值</span></span><br><span class="line"><span class="comment">#   默认是5</span></span><br><span class="line">heating_gain: 0.2</span><br><span class="line"><span class="comment">#   在check_gain_time检查中最小需要升高的温度（以摄氏度为单位）</span></span><br><span class="line"><span class="comment">#   很少定制这个值</span></span><br><span class="line"><span class="comment">#   默认是2</span></span><br><span class="line"></span><br><span class="line">[tmc2209 extruder]</span><br><span class="line">uart_pin:PE1</span><br><span class="line">interpolate: False</span><br><span class="line">run_current: 0.6</span><br><span class="line">sense_resistor: 0.110</span><br><span class="line">stealthchop_threshold: 0            <span class="comment"># 静音阀值（如果不需要静音，请将数值改为0）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">####################################################################</span></span><br><span class="line"><span class="comment">#                            热床配置</span></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line">[heater_bed]</span><br><span class="line">heater_pin: PA3              <span class="comment"># 热床接口</span></span><br><span class="line">sensor_type: Generic 3950    <span class="comment"># 热床传感器类型</span></span><br><span class="line">sensor_pin: PF3              <span class="comment"># 热床传感器接口</span></span><br><span class="line">max_power: 1.0              <span class="comment"># 热床功率</span></span><br><span class="line">min_temp: -235               <span class="comment"># 热床最小温度</span></span><br><span class="line">max_temp: 150                <span class="comment"># 热床最大温度</span></span><br><span class="line"><span class="comment"># 热床温度PID校准命令：  "PID_CALIBRATE HEATER=heater_bed TARGET=100"</span></span><br><span class="line"><span class="comment">#control: pid</span></span><br><span class="line"><span class="comment">#pid_kp: 58.437</span></span><br><span class="line"><span class="comment">#pid_ki: 2.347</span></span><br><span class="line"><span class="comment">#pid_kd: 363.769</span></span><br><span class="line">[verify_heater heater_bed]</span><br><span class="line"><span class="comment">#热床</span></span><br><span class="line"><span class="comment">#热床配置/温度差</span></span><br><span class="line"><span class="comment">#加热器和温度传感器验证。</span></span><br><span class="line"><span class="comment">#默认在打印机上每个配置的加热器上启用加热器验证。</span></span><br><span class="line"><span class="comment">#使用 verify_heater 分段来覆盖默认设置。</span></span><br><span class="line">max_error: 999</span><br><span class="line"><span class="comment">#   报错之前最大的“累计温度偏差”</span></span><br><span class="line"><span class="comment">#   更小的值会导致更严格的检查，而更大的值在报错前允许更多的时间</span></span><br><span class="line"><span class="comment">#   具体地说，温度会每秒检查一次。</span></span><br><span class="line"><span class="comment">#   如果温度正在接近目标温度，内部的“错误计数”会重置。</span></span><br><span class="line"><span class="comment">#   否则，如果温度低于目标区间，那么计数器会增加汇报的温度与目标的差</span></span><br><span class="line"><span class="comment">#   当计数值超过“max_error”就会报错</span></span><br><span class="line"><span class="comment">#   默认值是120</span></span><br><span class="line">check_gain_time:600</span><br><span class="line"><span class="comment">#   这个量控制着加热器初始化加热时的检查。</span></span><br><span class="line"><span class="comment">#   更小的值会导致更严格的检查，而更大的值在报错前允许更多的时间</span></span><br><span class="line"><span class="comment">#   具体地说，初始化加热时，只要加热器在时间片内（秒）升高温度，</span></span><br><span class="line"><span class="comment">#   错误计数会重置</span></span><br><span class="line"><span class="comment">#   默认值对于挤出头是20秒，热床是60秒</span></span><br><span class="line">hysteresis: 5</span><br><span class="line"><span class="comment">#   被认为是在目标区间内的最大温差（以摄氏度为单位）</span></span><br><span class="line"><span class="comment">#   这个量控制着max_error区间检测</span></span><br><span class="line"><span class="comment">#   很少定制这个值</span></span><br><span class="line"><span class="comment">#   默认是5</span></span><br><span class="line">heating_gain: 0.2</span><br><span class="line"><span class="comment">#   在check_gain_time检查中最小需要升高的温度（以摄氏度为单位）</span></span><br><span class="line"><span class="comment">#   很少定制这个值</span></span><br><span class="line"><span class="comment">#   默认是2</span></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">#                             风扇配置</span></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line">[fan]                        <span class="comment"># 模型冷却风扇</span></span><br><span class="line">pin:PA8</span><br><span class="line">kick_start_time: 0.5         <span class="comment"># 启动时间（勿动）</span></span><br><span class="line">off_below: 0.20              <span class="comment"># 勿动</span></span><br><span class="line">hardware_pwm: False</span><br><span class="line">max_power: 1.0</span><br><span class="line">shutdown_speed: 0</span><br><span class="line"><span class="comment">#--------------------------------------------------------------------</span></span><br><span class="line">[heater_fan 喉管散热]         <span class="comment"># 喉管冷却风扇</span></span><br><span class="line">pin:PE5</span><br><span class="line">max_power: 1.0</span><br><span class="line">kick_start_time: 0.5         <span class="comment"># 启动时间（勿动）</span></span><br><span class="line">heater: extruder             <span class="comment"># 关联的设备：挤出机</span></span><br><span class="line">heater_temp: 50              <span class="comment"># 挤出机达到多少度启动风扇</span></span><br><span class="line">fan_speed: 1.0</span><br><span class="line">shutdown_speed: 1</span><br><span class="line"><span class="comment">#--------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># [heater_fan 电器仓风扇]         # 电器仓风扇</span></span><br><span class="line"><span class="comment"># pin: PA0</span></span><br><span class="line"><span class="comment"># max_power: 1.0</span></span><br><span class="line"><span class="comment"># shutdown_speed: 0.0</span></span><br><span class="line"><span class="comment"># kick_start_time: 5.0</span></span><br><span class="line"><span class="comment"># heater: heater_bed           # 关联的设备：热床</span></span><br><span class="line"><span class="comment"># heater_temp: -50              # 热床达到多少度启动风扇</span></span><br><span class="line"><span class="comment"># fan_speed: 1.0</span></span><br><span class="line"><span class="comment">#[heater_fan Z风扇]         # 电器仓风扇</span></span><br><span class="line"><span class="comment">#pin: PC8</span></span><br><span class="line"><span class="comment">#max_power: 1.0</span></span><br><span class="line"><span class="comment">#shutdown_speed: 0.0</span></span><br><span class="line"><span class="comment">#kick_start_time: 5.0</span></span><br><span class="line"><span class="comment">#heater: heater_bed           # 关联的设备：热床</span></span><br><span class="line"><span class="comment">#heater_temp: -100              # 热床达到多少度启动风扇</span></span><br><span class="line"><span class="comment">#fan_speed: 1.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># [fan_generic 热床风扇1]</span></span><br><span class="line"><span class="comment"># pin:PC6</span></span><br><span class="line"><span class="comment"># max_power: 1.0</span></span><br><span class="line"><span class="comment"># # #--------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># [fan_generic 侧边风扇_fan]</span></span><br><span class="line"><span class="comment"># pin:PC7</span></span><br><span class="line"><span class="comment"># max_power: 1.0</span></span><br><span class="line"><span class="comment"># # #--------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># [fan_generic 侧边风扇_fan1]</span></span><br><span class="line"><span class="comment"># pin:PC8</span></span><br><span class="line"><span class="comment"># max_power: 1.0</span></span><br><span class="line"><span class="comment"># [controller_fan tmc2209z]</span></span><br><span class="line"><span class="comment"># pin:PA2</span></span><br><span class="line"><span class="comment"># max_power:1.0</span></span><br><span class="line"><span class="comment"># shutdown_speed:0</span></span><br><span class="line"><span class="comment"># # cycle_time:</span></span><br><span class="line"><span class="comment"># hardware_pwm:False</span></span><br><span class="line"><span class="comment"># kick_start_time:0.300</span></span><br><span class="line"><span class="comment"># off_below:0</span></span><br><span class="line"><span class="comment"># # tachometer_pin:</span></span><br><span class="line"><span class="comment"># # tachometer_ppr:</span></span><br><span class="line"><span class="comment"># # tachometer_poll_interval:</span></span><br><span class="line"><span class="comment"># # enable_pin:</span></span><br><span class="line"><span class="comment"># #    请参阅“fan”分段，了解上述参数的描述。</span></span><br><span class="line"><span class="comment"># fan_speed: 1.0</span></span><br><span class="line"><span class="comment"># #    当加热器或步进驱动器活跃时，将设置风扇速度（表示为从 0.0 到 1.0 的值）。</span></span><br><span class="line"><span class="comment"># #    默认值为 1.0。</span></span><br><span class="line"><span class="comment"># idle_timeout:999</span></span><br><span class="line"><span class="comment"># #    在步进驱动器或加热器不再活跃后风扇应保持运行的时间（以秒为单位）。</span></span><br><span class="line"><span class="comment"># #    默认值为 30 秒。</span></span><br><span class="line"><span class="comment"># idle_speed:0.5</span></span><br><span class="line"><span class="comment"># #    当步进驱动器或加热器不再活跃后并且达到 idle_timeout 之前，将设置风扇速度</span></span><br><span class="line"><span class="comment"># #    （表示为从 0.0 到 1.0 的值）。</span></span><br><span class="line"><span class="comment"># #    默认值为 fan_speed。</span></span><br><span class="line"><span class="comment"># stepper:stepper_z</span></span><br><span class="line"><span class="comment"># #    定义与此风扇相关联的加热器/步进器的配置分段的名称。如果在此处提供了逗号分隔的</span></span><br><span class="line"><span class="comment"># #    加热器/步进器名称列表，则当任何给定的加热器/步进器启用时，将启用该风扇。</span></span><br><span class="line"><span class="comment"># #    默认加热器为 "extruder"，默认步进器为所有步进器。</span></span><br><span class="line"><span class="comment">#[temperature_fan Y1D57CM31]         # 电器仓风扇</span></span><br><span class="line"><span class="comment">#pin: PA0</span></span><br><span class="line"><span class="comment">#max_power: 1.0</span></span><br><span class="line"><span class="comment">#shutdown_speed: 0.0</span></span><br><span class="line"><span class="comment">#kick_start_time: 5.0</span></span><br><span class="line"><span class="comment">#shutdown_speed: 1.0#   微控制器软件进入错误状态时的风扇速度（以0.0到1.0的值表示）。</span></span><br><span class="line"><span class="comment">#   默认值为0。</span></span><br><span class="line"><span class="comment">#sensor_type:Generic 3950 </span></span><br><span class="line"><span class="comment">#sensor_pin:PC2         # 关联的设备：热床</span></span><br><span class="line"><span class="comment">#control:watermark</span></span><br><span class="line"><span class="comment">#min_temp: -235                     # 最低温度，低于此温度将会报错</span></span><br><span class="line"><span class="comment">#max_temp: 999                    # 最高温度，高于此温度将会报错</span></span><br><span class="line"><span class="comment">#max_speed: 1.0                  # 最大转速，为满功率运转时的80%</span></span><br><span class="line"><span class="comment">#min_speed: 0.5                  # 最小转速，为满功率运转时的30%</span></span><br><span class="line"><span class="comment">#--------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># [temperature_fan core_fan]      # 上位机散热风扇</span></span><br><span class="line"><span class="comment"># pin: host:gpiochip1/gpio3       # 上位机风扇pin脚</span></span><br><span class="line"><span class="comment"># max_power: 1.0</span></span><br><span class="line"><span class="comment"># sensor_type: temperature_host   # 设置为上位机主控温度</span></span><br><span class="line"><span class="comment"># control:watermark               # 控制方式</span></span><br><span class="line"><span class="comment"># target_temp: 48                 # 上位机散热风扇启动温度</span></span><br><span class="line"><span class="comment"># min_temp: 0                     # 最低温度，低于此温度将会报错</span></span><br><span class="line"><span class="comment"># max_temp: 90                    # 最高温度，高于此温度将会报错</span></span><br><span class="line"><span class="comment"># off_below: 0.10</span></span><br><span class="line"><span class="comment"># kick_start_time: 0.50</span></span><br><span class="line"><span class="comment"># max_speed: 1.0                  # 最大转速，为满功率运转时的80%</span></span><br><span class="line"><span class="comment"># min_speed: 0.3                  # 最小转速，为满功率运转时的30%</span></span><br><span class="line"><span class="comment"># [temperature_sensor YHS07A]</span></span><br><span class="line"><span class="comment"># sensor_type:Generic 3950      #传感器类型</span></span><br><span class="line"><span class="comment"># sensor_pin:PC4      #传感器引脚</span></span><br><span class="line"><span class="comment"># min_temp:-235       #最小温度低于此温度报错</span></span><br><span class="line"><span class="comment"># max_temp:100        #最大温度高于此温度报错</span></span><br><span class="line"><span class="comment"># [temperature_sensor Y1CM06]</span></span><br><span class="line"><span class="comment"># sensor_type:Generic 3950      #传感器类型</span></span><br><span class="line"><span class="comment"># sensor_pin:PC2      #传感器引脚</span></span><br><span class="line"><span class="comment">#[temperature_sensor XCM06]</span></span><br><span class="line"><span class="comment">#sensor_type:Generic 3950      #传感器类型</span></span><br><span class="line"><span class="comment">#sensor_pin:PC3      #传感器引脚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [temperature_sensor 2209z]</span></span><br><span class="line"><span class="comment"># sensor_type:Generic 3950      #传感器类型</span></span><br><span class="line"><span class="comment"># sensor_pin:PC3      #传感器引脚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">#                           闲置关闭热床                             #</span></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line">[idle_timeout]</span><br><span class="line"><span class="built_in">timeout</span>: 1800                <span class="comment"># 空闲时间超过30分钟则关闭热床</span></span><br><span class="line">gcode:</span><br><span class="line">  TURN_OFF_HEATERS                                            <span class="comment">#停止加热</span></span><br><span class="line">  M84                                                         <span class="comment">#关闭电机</span></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">#                           调平传感器                               #</span></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">#默认PL08N感应探头不低于喷嘴高度，仅用于调平,如果你的PL08N是NO（常开），请将更改pin添加到！</span></span><br><span class="line">[probe]</span><br><span class="line">pin:PG11                   <span class="comment"># 限位开关PIN脚,建议常闭然后添加！反转状态,位置在io-2</span></span><br><span class="line">x_offset: 0                  <span class="comment"># X轴-传感器相对喷嘴偏移量</span></span><br><span class="line">y_offset: 25.0               <span class="comment"># Y轴-传感器相对喷嘴偏移量</span></span><br><span class="line">z_offset: 0              <span class="comment"># Z轴-传感器相对喷嘴偏移量</span></span><br><span class="line">speed: 10                  <span class="comment"># 调平速度</span></span><br><span class="line">samples: 5                   <span class="comment"># 采样次数</span></span><br><span class="line">samples_result: median       <span class="comment"># 取值方式（默认median-中位数）</span></span><br><span class="line">sample_retract_dist: 5.0     <span class="comment"># 调平回缩距离</span></span><br><span class="line">samples_tolerance: 0.02     <span class="comment"># 采样公差（注意过小的值可能造成采样次数增加）</span></span><br><span class="line">samples_tolerance_retries: 3 <span class="comment"># 超公差重试次数</span></span><br><span class="line"><span class="comment">#--------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># [bltouch]</span></span><br><span class="line"><span class="comment"># sensor_pin: ^PC0             # 信号接口</span></span><br><span class="line"><span class="comment"># control_pin: PE6             # 舵机控制</span></span><br><span class="line"><span class="comment"># x_offset: 0                  # X轴-传感器相对喷嘴偏移量</span></span><br><span class="line"><span class="comment"># y_offset: 25.0               # Y轴-传感器相对喷嘴偏移量</span></span><br><span class="line"><span class="comment"># z_offset: 0                  # Z轴-传感器相对喷嘴偏移量</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">#                               归位                                #</span></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line">[safe_z_home]                <span class="comment"># Z轴限位坐标</span></span><br><span class="line">home_xy_position:271,360     <span class="comment"># Z轴限位位置定义（重要！！！自行进行调整）</span></span><br><span class="line">speed:10                   <span class="comment"># 归位速度</span></span><br><span class="line">z_hop:20                    <span class="comment"># 归位之前抬升高度</span></span><br><span class="line"><span class="comment">#--------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#[homing_override]</span></span><br><span class="line"><span class="comment">#axes: z</span></span><br><span class="line"><span class="comment">#set_position_z: 0</span></span><br><span class="line"><span class="comment">#gcode:</span></span><br><span class="line"><span class="comment">#   G90</span></span><br><span class="line"><span class="comment">#   G0 Z15 F600</span></span><br><span class="line"><span class="comment">#   G28 X Y</span></span><br><span class="line"><span class="comment">#    ## Z 限位开关的 XY 位置</span></span><br><span class="line"><span class="comment">#    ##通过后将X0和Y0更新为你的值（如X157、Y305）</span></span><br><span class="line"><span class="comment">#    ## Z 轴限位位置定义</span></span><br><span class="line"><span class="comment">#   G0 X185 Y250 F3600    #250mm   </span></span><br><span class="line"><span class="comment">#   G28 Z</span></span><br><span class="line"><span class="comment">#   G0 Z10 F1800</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">#                           4Z调平 </span></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line">[quad_gantry_level]          <span class="comment"># 300mm机器调平参数</span></span><br><span class="line"><span class="comment"># #gantry_corners:</span></span><br><span class="line"><span class="comment"># #    -60,-10</span></span><br><span class="line"><span class="comment"># #    310,320</span></span><br><span class="line"><span class="comment"># #points:                      # 250mm机器调平点位</span></span><br><span class="line"><span class="comment"># #    50,25</span></span><br><span class="line"><span class="comment"># #    50,175</span></span><br><span class="line"><span class="comment"># #    200,175</span></span><br><span class="line"><span class="comment"># #    200,25</span></span><br><span class="line"><span class="comment"># #--------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># gantry_corners:              # 300mm机器调平点位</span></span><br><span class="line"><span class="comment">#    -60,-10</span></span><br><span class="line"><span class="comment">#    360,370</span></span><br><span class="line"><span class="comment"># points:</span></span><br><span class="line"><span class="comment">#    50,25</span></span><br><span class="line"><span class="comment">#    50,225</span></span><br><span class="line"><span class="comment">#    250,225</span></span><br><span class="line"><span class="comment">#    250,25</span></span><br><span class="line"><span class="comment"># #--------------------------------------------------------------------</span></span><br><span class="line">gantry_corners:              <span class="comment"># 350mm机器调平点位</span></span><br><span class="line">    -60,-10</span><br><span class="line">    410,420</span><br><span class="line">points:</span><br><span class="line">    50,25</span><br><span class="line">    50,275</span><br><span class="line">    300,275</span><br><span class="line">    300,25</span><br><span class="line"><span class="comment"># #--------------------------------------------------------------------</span></span><br><span class="line">speed: 100                   <span class="comment"># 调平速度</span></span><br><span class="line">horizontal_move_z: 10        <span class="comment"># Z轴起始高度</span></span><br><span class="line">retry_tolerance: 0.02        <span class="comment"># 采样公差</span></span><br><span class="line">retries: 5                   <span class="comment"># 超公差重试次数</span></span><br><span class="line">max_adjust: 10               <span class="comment"># 调平最大调整行程</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">#                            LED灯配置（需要时启用）</span></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment"># [neopixel sb]</span></span><br><span class="line"><span class="comment"># pin: PD15                   # 信号接</span></span><br><span class="line"><span class="comment"># chain_count:14              # 灯珠数量</span></span><br><span class="line"><span class="comment"># color_order: GRB           # 灯珠类型</span></span><br><span class="line"><span class="comment"># initial_RED: 0.4            # 天</span></span><br><span class="line"><span class="comment"># initial_GREEN: 0.8          # 依</span></span><br><span class="line"><span class="comment"># initial_BLUE: 1             # 蓝</span></span><br><span class="line"><span class="comment"># initial_WHITE: 0.0          </span></span><br><span class="line"><span class="comment">#[neopixel TP_led]</span></span><br><span class="line"><span class="comment">#pin: PD15</span></span><br><span class="line"><span class="comment">#chain_count: 60</span></span><br><span class="line"><span class="comment"># Number of LEDs</span></span><br><span class="line"><span class="comment"># 灯珠数量</span></span><br><span class="line"><span class="comment">#color_order: GRB</span></span><br><span class="line"><span class="comment">#initial_RED: 0.4    </span></span><br><span class="line"><span class="comment">#initial_GREEN: 0.8</span></span><br><span class="line"><span class="comment">#initial_BLUE: 1</span></span><br><span class="line"><span class="comment">#initial_WHITE: 0.0</span></span><br><span class="line"><span class="comment">#66CCFF </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#[led_effect sb_nozzle_cooling]</span></span><br><span class="line"><span class="comment">#autostart:              false</span></span><br><span class="line"><span class="comment">#frame_rate:             24</span></span><br><span class="line"><span class="comment">#leds:</span></span><br><span class="line"><span class="comment">#    neopixel:TP_led (9,10)</span></span><br><span class="line"><span class="comment">#layers:</span></span><br><span class="line"> <span class="comment">#       breathing  3 1 top (0.0, 0.0, 1.0, 0.1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#[led_effect rainbow]</span></span><br><span class="line"><span class="comment">#leds:</span></span><br><span class="line"> <span class="comment">#   neopixel:TP_led</span></span><br><span class="line"><span class="comment">#autostart:                          true</span></span><br><span class="line"><span class="comment">#frame_rate:                         24</span></span><br><span class="line"><span class="comment">#layers:</span></span><br><span class="line">  <span class="comment">#  gradient  0.3  1 add (0.3, 0.0, 0.0),(0.0, 0.3, 0.0),(0.0, 0.0, 0.3)</span></span><br><span class="line"><span class="comment">#--------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#[z_tilt]</span></span><br><span class="line"><span class="comment">#z_positions:10,110</span></span><br><span class="line"><span class="comment">#            220,110</span></span><br><span class="line"><span class="comment"># X、Y 坐标列表（每行一个；后续行</span></span><br><span class="line"><span class="comment"># 缩进）描述每个床“枢轴点”的位置。这</span></span><br><span class="line"><span class="comment"># “枢轴点”是床连接到给定 Z 的点</span></span><br><span class="line"><span class="comment"># 步进器。它使用喷嘴坐标（X、Y 位置喷嘴的</span></span><br><span class="line"><span class="comment">#（如果它可以直接移动到该点上方）。这</span></span><br><span class="line"><span class="comment"># 第一个条目对应于stepper_z，第二个条目对应于stepper_z1，</span></span><br><span class="line"><span class="comment"># 第三个为stepper_z2等，该参数必须提供。</span></span><br><span class="line"><span class="comment">#points: 10,110</span></span><br><span class="line"><span class="comment">#        220,110</span></span><br><span class="line"><span class="comment"># X、Y 坐标列表（每行一个；后续行</span></span><br><span class="line"><span class="comment"># indented) 应该在 Z_TILT_ADJUST 命令期间探测。</span></span><br><span class="line"><span class="comment"># 指定喷嘴的坐标并确保探头位于上方</span></span><br><span class="line"><span class="comment"># 给定喷嘴坐标处的床。该参数必须是</span></span><br><span class="line"><span class="comment">#   假如。</span></span><br><span class="line"><span class="comment">#speed: 300</span></span><br><span class="line"><span class="comment"># 校准过程中非探测移动的速度（单位：mm/s）。</span></span><br><span class="line"><span class="comment"># 默认为 50。</span></span><br><span class="line"><span class="comment">#horizontal_move_z: 15</span></span><br><span class="line"><span class="comment"># 应命令头部移动到的高度（以毫米为单位）</span></span><br><span class="line"><span class="comment"># 就在开始探测操作之前。默认值为 5。</span></span><br><span class="line"><span class="comment">#retries: 999</span></span><br><span class="line"><span class="comment"># 探测点不在范围内时重试的次数</span></span><br><span class="line"><span class="comment">#   宽容。</span></span><br><span class="line"><span class="comment">#retry_tolerance: 0.01</span></span><br><span class="line"><span class="comment"># 如果启用重试，则在探测到最大和最小时重试</span></span><br><span class="line"><span class="comment"># 点的差异大于 retry_tolerance。注意最小单位</span></span><br><span class="line"><span class="comment"># 此处的更改只需一步即可。但是如果你正在探索</span></span><br><span class="line"><span class="comment"># 比步进器更多的点那么你可能会有一个固定的</span></span><br><span class="line"><span class="comment"># 您可以了解的探测点范围的最小值</span></span><br><span class="line"><span class="comment"># 通过观察命令输出。</span></span><br><span class="line"><span class="comment"># G0 X31 Y25 </span></span><br><span class="line"><span class="comment"># G0 X201 Y25 </span></span><br><span class="line"><span class="comment"># G0 X201 Y195 </span></span><br><span class="line"><span class="comment"># G0 X31 Y195</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line"><span class="comment">#                           自定义gcode宏</span></span><br><span class="line"><span class="comment">#####################################################################</span></span><br><span class="line">[gcode_arcs]                     <span class="comment"># 允许圆弧插补</span></span><br><span class="line">resolution: 1.0                   <span class="comment"># 启用圆弧插补G2，G3</span></span><br><span class="line"><span class="comment">#--------------------------------------------------------------</span></span><br><span class="line">[gcode_macro G32]</span><br><span class="line">gcode:</span><br><span class="line">    <span class="comment">#SET_LED LED=hotend_rgb GREEN=0.0 RED=1.0 BLUE=0.0 WHITE=0   # LED灯控制</span></span><br><span class="line">    BED_MESH_CLEAR                 <span class="comment"># 卸载网床</span></span><br><span class="line">    G28                            <span class="comment"># 归位所有轴</span></span><br><span class="line">    QUAD_GANTRY_LEVEL              <span class="comment"># 龙门架调平    </span></span><br><span class="line">    G28                            <span class="comment"># 归位所有轴</span></span><br><span class="line">    G0 X275 Y275 Z30 F3600         <span class="comment"># 300mm</span></span><br><span class="line"><span class="comment">#--------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#TEMPERATURE_WAIT SENSOR=&lt;config_name&gt;[MININUN=&lt;target&gt;][NAXIMUM=&lt;target&gt;] : 等待给定温度传感器等于或高于提供的 MINIMUM 和/或等于或低于</span></span><br><span class="line"><span class="comment">#M104 S[first_layer_temperature] ; 设置挤出机温度</span></span><br><span class="line"><span class="comment"># M140 S[first_layer_bed_temperature] ; 设置床温</span></span><br><span class="line"><span class="comment"># M190 S[first_layer_bed_temperature] ; 等待床温</span></span><br><span class="line"><span class="comment"># M109 S[first_layer_temperature] ; 等待挤出机温度</span></span><br><span class="line"><span class="comment"># 将下面两个宏添加到printer.cfg中</span></span><br><span class="line"><span class="comment"># [gcode_macro CANCEL_PRINT]#取消打印</span></span><br><span class="line"><span class="comment"># description: Cancel the actual running print</span></span><br><span class="line"><span class="comment"># rename_existing: CANCEL_PRINT_BASE</span></span><br><span class="line"><span class="comment"># gcode:</span></span><br><span class="line"><span class="comment">#     G91</span></span><br><span class="line"><span class="comment">#     G1 Z+15 F600</span></span><br><span class="line"><span class="comment">#     G90</span></span><br><span class="line"><span class="comment">#     TURN_OFF_HEATERS</span></span><br><span class="line"><span class="comment">#     CLEAR_PAUSE</span></span><br><span class="line"><span class="comment">#     SDCARD_RESET_FILE</span></span><br><span class="line"><span class="comment">#     # BASE_CANCEL_PRINT</span></span><br><span class="line"><span class="comment"># Pause/Resume Functionality</span></span><br><span class="line"><span class="comment"># [pause_resume]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [display_status]</span></span><br><span class="line"></span><br><span class="line">[gcode_macro CANCEL_PRINT]#取消打印</span><br><span class="line">description: Cancel the actual running <span class="built_in">print</span></span><br><span class="line">rename_existing: CANCEL_PRINT_BASE</span><br><span class="line">gcode:</span><br><span class="line">    G91</span><br><span class="line">    G1 Z+15 F900</span><br><span class="line">    G90</span><br><span class="line">    G0 X0 Y0 F18000</span><br><span class="line">    TURN_OFF_HEATERS</span><br><span class="line">    CLEAR_PAUSE</span><br><span class="line">    SDCARD_RESET_FILE</span><br><span class="line">    BASE_CANCEL_PRINT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[gcode_macro PAUSE]#暂停打印</span><br><span class="line">rename_existing: BASE_PAUSE</span><br><span class="line">gcode:</span><br><span class="line">    <span class="comment">##### set defaults #####</span></span><br><span class="line">    {% <span class="built_in">set</span> x = params.X|default(220) %}      <span class="comment">#edit to your park position</span></span><br><span class="line">    {% <span class="built_in">set</span> y = params.Y|default(200) %}      <span class="comment">#edit to your park position</span></span><br><span class="line">    {% <span class="built_in">set</span> z = params.Z|default(10)|<span class="built_in">float</span> %} <span class="comment">#edit to your park position</span></span><br><span class="line">    {% <span class="built_in">set</span> e = params.E|default(3) %}        <span class="comment">#edit to your retract length</span></span><br><span class="line">    <span class="comment">##### calculate save lift position #####</span></span><br><span class="line">    {% <span class="built_in">set</span> max_z = printer.toolhead.axis_maximum.z|<span class="built_in">float</span> %}</span><br><span class="line">    {% <span class="built_in">set</span> act_z = printer.toolhead.position.z|<span class="built_in">float</span> %}</span><br><span class="line">    {% <span class="built_in">set</span> lift_z = z|abs %}</span><br><span class="line">    {% <span class="keyword">if</span> act_z &lt; (max_z - lift_z) %}</span><br><span class="line">        {% <span class="built_in">set</span> z_safe = lift_z %}</span><br><span class="line">    {% <span class="keyword">else</span> %}</span><br><span class="line">        {% <span class="built_in">set</span> z_safe = max_z - act_z %}</span><br><span class="line">    {% endif %}</span><br><span class="line">    <span class="comment">##### end of definitions #####</span></span><br><span class="line">    SAVE_GCODE_STATE NAME=PAUSE_state</span><br><span class="line">    BASE_PAUSE</span><br><span class="line">    G91</span><br><span class="line">    G1 E-{e} F2100</span><br><span class="line">    G1 Z{z_safe}</span><br><span class="line">    G90</span><br><span class="line">    G1 X{x} Y{y} F12000 </span><br><span class="line">    </span><br><span class="line">[gcode_macro RESUME]#恢复打印</span><br><span class="line">rename_existing: BASE_RESUME</span><br><span class="line">gcode:</span><br><span class="line">    <span class="comment">##### set defaults #####</span></span><br><span class="line">    {% <span class="built_in">set</span> e = params.E|default(3) %} <span class="comment">#edit to your retract length</span></span><br><span class="line">    G91</span><br><span class="line">    G1 E{e} F2100</span><br><span class="line">    G90</span><br><span class="line">    RESTORE_GCODE_STATE NAME=PAUSE_state MOVE=1</span><br><span class="line">    BASE_RESUME</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 热端加热到达温度直接打印，无需等待</span></span><br><span class="line">[gcode_macro M109]</span><br><span class="line">rename_existing: M99109</span><br><span class="line">gcode:</span><br><span class="line">    <span class="comment">#Parameters</span></span><br><span class="line">    {% <span class="built_in">set</span> s = params.S|<span class="built_in">float</span> %}</span><br><span class="line">    </span><br><span class="line">    M104 {% <span class="keyword">for</span> p <span class="keyword">in</span> params %}{<span class="string">'%s%s'</span> % (p, params[p])}{% endfor %}  <span class="comment"># Set hotend temp</span></span><br><span class="line">    {% <span class="keyword">if</span> s != 0 %}</span><br><span class="line">        TEMPERATURE_WAIT SENSOR=extruder MINIMUM={s} MAXIMUM={s+1}   <span class="comment"># Wait for hotend temp (within 1 degree)</span></span><br><span class="line">    {% endif %}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 热床加热到达温度直接下一步，无需等待</span></span><br><span class="line">[gcode_macro M190]</span><br><span class="line">rename_existing: M99190</span><br><span class="line">gcode:</span><br><span class="line">    <span class="comment">#Parameters</span></span><br><span class="line">    {% <span class="built_in">set</span> s = params.S|<span class="built_in">float</span> %}</span><br><span class="line"></span><br><span class="line">    M140 {% <span class="keyword">for</span> p <span class="keyword">in</span> params %}{<span class="string">'%s%s'</span> % (p, params[p])}{% endfor %}   <span class="comment"># Set bed temp</span></span><br><span class="line">    {% <span class="keyword">if</span> s != 0 %}</span><br><span class="line">        TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={s} MAXIMUM={s+1}  <span class="comment"># Wait for bed temp (within 1 degree)</span></span><br><span class="line">    {% endif %}</span><br><span class="line"><span class="comment"># M104 S[first_layer_temperature] ; set extruder temp</span></span><br><span class="line"><span class="comment"># M140 S[first_layer_bed_temperature] ; set bed temp</span></span><br><span class="line"><span class="comment"># M109 S[first_layer_temperature] ; 等待挤出机温度</span></span><br><span class="line"><span class="comment"># M190 S[first_layer_bed_temperature] ; 等待床温</span></span><br><span class="line"><span class="comment"># PRINT_START</span></span><br><span class="line"><span class="comment"># PRINT_renklicky</span></span><br><span class="line"><span class="comment"># PRINT_huaxian</span></span><br><span class="line">[gcode_macro PRINT_START]       <span class="comment"># 将 PRINT_START 设置为开始打印时的宏，自定义打印前的动作</span></span><br><span class="line">gcode:</span><br><span class="line"><span class="comment"># TEMPERATURE_WAIT SENSOR=&lt;配置名&gt; [MINIMUM=&lt;目标&gt;] [MAXIMUM=&lt;目标&gt;]：等待指定温度传感器读数高于 MINIMUM 和或低于 MAXIMUM</span></span><br><span class="line">    G92 E0                           <span class="comment"># 重置挤出</span></span><br><span class="line">    <span class="comment"># BED_MESH_CLEAR                 # 卸载网床</span></span><br><span class="line">    G28                              <span class="comment"># 归位所有轴</span></span><br><span class="line">    <span class="comment"># clean_nozzle                      # 擦嘴</span></span><br><span class="line">    <span class="comment"># QUAD_GANTRY_LEVEL              # 龙门架调平</span></span><br><span class="line">    <span class="comment"># G28                              # 归位所有轴</span></span><br><span class="line">    G1 Z20 F3000                     <span class="comment"># 将喷嘴移离热床</span></span><br><span class="line">    G4 P180000</span><br><span class="line">    <span class="comment"># clean_nozzle</span></span><br><span class="line">    <span class="comment"># BED_MESH_CALIBRATE PRINT_MIN={params.PRINT_MIN} PRINT_MAX={params.PRINT_MAX} FORCE_NEW_MESH=True  #根据打印面积探测网床</span></span><br><span class="line">    ; 判断是否有自适应网床参数</span><br><span class="line">  <span class="comment"># {% if params.MESH_MIN %}</span></span><br><span class="line">  <span class="comment">#   M117 ADAPTIVE BED MESH          ; 向屏幕发送文字</span></span><br><span class="line">  <span class="comment">#   ; 此处接收来自Orca的自适应网床参数，需要软件中配置传参</span></span><br><span class="line">  <span class="comment">#   BED_MESH_CALIBRATE mesh_min={params.MESH_MIN} mesh_max={params.MESH_MAX} ALGORITHM={params.MESH_ALGO} PROBE_COUNT={params.PROBE_COUNT} ADAPTIVE=1 ADAPTIVE_MARGIN=0</span></span><br><span class="line">  <span class="comment"># {% else %}</span></span><br><span class="line">  <span class="comment">#   M117 BED MESH          ; 向屏幕发送文字</span></span><br><span class="line">  <span class="comment">#   BED_MESH_CALIBRATE       ; 每次探测网床</span></span><br><span class="line">  <span class="comment"># {% endif %}</span></span><br><span class="line"><span class="comment">#   BED_MESH_PROFILE LOAD=default ; 可选调用默认网床</span></span><br><span class="line">    <span class="comment"># BED_MESH_PROFILE LOAD=default  # 加载网床</span></span><br><span class="line">    <span class="comment"># G28 X</span></span><br><span class="line">    <span class="comment"># G0 Z50</span></span><br><span class="line">    <span class="comment"># G1 E30.0 F300</span></span><br><span class="line">    <span class="comment"># G4 P20000</span></span><br><span class="line">    <span class="comment"># G0 Y205 F6000</span></span><br><span class="line">    <span class="comment"># G0 X190 F6000</span></span><br><span class="line">    <span class="comment"># G0 Z1</span></span><br><span class="line">    <span class="comment"># G0 Y150 F6000</span></span><br><span class="line">    <span class="comment"># 20 26   195 26   195  200   20  195 </span></span><br><span class="line"><span class="comment">#--------------------------------------------------------------------</span></span><br><span class="line">[gcode_macro PRINT_renklicky]</span><br><span class="line">gcode:</span><br><span class="line">    <span class="comment"># G0 Y210 F6000</span></span><br><span class="line">    <span class="comment"># G0 X30 F6000</span></span><br><span class="line">    <span class="comment"># G0 Z50 F900</span></span><br><span class="line">    G0 Z10 F900</span><br><span class="line">    G0 X30 F18000</span><br><span class="line">    G0 Y217 F18000</span><br><span class="line">    G0 Z0 F900</span><br><span class="line">    G0 X150 F24000</span><br><span class="line">    G0 Z15 F600</span><br><span class="line">   </span><br><span class="line">    <span class="comment"># G0 Z0.5 F600</span></span><br><span class="line">   <span class="comment"># G4 P30000</span></span><br><span class="line">    <span class="comment"># G0 X10 F6000</span></span><br><span class="line">    <span class="comment"># G0 Y50 F18000</span></span><br><span class="line">    <span class="comment"># G28 X Y      </span></span><br><span class="line">[gcode_macro PRINT_huaxian]        </span><br><span class="line">gcode:</span><br><span class="line">    G1 Z5 F600 </span><br><span class="line">    G92 E0;              <span class="comment"># 重置挤出</span></span><br><span class="line">    G90                  <span class="comment"># 设置绝对坐标体系</span></span><br><span class="line">    <span class="comment"># G1 E+10.0 F300</span></span><br><span class="line">    G0 X75 Y1 F12000       <span class="comment"># 移动至x5 y1位置，速度100mm/s（F6000，意思为6000mm每分钟）</span></span><br><span class="line">    G0 Z1.0 F600              <span class="comment"># 移动z轴高度至0.4</span></span><br><span class="line">    G91                  <span class="comment"># 设置坐标体系为相对坐标</span></span><br><span class="line">    G1 X100 E20 F1200;   <span class="comment"># 移动x轴100mm，并挤出，更改F可更改挤出率</span></span><br><span class="line">    G1 Y1                <span class="comment"># 移动y轴1mm</span></span><br><span class="line">    G1 X-100 E20 F1200;  <span class="comment"># 反方向移动x轴100mm，并挤出，更改F可更改挤出率</span></span><br><span class="line">    <span class="comment"># G1 Z+5 F600              # 抬高z轴5mm</span></span><br><span class="line">    G92 E0;              <span class="comment"># 重置挤出</span></span><br><span class="line">    G90                  <span class="comment"># 设置绝对坐标体系 </span></span><br><span class="line"><span class="comment">#--------------------------------------------------------------------</span></span><br><span class="line">[gcode_macro PRINT_END]            <span class="comment"># 将 PRINT_END 设置为打印结束时的宏，自定义打印完成之后动作</span></span><br><span class="line">gcode:</span><br><span class="line">    M400                          <span class="comment"># 等待缓冲区清除</span></span><br><span class="line">    G91                           <span class="comment"># 相对定位</span></span><br><span class="line">    G0 Z5.00 X20.0 Y20.0 F12000    <span class="comment"># 移动喷嘴以移除架线</span></span><br><span class="line">    TURN_OFF_HEATERS              <span class="comment"># 关闭热端</span></span><br><span class="line">    G92 E0                        <span class="comment"># 将挤出机归零</span></span><br><span class="line">    G1 E-10.0 F3600               <span class="comment"># 缩回耗材丝   </span></span><br><span class="line">    M107                          <span class="comment"># 关闭风扇</span></span><br><span class="line">    <span class="comment"># G1 Z2 F3000                   # 将喷嘴向上移动2毫米</span></span><br><span class="line">    G90                        <span class="comment"># 设置绝对坐标体系</span></span><br><span class="line">    <span class="comment">#G0  X350 Y360 F12000           # 将喷嘴停在后部</span></span><br><span class="line">    G91                      <span class="comment">#设置相对坐标</span></span><br><span class="line">    G1 Z10 F900</span><br><span class="line">    G90</span><br><span class="line">    G28 X Y   F3000</span><br><span class="line">    BED_MESH_CLEAR                <span class="comment"># 卸载网床</span></span><br><span class="line">    M84</span><br><span class="line"><span class="comment"># M190 S[first_layer_bed_temperature] ; 等待床温</span></span><br><span class="line"><span class="comment"># PRINT_START</span></span><br><span class="line"><span class="comment"># BED_MESH_CALIBRATE mesh_min={adaptive_bed_mesh_min[0]},{adaptive_bed_mesh_min[1]} mesh_max={adaptive_bed_mesh_max[0]},{adaptive_bed_mesh_max[1]} ALGORITHM=[bed_mesh_algo] PROBE_COUNT={bed_mesh_probe_count[0]},{bed_mesh_probe_count[1]} ADAPTIVE=0 ADAPTIVE_MARGIN=0</span></span><br><span class="line"><span class="comment"># PRINT_renklicky</span></span><br><span class="line"><span class="comment"># PRINT_huaxian</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#*# &lt;---------------------- SAVE_CONFIG ----------------------&gt;</span></span><br><span class="line"><span class="comment">#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.</span></span><br><span class="line"><span class="comment">#*#</span></span><br><span class="line"><span class="comment">#*# [heater_bed]</span></span><br><span class="line"><span class="comment">#*# control = pid</span></span><br><span class="line"><span class="comment">#*# pid_kp = 32.555</span></span><br><span class="line"><span class="comment">#*# pid_ki = 4.256</span></span><br><span class="line"><span class="comment">#*# pid_kd = 62.262</span></span><br><span class="line"><span class="comment">#*#</span></span><br><span class="line"><span class="comment">#*# [probe]</span></span><br><span class="line"><span class="comment">#*# z_offset = 7.110</span></span><br><span class="line"><span class="comment">#*#</span></span><br><span class="line"><span class="comment">#*# [extruder]</span></span><br><span class="line"><span class="comment">#*# control = pid</span></span><br><span class="line"><span class="comment">#*# pid_kp = 14.371</span></span><br><span class="line"><span class="comment">#*# pid_ki = 1.808</span></span><br><span class="line"><span class="comment">#*# pid_kd = 28.563</span></span><br><span class="line"><span class="comment">#*#</span></span><br><span class="line"><span class="comment">#*# [bed_mesh 调好了]</span></span><br><span class="line"><span class="comment">#*# version = 1</span></span><br><span class="line"><span class="comment">#*# points =</span></span><br><span class="line"><span class="comment">#*# 	0.064062, 0.043875, 0.017875, -0.006813, -0.004938, 0.004812, 0.026562, 0.046500</span></span><br><span class="line"><span class="comment">#*# 	0.078250, 0.059562, 0.036937, 0.024937, -0.004313, 0.007125, 0.043187, 0.085062</span></span><br><span class="line"><span class="comment">#*# 	0.067250, 0.059937, 0.052312, 0.012937, 0.005937, 0.012562, 0.042187, 0.081125</span></span><br><span class="line"><span class="comment">#*# 	0.052687, 0.048750, 0.029187, 0.019375, -0.001875, 0.008500, 0.024625, 0.091937</span></span><br><span class="line"><span class="comment">#*# 	0.067687, 0.068687, 0.051625, 0.033562, 0.014375, 0.025062, 0.039562, 0.090625</span></span><br><span class="line"><span class="comment">#*# 	0.115937, 0.106375, 0.064750, 0.036562, 0.010125, 0.011750, 0.022687, 0.076125</span></span><br><span class="line"><span class="comment">#*# 	0.171375, 0.129750, 0.111000, 0.073187, 0.052437, 0.036187, 0.017437, 0.062062</span></span><br><span class="line"><span class="comment">#*# 	0.156875, 0.141500, 0.110000, 0.050312, 0.019875, 0.012750, 0.017500, 0.053250</span></span><br><span class="line"><span class="comment">#*# min_x = 1.0</span></span><br><span class="line"><span class="comment">#*# max_x = 199.94</span></span><br><span class="line"><span class="comment">#*# min_y = 28.0</span></span><br><span class="line"><span class="comment">#*# max_y = 206.99</span></span><br><span class="line"><span class="comment">#*# x_count = 8</span></span><br><span class="line"><span class="comment">#*# y_count = 8</span></span><br><span class="line"><span class="comment">#*# mesh_x_pps = 2</span></span><br><span class="line"><span class="comment">#*# mesh_y_pps = 2</span></span><br><span class="line"><span class="comment">#*# algo = bicubic</span></span><br><span class="line"><span class="comment">#*# tension = 0.2</span></span><br><span class="line"><span class="comment">#*#</span></span><br><span class="line"><span class="comment">#*# [input_shaper]</span></span><br><span class="line"><span class="comment">#*# shaper_type_x = 3hump_ei</span></span><br><span class="line"><span class="comment">#*# shaper_freq_x = 56.4</span></span><br><span class="line"><span class="comment">#*# shaper_type_y = 2hump_ei</span></span><br><span class="line"><span class="comment">#*# shaper_freq_y = 67.6</span></span><br><span class="line"><span class="comment">#*#</span></span><br><span class="line"><span class="comment">#*# [bed_mesh default]</span></span><br><span class="line"><span class="comment">#*# version = 1</span></span><br><span class="line"><span class="comment">#*# points =</span></span><br><span class="line"><span class="comment">#*# 	-0.021500, -0.097500, -0.137250, -0.136250, -0.109500, -0.115500, -0.103500, -0.075750</span></span><br><span class="line"><span class="comment">#*# 	0.133500, 0.058750, 0.009750, -0.003500, 0.054000, 0.011500, 0.052250, 0.046500</span></span><br><span class="line"><span class="comment">#*# 	0.123000, 0.081500, 0.020750, -0.010750, -0.009500, 0.017000, 0.050500, 0.062000</span></span><br><span class="line"><span class="comment">#*# 	0.137000, 0.072500, 0.020000, -0.003750, 0.016500, 0.031500, 0.057500, 0.093750</span></span><br><span class="line"><span class="comment">#*# 	0.142000, 0.089000, 0.045500, 0.017250, 0.022250, 0.059250, 0.074500, 0.113250</span></span><br><span class="line"><span class="comment">#*# 	0.172500, 0.095500, 0.056500, 0.035500, 0.055750, 0.069000, 0.104500, 0.129000</span></span><br><span class="line"><span class="comment">#*# 	0.137250, 0.103250, 0.035750, 0.025250, 0.041250, 0.072500, 0.131250, 0.157250</span></span><br><span class="line"><span class="comment">#*# 	0.174500, 0.104000, 0.028000, 0.062500, 0.070250, 0.111750, 0.233500, 0.234250</span></span><br><span class="line"><span class="comment">#*# x_count = 8</span></span><br><span class="line"><span class="comment">#*# y_count = 8</span></span><br><span class="line"><span class="comment">#*# mesh_x_pps = 0</span></span><br><span class="line"><span class="comment">#*# mesh_y_pps = 0</span></span><br><span class="line"><span class="comment">#*# algo = bicubic</span></span><br><span class="line"><span class="comment">#*# tension = 0.2</span></span><br><span class="line"><span class="comment">#*# min_x = 10.0</span></span><br><span class="line"><span class="comment">#*# max_x = 220.97</span></span><br><span class="line"><span class="comment">#*# min_y = 28.0</span></span><br><span class="line"><span class="comment">#*# max_y = 228.97</span></span><br></pre></td></tr></tbody></table></figure>
</div></article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src="https://pan.imgbed.link/file/185733" title="头像" alt="头像"><img class="post-copyright__author_img_front" src="https://pan.imgbed.link/file/185733" title="头像" alt="头像"></a><div class="post-copyright__author_name">tinnedfruit</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://blog.tinnedfruit.top/2024/11/01/klipper/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://blog.tinnedfruit.top/2024/11/01/klipper/')">klipper系统源码</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://pan.imgbed.link/file/185637" target="_blank"><img class="post-qr-code-img" src="https://pan.imgbed.link/file/185637" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://pan.imgbed.link/file/185638" target="_blank"><img class="post-qr-code-img" src="https://pan.imgbed.link/file/185638" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div><div class="reward-link mode"><a class="reward-link-button" href="/wechat/"><i class="anzhiyufont anzhiyu-icon-plant-fill"></i>运营模式与责任</a></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://blog.tinnedfruit.top/2024/11/01/klipper/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=klipper系统源码&amp;url=http://blog.tinnedfruit.top/2024/11/01/klipper/&amp;pic=https://pan.imgbed.link/file/189088" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://blog.tinnedfruit.top" target="_blank">画船听雨眠</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/klipper/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>klipper<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://pan.imgbed.link/file/185694" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/10/25/mogai0/"><img class="prev-cover" src="https://pan.imgbed.link/file/185691" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">为主页文章卡片添加擦亮动画效果</div></div></a></div><div class="next-post pull-right"><a href="/2024/11/03/3dModeling1/"><img class="next-cover" src="https://pan.imgbed.link/file/186742" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">3d打印切片技巧</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src="https://pan.imgbed.link/file/185733" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"><div class="author-status"><img class="g-status" src="https://twikoo-magic.oss-cn-hangzhou.aliyuncs.com/baitian/file_6574887.webp" alt="status"></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">qwrt,pve,nas,3d打印</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">tinnedfruit</h1><div class="author-info__desc"></div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/tinnedfruit" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/593957554" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content"><div id="welcome-info"></div></div></div><div class="xpand" style="height:200px;"><canvas class="illo" width="800" height="800" style="max-width: 200px; max-height: 200px; touch-action: none; width: 640px; height: 640px;"></canvas></div><script src="https://npm.elemecdn.com/ethan4116-blog/lib/js/other/two-people/twopeople1.js"></script><script src="https://npm.elemecdn.com/ethan4116-blog/lib/js/other/two-people/zdog.dist.js"></script><script id="rendered-js" src="https://npm.wfqyys.cn/js/twoPeople.js"></script><style>.card-widget.card-announcement {
margin: 0;
align-items: center;
justify-content: center;
text-align: center;
}
.xpand canvas {
display: block;
margin: 0 auto;
cursor: move;
}</style><div class="card-widget card-welcome"><div id="welcome-info"></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#klipper%E7%B3%BB%E7%BB%9F%E6%BA%90%E7%A0%81"><span class="toc-text">klipper系统源码</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#moonraker-conf-bkp"><span class="toc-text">.moonraker.conf.bkp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fluidd"><span class="toc-text">fluidd</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#klicky-bed-mesh-calibrate"><span class="toc-text">klicky-bed-mesh-calibrate</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#klicky-macros"><span class="toc-text">klicky-macros</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#klicky-probe"><span class="toc-text">klicky-probe</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#klicky-quad-gantry-level"><span class="toc-text">klicky-quad-gantry-level</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#klicky-variables"><span class="toc-text">klicky-variables</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#klicky-z-calibration"><span class="toc-text">klicky-z-calibration</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KlipperScreen-conf"><span class="toc-text">KlipperScreen.conf</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#moonraker-conf"><span class="toc-text">moonraker.conf</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#printer"><span class="toc-text">printer</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/11/03/nas0/" title="黑群晖安装教程"><img src="https://pan.imgbed.link/file/185694" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="黑群晖安装教程"></a><div class="content"><a class="title" href="/2024/11/03/nas0/" title="黑群晖安装教程">黑群晖安装教程</a><time datetime="2024-11-03T07:53:09.316Z" title="发表于 2024-11-03 15:53:09">2024-11-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/03/nas2/" title="黑群晖添加应用拓展"><img src="https://pan.imgbed.link/file/185696" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="黑群晖添加应用拓展"></a><div class="content"><a class="title" href="/2024/11/03/nas2/" title="黑群晖添加应用拓展">黑群晖添加应用拓展</a><time datetime="2024-11-03T07:53:09.316Z" title="发表于 2024-11-03 15:53:09">2024-11-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/03/nas1/" title="黑群晖洗半白教程"><img src="https://pan.imgbed.link/file/185695" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="黑群晖洗半白教程"></a><div class="content"><a class="title" href="/2024/11/03/nas1/" title="黑群晖洗半白教程">黑群晖洗半白教程</a><time datetime="2024-11-03T07:53:09.316Z" title="发表于 2024-11-03 15:53:09">2024-11-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/03/voron2.4peijian/" title="voron2.4组装配件指南"><img src="https://pan.imgbed.link/file/185636" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="voron2.4组装配件指南"></a><div class="content"><a class="title" href="/2024/11/03/voron2.4peijian/" title="voron2.4组装配件指南">voron2.4组装配件指南</a><time datetime="2024-11-03T07:53:09.316Z" title="发表于 2024-11-03 15:53:09">2024-11-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/03/voron2.4wendang/" title="voron2.4文档"><img src="https://pan.imgbed.link/file/185635" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="voron2.4文档"></a><div class="content"><a class="title" href="/2024/11/03/voron2.4wendang/" title="voron2.4文档">voron2.4文档</a><time datetime="2024-11-03T07:53:09.316Z" title="发表于 2024-11-03 15:53:09">2024-11-03</time></div></div></div></div></div></div></div></main><footer id="footer" style="https://pan.imgbed.link/file/189088"><div id="footer-wrap"><div id="workboard"><img class="workSituationImg boardsign" src="https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-上班摸鱼中.svg" alt="距离月入25k也就还差一个大佬带我~" title="距离月入25k也就还差一个大佬带我~"><div id="runtimeTextTip"></div></div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">服务</div><div class="footer-links"><a class="footer-item" title="51la统计" target="_blank" rel="noopener" href="https://v6.51.la/">51la统计</a><a class="footer-item" title="十年之约" target="_blank" rel="noopener" href="https://www.foreverblog.cn/">十年之约</a><a class="footer-item" title="开往" target="_blank" rel="noopener" href="https://github.com/travellings-link/travellings">开往</a></div></div><div class="footer-group"><div class="footer-title">主题</div><div class="footer-links"><a class="footer-item" title="文档" target="_blank" rel="noopener" href="https://docs.anheyu.com/">文档</a><a class="footer-item" title="源码" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu">源码</a><a class="footer-item" title="更新日志" href="/update/">更新日志</a></div></div><div class="footer-group"><div class="footer-title">导航</div><div class="footer-links"><a class="footer-item" title="即刻短文" href="/essay/">即刻短文</a><a class="footer-item" title="友链文章" href="/fcircle/">友链文章</a><a class="footer-item" title="留言板" href="/comments/">留言板</a></div></div><div class="footer-group"><div class="footer-title">协议</div><div class="footer-links"><a class="footer-item" title="隐私协议" href="/privacy/">隐私协议</a><a class="footer-item" title="Cookies" href="/cookies/">Cookies</a><a class="footer-item" title="版权协议" href="/copyright/">版权协议</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友链</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title="博客框架为Hexo_v5.4.0"><img src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v5.4.0"></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"></a><a class="github-badge" target="_blank" href="https://www.dogecloud.com/" style="margin-inline:5px" data-title="本站使用多吉云为静态资源提供CDN加速" title="本站使用多吉云为静态资源提供CDN加速"><img src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/CDN-多吉云-3693F3.svg" alt="本站使用多吉云为静态资源提供CDN加速"></a><a class="github-badge" target="_blank" href="https://www.upyun.com/" style="margin-inline:5px" data-title="本站使用又拍云为静态资源提供CDN加速" title="本站使用又拍云为静态资源提供CDN加速"><img src="https://pan.imgbed.link/file/189418" alt="本站使用又拍云为静态资源提供CDN加速"></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title="本站项目由Github托管"><img src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="本站项目由Github托管"></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">©2024 By <a class="footer-bar-link" href="/" title="tinnedfruit" target="_blank">tinnedfruit</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a><a class="footer-bar-link" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/" title="粤ICP备2024313835号">粤ICP备2024313835号</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">16</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">3</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://blog.tinnedfruit.top/" title="罆頭的博客"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="罆頭的博客"><span class="back-menu-item-text">罆頭的博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/charts/"><i class="anzhiyufont anzhiyu-icon-chart-line faa-tada" style="font-size: 0.9em;"></i><span> 文章统计</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-instagram faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/games/"><i class="anzhiyufont anzhiyu-icon-rocket faa-tada" style="font-size: 0.9em;"></i><span> 游戏世界</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 我的装备</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/todolist/"><i class="anzhiyufont anzhiyu-icon-book-open faa-tada" style="font-size: 0.9em;"></i><span> 想做的事</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-comments faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Hexo/" style="font-size: 0.88rem;">Hexo<sup>1</sup></a><a href="/tags/PVE/" style="font-size: 0.88rem;">PVE<sup>3</sup></a><a href="/tags/Tag-Plugins/" style="font-size: 0.88rem;">Tag Plugins<sup>1</sup></a><a href="/tags/klipper/" style="font-size: 0.88rem;">klipper<sup>1</sup></a><a href="/tags/voron/" style="font-size: 0.88rem;">voron<sup>1</sup></a><a href="/tags/%E4%B8%BB%E9%A2%98%E9%AD%94%E6%94%B9/" style="font-size: 0.88rem;">主题魔改<sup>3</sup></a></div></div><hr></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="chat-btn" type="button" title="聊天"><i class="anzhiyufont anzhiyu-icon-comment-sms"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async="" src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("2024/10/15 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2024 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 tinnedfruit 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async="" src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("2024/10/15 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-下班啦.svg";
        img.title = "下班了就该开开心心的玩耍，嘿嘿~";
        img.alt = "下班了就该开开心心的玩耍，嘿嘿~";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.60.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script async="" data-pjax="" src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script async="" data-pjax="" src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script defer="true" src="/js/welcome.js"></script><script type="text/javascript" src="https://unpkg.zhimg.com/jquery@latest/dist/jquery.min.js"></script><link rel="stylesheet" href="/custom/fps/fps.css" media="defer" onload="this.media='all'"><script src="/custom/fps/fps.js"></script><span id="fps"></span><script defer="" type="text/javascript" src="/custom/dayalert/sweetalert2.all.js"></script><script defer="" src="/custom/dayalert/lunar.js"></script><script defer="" src="/custom/dayalert/day.js"></script><script async="" data-pjax="" src="/js/imgloaded.js?1"></script><script src="/js/footer-animal.js" defer=""></script><script src="https://cdn.bootcdn.net/ajax/libs/echarts/4.9.0-rc.1/echarts.min.js"></script><script>(() => {
  const isChatBtn = true
  const isChatHideShow = true

  if (isChatBtn) {
    const close = () => {
      Chatra('minimizeWidget')
      Chatra('hide')
    }

    const open = () => {
      Chatra('openChat', true)
      Chatra('show')
    }

    window.ChatraSetup = {
      startHidden: true
    }
  
    window.chatBtnFn = () => {
      const isShow = document.getElementById('chatra').classList.contains('chatra--expanded')
      isShow ? close() : open()
    }
  } else if (isChatHideShow) {
    window.chatBtn = {
      hide: () => {
        Chatra('hide')
      },
      show: () => {
        Chatra('show')
      }
    }
  }

  (function(d, w, c) {
    w.ChatraID = 'iST2hTntGAfwEQrEf'
    var s = d.createElement('script')
    w[c] = w[c] || function() {
        (w[c].q = w[c].q || []).push(arguments)
    }
    s.async = true
    s.src = 'https://call.chatra.io/chatra.js'
    if (d.head) d.head.appendChild(s)
  })(document, window, 'Chatra')

})()</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: true,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', 'G-548WJ90VZV', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div>
    <link rel="stylesheet" href="https://ai.tianli0.top/static/public/postChatUser_summary.min.css">
    <script>
        let tianliGPT_key = 'b229278e24060b4dd55341b7bd36195cd13289';
        let tianliGPT_postSelector = '#postchat_postcontent';
        let tianliGPT_Title = '文章摘要';
        let tianliGPT_postURL = '/^https?://[^/]+/[0-9]{4}/[0-9]{2}/[0-9]{2}/';
        let tianliGPT_blacklist = '';
        let tianliGPT_wordLimit = '1000';
        let tianliGPT_typingAnimate = true;
        var postChatConfig = {
          backgroundColor: "#3e86f6",
          bottom: "67px",
          left: "16px",
          fill: "#FFFFFF",
          width: "44px",
          frameWidth: "375px",
          frameHeight: "600px",
          defaultInput: true,
          upLoadWeb: true,
          showInviteLink: true,
          userTitle: "PostChat",
          userDesc: "如果你对网站的内容有任何疑问，可以来问我哦～",
          addButton: true,
          beginningText: "这篇文章介绍了"
        };
    </script>
    <script data-postchat_key="b229278e24060b4dd55341b7bd36195cd13289" src="https://ai.tianli0.top/static/public/postChatUser_summary.min.js"></script>
  </body></html>